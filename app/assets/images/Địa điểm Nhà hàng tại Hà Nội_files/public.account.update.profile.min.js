;function getEatingPreferencesModel(a){var b;for(b=0;b<a.Cuisines.length;b++)a.Cuisines[b].Selected=ko.observable(a.Cuisines[b].Selected);for(b=0;b<a.Purposes.length;b++)a.Purposes[b].Selected=ko.observable(a.Purposes[b].Selected);for(b=0;b<a.Dishes.length;b++)a.Dishes[b].Selected=ko.observable(a.Dishes[b].Selected);for(b=0;b<a.Dinings.length;b++)a.Dinings[b].Selected=ko.observable(a.Dinings[b].Selected);for(b=0;b<a.EatingHabits.length;b++)a.EatingHabits[b].Selected=ko.observable(a.EatingHabits[b].Selected);for(b=0;b<a.Districts.length;b++)a.Districts[b].Selected=ko.observable(a.Districts[b].Selected);return new EatingPreferenceModel(a)}function formatCurrency(a){return a==0?a:(a/=1e3,a<1e3?a.format("N0")+" "+MoneyText.Thousand:(parseFloat(a)/1e3).format("N2")+" "+MoneyText.Million)}function getEatingPreferencesPostData(a){var b=new Array;for(var c=0;c<a.Cuisines().length;c++){var d=a.Cuisines()[c];d.Selected()&&b.push({Id:d.Id,Selected:!0})}var e=new Array;for(var c=0;c<a.Purposes().length;c++){var d=a.Purposes()[c];d.Selected()&&e.push({Id:d.Id,Selected:!0})}var f=new Array;for(var c=0;c<a.Dishes().length;c++){var d=a.Dishes()[c];d.Selected()&&f.push({Id:d.Id,Selected:!0})}var g=new Array;for(var c=0;c<a.Dinings().length;c++){var d=a.Dinings()[c];d.Selected()&&g.push({Id:d.Id,Selected:!0})}var h=new Array;for(var c=0;c<a.EatingHabits().length;c++){var d=a.EatingHabits()[c];d.Selected()&&h.push({Id:d.Id,Selected:!0})}var i=new Array;for(var c=0;c<a.Districts().length;c++){var d=a.Districts()[c];d.Selected()&&i.push({Id:d.Id,Selected:!0})}var j={Cuisines:b,Purposes:e,Dinings:g,Dishes:f,EatingHabits:h,Districts:i,MaxCost:a.MaxCost(),AllSelectedDistricts:a.AllSelectedDistricts()};return JSON.stringify(j)}var OptionData=function(){},EatingPreferenceModel=function(a){var b=this;b.Cuisines=ko.observableArray(a.Cuisines),b.Purposes=ko.observableArray(a.Purposes),b.Dinings=ko.observableArray(a.Dinings),b.Dishes=ko.observableArray(a.Dishes),b.EatingHabits=ko.observableArray(a.EatingHabits),b.Districts=ko.observableArray(a.Districts),b.Provinces=ko.observableArray(a.Provinces),b.ProvinceId=ko.observable(a.ProvinceId),b.MaxCost=ko.observable(a.MaxCost),b.AllSelectedDistricts=ko.observableArray(a.AllSelectedDistricts),b.getFormattedMaxCost=ko.computed(function(){return formatCurrency(b.MaxCost())}),b.IsSaving=ko.observable(!1),b.IsSavingSuccess=ko.observable(!1),b.IsSavingFail=ko.observable(!1),b.submit=function(){if(!b.IsSaving()){b.IsSaving(!0),b.IsSavingSuccess(!1);var a=getEatingPreferencesPostData(b);$.ajax({type:"POST",url:"/Account/EatingPreferences",data:a,success:function(a){a.success?(b.IsSaving(!1),b.IsSavingSuccess(!0)):b.IsSavingFail(!0)},dataType:"json",contentType:"application/json"})}},b.anyClick=function(){b.IsSavingSuccess(!1),b.IsSavingFail(!1)},b.CuisinesSelected=ko.computed(function(){var a=!1;for(var b=0;b<this.Cuisines().length;b++)if(this.Cuisines()[b].Selected()){a=!0;break}return a},b),b.PurposesSelected=ko.computed(function(){var a=!1;for(var c=0;c<b.Purposes().length;c++)if(b.Purposes()[c].Selected()){a=!0;break}return a},b),b.DiningsSelected=ko.computed(function(){var a=!1;for(var c=0;c<b.Dinings().length;c++)if(b.Dinings()[c].Selected()){a=!0;break}return a},b),b.DishesSelected=ko.computed(function(){var a=!1;for(var c=0;c<b.Dishes().length;c++)if(b.Dishes()[c].Selected()){a=!0;break}return a},b),b.EatingHabitsSelected=ko.computed(function(){var a=!1;for(var c=0;c<b.EatingHabits().length;c++)if(b.EatingHabits()[c].Selected()){a=!0;break}return a},b),b.DistrictsSelected=ko.computed(function(){var a=!1;for(var c=0;c<b.Districts().length;c++){var d=b.AllSelectedDistricts().indexOf(b.Districts()[c].Id);b.Districts()[c].Selected()?d==-1&&b.AllSelectedDistricts.push(b.Districts()[c].Id):d!=-1&&b.AllSelectedDistricts.splice(d,1)}return b.AllSelectedDistricts().length>0?a=!0:a=!1,a},b),b.UnChecked=ko.observable(!1),b.isLoadingDistricts=ko.observable(!1),b.changeDistricts=function(a,c){var d=$(c.target).val();if(d!="undefined"&&d!=null&&d!=""&&!b.isLoadingDistricts()){b.isLoadingDistricts(!0);var e=new Date;$.get("/Account/GetDistrictPreferenceOptions?provinceId="+d+"&t="+e.getTime(),function(a){a.success?(b.Districts(EatingPreferenceModel.observableOptions(a.data)),b.AllSelectedDistricts(a.allselecteddistricts),b.isLoadingDistricts(!1)):b.isLoadingDistricts(!1)})}}};EatingPreferenceModel.observableOptions=function(a){var b;for(b=0;b<a.length;b++)a[b].Selected=ko.observable(a[b].Selected);return a};var PreferenceBox=function(a,b){var c=this;c.uid="",c.islogin=ko.observable(a),c.isUpdatedAll=ko.observable(!1),c.type=ko.observable(1),c.nextType=ko.observable(0),c.options=ko.observableArray([]),c.selectedOptions=ko.observableArray([]),c.provinces=ko.observableArray(),c.provinceId=ko.observable(),c.isloading=ko.observable(!1),c.districts=ko.observableArray([]),c.totalSelected=1,c.isSaving=ko.observable(!1),c.title=ko.computed(function(){switch(c.type()){case 1:return PreferenceBoxText.WhatCuisineTypeDoYouLike;case 2:return PreferenceBoxText.WhatMealDoYouLike;case 3:return PreferenceBoxText.WhatTypesDoYouCome;case 4:return PreferenceBoxText.WhatDiningTimeDoYouEating;case 5:return PreferenceBoxText.WhatDoItBeforeEating;case 6:return PreferenceBoxText.WhatPlaceDoYouLike}return""}),c.getPostData=function(){var a=new Array;for(var b=0;b<c.selectedOptions().length;b++){var d=c.selectedOptions()[b];a.push(d.Id)}return{Type:c.type(),SelectedOptions:a,ProvinceId:c.provinceId()}},c.submit=function(a){if(!c.isSaving()){var b=c.getPostData();c.isSaving(!0),$.ajax({type:"POST",url:"/Account/PreferenceBoxUpdate",data:JSON.stringify(b),success:function(b){b.success?(c.isSaving(!1),c.nextType(0),c.getNextType(),a&&c.load()):c.isSaving(!1)},dataType:"json",contentType:"application/json"})}},c.skip=function(){if(c.autoLoad()){var a="preferencesskip_"+c.uid;if(!$.cookie(a))$.cookie(a,c.type(),{expires:10,path:"/"});else{var b=$.cookie(a)+","+c.type();$.cookie(a,b,{expires:10,path:"/"})}}else c.getNextType(),c.load()},c.selectedOptionsReRange=ko.computed(function(){for(var a=0;a<c.selectedOptions().length;a++){var b=c.selectedOptions()[a];b.SelectedOrder(a+1)}}),c.add=function(a){a.Selected(!0),c.options.remove(a),c.selectedOptions.push(a),a.SelectedOrder(c.selectedOptions().length)},c.reject=function(a){for(var b=a.SelectedOrder();b<c.selectedOptions().length;b++){var d=c.selectedOptions()[b];d.SelectedOrder(b)}a.Selected(!1),c.selectedOptions.remove(a),c.options.push(a)},c.click=function(a){if(a.Selected()){for(var b=a.SelectedOrder();b<c.selectedOptions().length;b++){var d=c.selectedOptions()[b];d.SelectedOrder(b)}a.Selected(!a.Selected()),c.selectedOptions.remove(a),c.options.push(a)}else a.Selected(!a.Selected()),c.options.remove(a),c.selectedOptions.push(a),a.SelectedOrder(c.selectedOptions().length)},c.isLoadingDistricts=ko.observable(!1),c.changeDistricts=function(a,b){c.submit(!1);var d=$(b.target).val();if(d!="undefined"&&d!=null&&d!=""&&!c.isLoadingDistricts()){c.isLoadingDistricts(!0);var e=new Date;$.get("/Account/GetDistrictPreferenceBoxOptions?provinceId="+d+"&t="+e.getTime(),function(a){if(a.success){var b=a.data;c.options(PreferenceBox.observableOptions(b.Options)),c.selectedOptions(PreferenceBox.observableOptions(b.SelectedOptions)),c.nextType(b.NextType),c.isLoadingDistricts(!1)}else c.isLoadingDistricts(!1)})}},c.load=function(){if(!c.isloading()){c.isloading(!0);var a="/account/getpreferencebox";c.autoLoad()||(a+="?type="+c.type()),$.ajax({url:a,type:"GET",cache:!1,success:function(a){if(a.success){var b=a.data;c.isUpdatedAll(b.AlreadyUpdateAll),b.AlreadyUpdateAll?(c.options.removeAll(),c.selectedOptions.removeAll(),c.provinceId(0),c.provinces.removeAll(),c.type(0),c.nextType(0)):(c.uid=b.UID,c.options(PreferenceBox.observableOptions(b.Options)),b.SelectedOptions.sort(function(a,b){return a.SelectedOrder-b.SelectedOrder}),c.selectedOptions(PreferenceBox.observableOptions(b.SelectedOptions)),c.provinceId(b.ProvinceId),c.provinces(b.Provinces),c.type(b.Type),c.nextType(b.NextType)),c.isloading(!1)}else c.isloading(!1)}})}},c.login=function(){angular.element('div[ng-controller="HelperCtrl"]').scope().ShowDlgLogin(function(a){a.LoggedIn&&(c.islogin(!0),c.load())})},c.openpopup=function(){angular.element('div[ng-controller="HelperCtrl"]').scope().ShowDlgLogin(function(a){a.LoggedIn&&(c.islogin(!0),UpdateProfileModel.loadUpdateProfilePopup(1))})},c.popupDiv=b,c.types=[1,2,6],c.getNextType=function(){var a=c.types.indexOf(c.type());a>=0&&a<c.types.length-1&&c.type(c.types[a+1])},c.isMaxType=function(){return c.type()==c.types[c.types.length-1]},c.autoLoad=ko.observable(!1),c.showPopup=function(){angular.element('div[ng-controller="HelperCtrl"]').scope().ShowDlgLogin(function(a){a.LoggedIn&&($("#"+c.popupDiv).modal({persist:!0}),$("#simplemodal-container").css("height","435px"),$("#simplemodal-container").css("width","700px"),$("#simplemodal-container").css("background","#f8f8f8"),$(window).resize(),c.loadWithType(c.types[0]))})},c.loadWithType=function(a){c.type(a),c.load()},c.doneCallback=null,c.done=function(){$.modal.close(),typeof c.doneCallback!="undefined"&&c.doneCallback!=null&&c.doneCallback()},c.isActiveType=function(a){return c.type()==a},c.submitAndClose=function(){c.submit(),c.done()}};PreferenceBox.observableOptions=function(a){if(a!=null){var b;for(b=0;b<a.length;b++)a[b].Selected=ko.observable(a[b].Selected),a[b].SelectedOrder=ko.observable(a[b].SelectedOrder);return a}return null},PreferenceBox.CreatePopup=function(a){var b="preferences-popup";if($("#"+b).length>0){var c=new PreferenceBox(!0,b);return c.doneCallback=a,ko.applyBindings(c,document.getElementById(b)),c}return null}
;function loadUpdateEatingPreferences(a){a!=null&&(updateEatingPreferenceModel=getEatingPreferencesModel(a),updateProfileModel.eatingPreferencesModel(updateEatingPreferenceModel))}var UpdateProfile=function(){};UpdateProfile.UpdateAvatar=function(a,b,c){if(c){var d=JSON.parse(b);if(d.success)$("img.update-popup-avatar").attr("src",d.avatarUrl),updateProfileModel.updateVerifyProcess(d.verify);else switch(d.error){case 1:break;default:for(var e=0;e<d.errorList.length;e++)$("#errorsDiv").append(d.errorList[e])}}},UpdateProfile.ValidateBirthday=function(a,b,c){var d=$('#update-profile-popup span[data-valmsg-for="birthdayValidator"]');if(a==0&&b==0&&c==0)return $(d).removeClass("field-validation-error"),$(d).addClass("field-validation-error"),$(d).text(AccountText.InvalidBirthday),!1;if(a==0||b==0||c==0)return $(d).removeClass("field-validation-valid"),$(d).addClass("field-validation-error"),$(d).text(AccountText.InvalidBirthday),!1;var e=new Date(c,b-1,a);return isNaN(e.valueOf())?($(d).removeClass("field-validation-valid"),$(d).addClass("field-validation-error"),$(d).text(AccountText.InvalidBirthday),!1):($(d).removeClass("field-validation-error"),$(d).addClass("field-validation-valid"),$(d).text(""),!0)};var updateEatingPreferenceModel;EatingPreferenceModel.prototype.updateProfileSubmit=function(){var a=this;if(!a.IsSaving()){a.IsSaving(!0),a.IsSavingSuccess(!1),a.IsSavingFail(!1);if(a.AllOptionsValidate()){var b=getEatingPreferencesPostData(a);$.ajax({type:"POST",url:"/Account/EatingPreferences",data:b,success:function(b){b.success?(a.IsSaving(!1),a.IsSavingSuccess(!0),updateProfileModel.autoChangeTab&&setTimeout(function(){$("."+updateAccTabs[2].menuClassName).click()},500)):a.IsSavingFail(!0)},dataType:"json",contentType:"application/json"})}else a.IsSaving(!1)}},EatingPreferenceModel.prototype.OptionValidate=function(a){var b=0,c=!1;for(b=0;b<a.length;b++)if(a[b].Selected()){c=!0;break}return c},EatingPreferenceModel.prototype.ScrollAndHighlightOptionDiv=function(a){var b=$("div.u_eat_pre");$(b).scrollTop($(b).scrollTop()+$(a).position().top-$(b).height()/2+$(a).height()/2)},EatingPreferenceModel.prototype.AllOptionsValidate=function(){var a=this,b=!1;return b=a.CuisinesSelected(),b?(b=a.PurposesSelected(),b?(b=a.DiningsSelected(),b?(b=a.DishesSelected(),b?(b=a.EatingHabitsSelected(),b?(b=a.DistrictsSelected(),b?(a.UnChecked(!1),!0):(a.UnChecked(!0),a.ScrollAndHighlightOptionDiv("#districts_div"),!1)):(a.UnChecked(!0),a.ScrollAndHighlightOptionDiv("#eatinghabits_div"),!1)):(a.UnChecked(!0),a.ScrollAndHighlightOptionDiv("#dishes_div"),!1)):(a.UnChecked(!0),a.ScrollAndHighlightOptionDiv("#dinings_div"),!1)):(a.UnChecked(!0),a.ScrollAndHighlightOptionDiv("#purposes_div"),!1)):(a.UnChecked(!0),a.ScrollAndHighlightOptionDiv("#cuisines_div"),!1)};var BasicInfoUpdateViewModel=function(a){self=this,self.firstName=ko.observable(a.FirstName),self.lastName=ko.observable(a.LastName),self.gender=ko.observable(a.Gender),self.dateOfBirthDay=ko.observable(a.DateOfBirthDay),self.dateOfBirthMonth=ko.observable(a.DateOfBirthMonth),self.dateOfBirthYear=ko.observable(a.DateOfBirthYear),self.availableDistricts=ko.observableArray(a.Districts),self.districtId=ko.observable(a.DistrictId),self.stateProvinceId=ko.observable(a.StateProvinceId),self.streetAddress=ko.observable(a.StreetAddress),self.customerAddressId=ko.observable(a.CustomerAddressId),self.phoneNumber=ko.observable(a.PhoneNumber),self.ErrMsg=ko.observable(""),self.validateBirthday=function(){return UpdateProfile.ValidateBirthday(self.dateOfBirthDay(),self.dateOfBirthMonth(),self.dateOfBirthYear())},self.IsSaving=ko.observable(!1),self.IsSavingSuccess=ko.observable(!1),self.IsSavingFail=ko.observable(!1),self.submit=function(){$("#updateMemberInfoForm").valid()&&self.validateBirthday()&&(self.ErrMsg(""),self.IsSaving()||(self.IsSaving(!0),self.IsSavingSuccess(!1),$.ajax({type:"POST",url:"/Account/UpdateBasicInfoAjax",data:ko.mapping.toJSON(self),success:function(a){a.success?(self.IsSavingSuccess(!0),updateProfileModel.userFullName(self.firstName()+" "+self.lastName()),updateProfileModel.autoChangeTab&&setTimeout(function(){$("."+updateAccTabs[1].menuClassName).click()},500)):(self.ErrMsg(a.msg),self.IsSavingFail(!0)),self.IsSaving(!1)},dataType:"json",contentType:"application/json"})))},self.loadDistricts=ko.computed(function(){if(self.stateProvinceId()!="undefined"&&self.stateProvinceId()!=null&&self.stateProvinceId()!=""){var a=new Date;$.get("/Common/GetDistrictsByProvinceId?provinceId="+self.stateProvinceId()+"&t="+a.getTime(),function(a){self.availableDistricts(a.data)})}})},tabModel=function(a,b,c,d,e,f){var g=this;g.menuClassName=a,g.contentClassName=b,g.displayText=d,g.isCurrent=ko.observable(c),g.id=e,g.isLoading=ko.observable(!1),g.key=f,g.isVerified=ko.observable(!1),this.finalClassName=ko.computed(function(){return this.isCurrent()==1?this.menuClassName+" mactive":this.menuClassName},this)},updateAccTabs=new Array(new tabModel("m_info","basic_info",!0,AccountText.BasicInfoTitle,1,1),new tabModel("m_avatar","avatar",!1,AccountText.AvatarTitle,2,2)),UpdateProfileModel=function(){var a=this;a.basicModel=ko.observable(null),a.eatingPreferencesModel=ko.observable(null),a.avatarModel=!1,a.isLoadingTab=ko.observable(!1),a.tabs=ko.observableArray(updateAccTabs),a.userFullName=ko.observable(""),a.autoChangeTab=!1,a.percentCompleted=ko.observable(0),a.changeTab=function(b){for(var c=0;c<a.tabs().length;c++){var d=a.tabs()[c];if(d.menuClassName!=b.menuClassName)d.isCurrent(!1),$("."+d.contentClassName).hide();else{d.isCurrent(!0),$("."+d.contentClassName).show();switch(d.id){case 1:a.loadBasicInfoModel(d);break;case 2:a.loadAvatar(d)}}}},a.diabledContent=ko.computed(function(){a.isLoadingTab()?$(".u_step2_content :input").attr("disabled",!0):$(".u_step2_content :input").attr("disabled",!1)}),a.loadBasicInfoModel=function(b){a.isLoadingTab(!0),b.isLoading(!0);var c=new Date;typeof basicInfoUpdateModel!="undefined"?(basicInfoUpdateModel.IsSavingSuccess(!1),basicInfoUpdateModel.IsSavingFail(!1),$.get("/Account/LoadUpdateBasicInfoJsonAjax?t="+c.getTime(),function(c){if(c.success){var d=c.data;basicInfoUpdateModel.firstName(d.FirstName),basicInfoUpdateModel.lastName(d.LastName),basicInfoUpdateModel.gender(d.Gender),basicInfoUpdateModel.dateOfBirthDay(d.DateOfBirthDay),basicInfoUpdateModel.dateOfBirthMonth(d.DateOfBirthMonth),basicInfoUpdateModel.dateOfBirthYear(d.DateOfBirthYear),basicInfoUpdateModel.availableDistricts(d.Districts),basicInfoUpdateModel.districtId(d.DistrictId),basicInfoUpdateModel.stateProvinceId()!=d.StateProvinceId&&basicInfoUpdateModel.stateProvinceId(d.StateProvinceId),basicInfoUpdateModel.streetAddress(d.StreetAddress),basicInfoUpdateModel.phoneNumber(d.PhoneNumber),a.updateVerifyProcess(d.Verify)}b.isLoading(!1),a.isLoadingTab(!1)})):(basicInfoUpdateModel.IsSavingSuccess(!1),basicInfoUpdateModel.IsSavingFail(!1),$.get("/Account/LoadUpdateBasicInfoAjax?t="+c.getTime(),function(c){c.success&&($("#basic-info-update-profile").html(c.html),a.updateVerifyProcess(c.data.Verify)),b.isLoading(!1),a.isLoadingTab(!1)}))},a.loadEatingPreferencesModel=function(b){b.isLoading(!0),a.isLoadingTab(!0);var c=new Date;if(updateEatingPreferenceModel!=null){updateEatingPreferenceModel.IsSavingSuccess(!1),updateEatingPreferenceModel.IsSavingFail(!1);var d=updateEatingPreferenceModel.ProvinceId(),e="/Account/LoadUpdateEatingPreferencesJsonAjax?t="+c.getTime();d!=null&&d!=0&&(e+="&provinceId="+d),$.get(e,function(c){if(c.success){var d=c.data;updateEatingPreferenceModel.Cuisines(EatingPreferenceModel.observableOptions(d.Cuisines)),updateEatingPreferenceModel.Purposes(EatingPreferenceModel.observableOptions(d.Purposes)),updateEatingPreferenceModel.Dinings(EatingPreferenceModel.observableOptions(d.Dinings)),updateEatingPreferenceModel.Dishes(EatingPreferenceModel.observableOptions(d.Dishes)),updateEatingPreferenceModel.EatingHabits(EatingPreferenceModel.observableOptions(d.EatingHabits)),updateEatingPreferenceModel.Districts(EatingPreferenceModel.observableOptions(d.Districts)),a.updateVerifyProcess(d.Verify)}b.isLoading(!1),a.isLoadingTab(!1)})}else $.get("/Account/LoadUpdateEatingPreferencesJsonAjax?t="+c.getTime(),function(c){c.success&&(loadUpdateEatingPreferences(c.data),a.updateVerifyProcess(c.data.Verify)),b.isLoading(!1),a.isLoadingTab(!1)})},a.loadAvatar=function(b){b.isLoading(!0),a.isLoadingTab(!0);var c=new Date;$.get("/Account/LoadUpdateAvatarAjax?t="+c.getTime(),function(c){c.success&&($("#avatar-update-profile").html(c.html),a.avatarModel=!0,a.updateVerifyProcess(c.data)),b.isLoading(!1),a.isLoadingTab(!1)})},a.updateVerifyProcess=function(b){a.percentCompleted(b.Percent);for(var c=0;c<b.Keys.length;c++)for(var d=0;d<a.tabs().length;d++)if(a.tabs()[d].key==b.Keys[c].KeyId){a.tabs()[d].isVerified(b.Keys[c].IsVerified);break}}};UpdateProfileModel.loadUpdateProfilePopup=function(a){$("#update-profile-popup-loading").modal(),$("#simplemodal-container").css("height","442px"),$(window).resize();if($("#update-profile-popup").children().length==0)$.get("/account/UpdateProfileAjax",function(b){b.success&&($.modal.close(),$("#update-profile-popup").html(b.html),$("#update-profile-popup").modal({persist:!0}),$("#simplemodal-container").css("height","442px"),$(window).resize(),a!=null?($("."+updateProfileModel.tabs()[a].menuClassName).click(),updateProfileModel.autoChangeTab=!1):(updateProfileModel.autoChangeTab=!0,$("."+updateProfileModel.tabs()[0].menuClassName).click()))});else{$.modal.close(),$("#update-profile-popup").modal({persist:!0});if(a!=null)$("."+updateProfileModel.tabs()[a].menuClassName).click(),updateProfileModel.autoChangeTab=!1;else{for(var b=0;b<updateProfileModel.tabs().length;b++)if(updateProfileModel.tabs()[b].isCurrent()){$("."+updateProfileModel.tabs()[b].menuClassName).click();break}updateProfileModel.autoChangeTab=!0,$("."+updateProfileModel.tabs()[0].menuClassName).click()}$("#simplemodal-container").css("height","440px"),$(window).resize()}},$(function(){$("a.update-foodee-button, a.profile-update-foodee-button").click(function(){angular.element('div[ng-controller="HelperCtrl"]').scope().ShowDlgLogin(function(a){a.LoggedIn&&($.modal.close(),window.justRegister?UpdateProfileModel.loadUpdateProfilePopup():UpdateProfileModel.loadUpdateProfilePopup(1))})})}),$("a.profile-verify-button").live("click",function(){angular.element('div[ng-controller="HelperCtrl"]').scope().ShowDlgLogin(function(a){a.LoggedIn&&UpdateProfileModel.loadUpdateProfilePopup()})})
;function PictureBasicInfo(a){var b=this;b.PictureUrl=a.PictureUrl,b.AbsolutePictureUrl=a.AbsolutePictureUrl,b.AbsoluteCroppedPictureUrl=a.AbsoluteCroppedPictureUrl}function PopupAvatarInfoModel(){var a=this;a.Avatar=ko.observable(new PictureBasicInfo({PictureUrl:"",AbsolutePictureUrl:"",AbsoluteCroppedPictureUrl:""})),a.LstHistoryAvatar=ko.observableArray([new PictureBasicInfo({PictureUrl:"",AbsolutePictureUrl:"",AbsoluteCroppedPictureUrl:""})]),a.LstDefaultAvatar=ko.observableArray([new PictureBasicInfo({PictureUrl:"",AbsolutePictureUrl:"",AbsoluteCroppedPictureUrl:""})]),a.UserId=-1,a.UserName="",a.IsExecuting=!1,a.Acc_Avatar_Remove_Confirm_Msg=""}PopupAvatarInfoModel.prototype.LoadData=function(){var a=this;$.ajax({url:"/Account/GetPopupMemberAvatarEditViewModel",type:"POST",contentType:"application/json",beforeSend:function(){CommonHelper.AjaxLoading(a,"uploadAjax","updateProfileLoading2")},success:function(b){CommonHelper.StopAjaxLoading(a,"uploadAjax","updateProfileLoading2"),b.Message==null||b.Message==""?a.BindData(b.Result):alert(b.Message)},error:function(b){CommonHelper.StopAjaxLoading(a,"uploadAjax","updateProfileLoading2")}})},PopupAvatarInfoModel.prototype.BindData=function(a){var b=this;a.Avatar!=null&&b.Avatar(new PictureBasicInfo(a.Avatar));if(a.LstHistoryAvatar!=null){var c=$.map(a.LstHistoryAvatar,function(a,b){if(b<4)return new PictureBasicInfo(a)});b.LstHistoryAvatar(c)}if(a.LstDefaultAvatar!=null){var d=$.map(a.LstDefaultAvatar,function(a){return new PictureBasicInfo(a)});b.LstDefaultAvatar(d)}b.SetSelectedAvatar(),$(".avatar-edit-right .list-avatar-item a[org-avatar-url]").click(function(){b.SelectAvatar(this)}),$("#imgPopupProfileMemberAvatar").attr("src",b.Avatar().AbsoluteCroppedPictureUrl)},PopupAvatarInfoModel.prototype.Uploadify=function(){var a=this,b=window.CONST_MEDIA_XUSER_TOKEN?CONST_MEDIA_XUSER_TOKEN:"FOODY.RequestVerificationToken";$("#popupPostedFile").uploadify({swf:CONST_MEDIA_UPLOAD_URL+"uploadify.swf",uploader:CONST_MEDIA_UPLOAD_URL+"upload/avatar?dimension=200",buttonClass:"uploadImage",width:109,height:109,buttonText:" ",multi:!1,sizeLimit:5242880,cancelImg:"/Scripts/uploadify/uploadify-cancel.png",auto:!0,formData:{"X-Foody-User-Token":readCookie(b)},onUploadStart:function(b){CommonHelper.AjaxLoading(a,"uploadAjax","updateProfileLoading2")},onUploadSuccess:function(b,c,d){CommonHelper.StopAjaxLoading(a,"uploadAjax","updateProfileLoading2"),c=jQuery.parseJSON(c),c=c[0];if(c.error==null||c.error==""){var e={fullname:c.name};$.ajax({url:"/Account/AvatarInfoUploadAvatar",data:JSON.stringify(e),type:"POST",contentType:"application/json",success:function(b){b.Message==null||b.Message==""?(a.LoadData(),updateProfileModel.updateVerifyProcess(c.Optional)):alert(b.Message)}})}else alert(c.error)},onUploadError:function(b,c,d,e){CommonHelper.StopAjaxLoading(a,"uploadAjax","updateProfileLoading2"),alert(e)}})},PopupAvatarInfoModel.prototype.SetSelectedAvatar=function(){var a=this;$(".avatar-edit-right .list-avatar-item a[org-avatar-url]").removeClass("selected"),$(".avatar-edit-right .list-avatar-item a[org-avatar-url='"+a.Avatar().PictureUrl+"']").addClass("selected")},PopupAvatarInfoModel.prototype.RemoveAvatar=function(){var a=this;a.IsExecuting||confirm(a.Acc_Avatar_Remove_Confirm_Msg)&&$.ajax({type:"POST",url:"/Account/RemoveUserAvatar",beforeSend:function(){CommonHelper.AjaxLoading(a,"uploadAjax","updateProfileLoading2")},success:function(b){CommonHelper.StopAjaxLoading(a,"uploadAjax","updateProfileLoading2"),b.success==1?(a.LoadData(),updateProfileModel.updateVerifyProcess(b.data)):alert("Remove avatar fail!")},error:function(b){CommonHelper.StopAjaxLoading(a,"uploadAjax","updateProfileLoading2")}})},PopupAvatarInfoModel.prototype.SelectAvatar=function(a){var b=this;if(!b.IsExecuting){var c=$(a).attr("org-avatar-url"),d=$(a).attr("default-avatar")==="true",e={avatar:c};$.ajax({url:"/Account/SelectAvatar",data:JSON.stringify(e),type:"POST",contentType:"application/json",beforeSend:function(){CommonHelper.AjaxLoading(b,"uploadAjax","updateProfileLoading2")},success:function(a){CommonHelper.StopAjaxLoading(b,"uploadAjax","updateProfileLoading2"),a.Message==null||a.Message==""?(b.LoadData(),updateProfileModel.updateVerifyProcess(e.Optional)):alert(a.Message)},error:function(a){CommonHelper.StopAjaxLoading(b,"uploadAjax","updateProfileLoading2")}})}},PopupAvatarInfoModel.prototype.Init=function(){var a=this;a.Uploadify(),$("#popupPostedFile-queue").hide(),a.LoadData()}
;var swfobject=function(){function A(){if(t)return;try{var a=i.getElementsByTagName("body")[0].appendChild(Q("span"));a.parentNode.removeChild(a)}catch(b){return}t=!0;var c=l.length;for(var d=0;d<c;d++)l[d]()}function B(a){t?a():l[l.length]=a}function C(b){if(typeof h.addEventListener!=a)h.addEventListener("load",b,!1);else if(typeof i.addEventListener!=a)i.addEventListener("load",b,!1);else if(typeof h.attachEvent!=a)R(h,"onload",b);else if(typeof h.onload=="function"){var c=h.onload;h.onload=function(){c(),b()}}else h.onload=b}function D(){k?E():F()}function E(){var c=i.getElementsByTagName("body")[0],d=Q(b);d.setAttribute("type",e);var f=c.appendChild(d);if(f){var g=0;(function(){if(typeof f.GetVariable!=a){var b=f.GetVariable("$version");b&&(b=b.split(" ")[1].split(","),y.pv=[parseInt(b[0],10),parseInt(b[1],10),parseInt(b[2],10)])}else if(g<10){g++,setTimeout(arguments.callee,10);return}c.removeChild(d),f=null,F()})()}else F()}function F(){var b=m.length;if(b>0)for(var c=0;c<b;c++){var d=m[c].id,e=m[c].callbackFn,f={success:!1,id:d};if(y.pv[0]>0){var g=P(d);if(g)if(S(m[c].swfVersion)&&!(y.wk&&y.wk<312))U(d,!0),e&&(f.success=!0,f.ref=G(d),e(f));else if(m[c].expressInstall&&H()){var h={};h.data=m[c].expressInstall,h.width=g.getAttribute("width")||"0",h.height=g.getAttribute("height")||"0",g.getAttribute("class")&&(h.styleclass=g.getAttribute("class")),g.getAttribute("align")&&(h.align=g.getAttribute("align"));var i={},j=g.getElementsByTagName("param"),k=j.length;for(var l=0;l<k;l++)j[l].getAttribute("name").toLowerCase()!="movie"&&(i[j[l].getAttribute("name")]=j[l].getAttribute("value"));I(h,i,d,e)}else J(g),e&&e(f)}else{U(d,!0);if(e){var n=G(d);n&&typeof n.SetVariable!=a&&(f.success=!0,f.ref=n),e(f)}}}}function G(c){var d=null,e=P(c);if(e&&e.nodeName=="OBJECT")if(typeof e.SetVariable!=a)d=e;else{var f=e.getElementsByTagName(b)[0];f&&(d=f)}return d}function H(){return!u&&S("6.0.65")&&(y.win||y.mac)&&!(y.wk&&y.wk<312)}function I(b,c,d,e){u=!0,r=e||null,s={success:!1,id:d};var g=P(d);if(g){g.nodeName=="OBJECT"?(p=K(g),q=null):(p=g,q=d),b.id=f;if(typeof b.width==a||!/%$/.test(b.width)&&parseInt(b.width,10)<310)b.width="310";if(typeof b.height==a||!/%$/.test(b.height)&&parseInt(b.height,10)<137)b.height="137";i.title=i.title.slice(0,47)+" - Flash Player Installation";var j=y.ie&&y.win?"ActiveX":"PlugIn",k="MMredirectURL="+h.location.toString().replace(/&/g,"%26")+"&MMplayerType="+j+"&MMdoctitle="+i.title;typeof c.flashvars!=a?c.flashvars+="&"+k:c.flashvars=k;if(y.ie&&y.win&&g.readyState!=4){var l=Q("div");d+="SWFObjectNew",l.setAttribute("id",d),g.parentNode.insertBefore(l,g),g.style.display="none",function(){g.readyState==4?g.parentNode.removeChild(g):setTimeout(arguments.callee,10)}()}L(b,c,d)}}function J(a){if(y.ie&&y.win&&a.readyState!=4){var b=Q("div");a.parentNode.insertBefore(b,a),b.parentNode.replaceChild(K(a),b),a.style.display="none",function(){a.readyState==4?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)}()}else a.parentNode.replaceChild(K(a),a)}function K(a){var c=Q("div");if(y.win&&y.ie)c.innerHTML=a.innerHTML;else{var d=a.getElementsByTagName(b)[0];if(d){var e=d.childNodes;if(e){var f=e.length;for(var g=0;g<f;g++)(e[g].nodeType!=1||e[g].nodeName!="PARAM")&&e[g].nodeType!=8&&c.appendChild(e[g].cloneNode(!0))}}}return c}function L(c,d,f){var g,h=P(f);if(y.wk&&y.wk<312)return g;if(h){typeof c.id==a&&(c.id=f);if(y.ie&&y.win){var i="";for(var j in c)c[j]!=Object.prototype[j]&&(j.toLowerCase()=="data"?d.movie=c[j]:j.toLowerCase()=="styleclass"?i+=' class="'+c[j]+'"':j.toLowerCase()!="classid"&&(i+=" "+j+'="'+c[j]+'"'));var k="";for(var l in d)d[l]!=Object.prototype[l]&&(k+='<param name="'+l+'" value="'+d[l]+'" />');h.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+i+">"+k+"</object>",n[n.length]=c.id,g=P(c.id)}else{var m=Q(b);m.setAttribute("type",e);for(var o in c)c[o]!=Object.prototype[o]&&(o.toLowerCase()=="styleclass"?m.setAttribute("class",c[o]):o.toLowerCase()!="classid"&&m.setAttribute(o,c[o]));for(var p in d)d[p]!=Object.prototype[p]&&p.toLowerCase()!="movie"&&M(m,p,d[p]);h.parentNode.replaceChild(m,h),g=m}}return g}function M(a,b,c){var d=Q("param");d.setAttribute("name",b),d.setAttribute("value",c),a.appendChild(d)}function N(a){var b=P(a);b&&b.nodeName=="OBJECT"&&(y.ie&&y.win?(b.style.display="none",function(){b.readyState==4?O(a):setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function O(a){var b=P(a);if(b){for(var c in b)typeof b[c]=="function"&&(b[c]=null);b.parentNode.removeChild(b)}}function P(a){var b=null;try{b=i.getElementById(a)}catch(c){}return b}function Q(a){return i.createElement(a)}function R(a,b,c){a.attachEvent(b,c),o[o.length]=[a,b,c]}function S(a){var b=y.pv,c=a.split(".");return c[0]=parseInt(c[0],10),c[1]=parseInt(c[1],10)||0,c[2]=parseInt(c[2],10)||0,b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]?!0:!1}function T(c,d,e,f){if(y.ie&&y.mac)return;var g=i.getElementsByTagName("head")[0];if(!g)return;var h=e&&typeof e=="string"?e:"screen";f&&(v=null,w=null);if(!v||w!=h){var j=Q("style");j.setAttribute("type","text/css"),j.setAttribute("media",h),v=g.appendChild(j),y.ie&&y.win&&typeof i.styleSheets!=a&&i.styleSheets.length>0&&(v=i.styleSheets[i.styleSheets.length-1]),w=h}y.ie&&y.win?v&&typeof v.addRule==b&&v.addRule(c,d):v&&typeof i.createTextNode!=a&&v.appendChild(i.createTextNode(c+" {"+d+"}"))}function U(a,b){if(!x)return;var c=b?"visible":"hidden";t&&P(a)?P(a).style.visibility=c:T("#"+a,"visibility:"+c)}function V(b){var c=/[\\\"<>\.;]/,d=c.exec(b)!=null;return d&&typeof encodeURIComponent!=a?encodeURIComponent(b):b}var a="undefined",b="object",c="Shockwave Flash",d="ShockwaveFlash.ShockwaveFlash",e="application/x-shockwave-flash",f="SWFObjectExprInst",g="onreadystatechange",h=window,i=document,j=navigator,k=!1,l=[D],m=[],n=[],o=[],p,q,r,s,t=!1,u=!1,v,w,x=!0,y=function(){var f=typeof i.getElementById!=a&&typeof i.getElementsByTagName!=a&&typeof i.createElement!=a,g=j.userAgent.toLowerCase(),l=j.platform.toLowerCase(),m=l?/win/.test(l):/win/.test(g),n=l?/mac/.test(l):/mac/.test(g),o=/webkit/.test(g)?parseFloat(g.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,p=!1,q=[0,0,0],r=null;if(typeof j.plugins!=a&&typeof j.plugins[c]==b)r=j.plugins[c].description,r&&(typeof j.mimeTypes==a||!j.mimeTypes[e]||!!j.mimeTypes[e].enabledPlugin)&&(k=!0,p=!1,r=r.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),q[0]=parseInt(r.replace(/^(.*)\..*$/,"$1"),10),q[1]=parseInt(r.replace(/^.*\.(.*)\s.*$/,"$1"),10),q[2]=/[a-zA-Z]/.test(r)?parseInt(r.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof h.ActiveXObject!=a)try{var s=new ActiveXObject(d);s&&(r=s.GetVariable("$version"),r&&(p=!0,r=r.split(" ")[1].split(","),q=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)]))}catch(t){}return{w3:f,pv:q,wk:o,ie:p,win:m,mac:n}}(),z=function(){if(!y.w3)return;(typeof i.readyState!=a&&i.readyState=="complete"||typeof i.readyState==a&&(i.getElementsByTagName("body")[0]||i.body))&&A(),t||(typeof i.addEventListener!=a&&i.addEventListener("DOMContentLoaded",A,!1),y.ie&&y.win&&(i.attachEvent(g,function(){i.readyState=="complete"&&(i.detachEvent(g,arguments.callee),A())}),h==top&&function(){if(t)return;try{i.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}A()}()),y.wk&&function(){if(t)return;if(!/loaded|complete/.test(i.readyState)){setTimeout(arguments.callee,0);return}A()}(),C(A))}(),W=function(){y.ie&&y.win&&window.attachEvent("onunload",function(){var a=o.length;for(var b=0;b<a;b++)o[b][0].detachEvent(o[b][1],o[b][2]);var c=n.length;for(var d=0;d<c;d++)N(n[d]);for(var e in y)y[e]=null;y=null;for(var f in swfobject)swfobject[f]=null;swfobject=null})}();return{registerObject:function(a,b,c,d){if(y.w3&&a&&b){var e={};e.id=a,e.swfVersion=b,e.expressInstall=c,e.callbackFn=d,m[m.length]=e,U(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(y.w3)return G(a)},embedSWF:function(c,d,e,f,g,h,i,j,k,l){var m={success:!1,id:d};y.w3&&!(y.wk&&y.wk<312)&&c&&d&&e&&f&&g?(U(d,!1),B(function(){e+="",f+="";var n={};if(k&&typeof k===b)for(var o in k)n[o]=k[o];n.data=c,n.width=e,n.height=f;var p={};if(j&&typeof j===b)for(var q in j)p[q]=j[q];if(i&&typeof i===b)for(var r in i)typeof p.flashvars!=a?p.flashvars+="&"+r+"="+i[r]:p.flashvars=r+"="+i[r];if(S(g)){var s=L(n,p,d);n.id==d&&U(d,!0),m.success=!0,m.ref=s}else{if(h&&H()){n.data=h,I(n,p,d,l);return}U(d,!0)}l&&l(m)})):l&&l(m)},switchOffAutoHideShow:function(){x=!1},ua:y,getFlashPlayerVersion:function(){return{major:y.pv[0],minor:y.pv[1],release:y.pv[2]}},hasFlashPlayerVersion:S,createSWF:function(a,b,c){return y.w3?L(a,b,c):undefined},showExpressInstall:function(a,b,c,d){y.w3&&H()&&I(a,b,c,d)},removeSWF:function(a){y.w3&&N(a)},createCSS:function(a,b,c,d){y.w3&&T(a,b,c,d)},addDomLoadEvent:B,addLoadEvent:C,getQueryParamValue:function(a){var b=i.location.search||i.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(a==null)return V(b);var c=b.split("&");for(var d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return V(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(u){var a=P(f);a&&p&&(a.parentNode.replaceChild(p,a),q&&(U(q,!0),y.ie&&y.win&&(p.style.display="block")),r&&r(s)),u=!1}}}}(),SWFUpload;SWFUpload==undefined&&(SWFUpload=function(a){this.initSWFUpload(a)}),SWFUpload.prototype.initSWFUpload=function(a){try{this.customSettings={},this.settings=a,this.eventQueue=[],this.movieName="SWFUpload_"+SWFUpload.movieCount++,this.movieElement=null,SWFUpload.instances[this.movieName]=this,this.initSettings(),this.loadFlash(),this.displayDebugInfo()}catch(b){throw delete SWFUpload.instances[this.movieName],b}},SWFUpload.instances={},SWFUpload.movieCount=0,SWFUpload.version="2.2.0 2009-03-25",SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130},SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290},SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5},SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120},SWFUpload.CURSOR={ARROW:-1,HAND:-2},SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"},SWFUpload.completeURL=function(a){if(typeof a!="string"||a.match(/^https?:\/\//i)||a.match(/^\//))return a;var b=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),c=window.location.pathname.lastIndexOf("/");return c<=0?path="/":path=window.location.pathname.substr(0,c)+"/",path+a},SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(a,b){this.settings[a]=this.settings[a]==undefined?b:this.settings[a]},this.ensureDefault("upload_url",""),this.ensureDefault("preserve_relative_urls",!1),this.ensureDefault("file_post_name","Filedata"),this.ensureDefault("post_params",{}),this.ensureDefault("use_query_string",!1),this.ensureDefault("requeue_on_error",!1),this.ensureDefault("http_success",[]),this.ensureDefault("assume_success_timeout",0),this.ensureDefault("file_types","*.*"),this.ensureDefault("file_types_description","All Files"),this.ensureDefault("file_size_limit",0),this.ensureDefault("file_upload_limit",0),this.ensureDefault("file_queue_limit",0),this.ensureDefault("flash_url","swfupload.swf"),this.ensureDefault("prevent_swf_caching",!0),this.ensureDefault("button_image_url",""),this.ensureDefault("button_width",1),this.ensureDefault("button_height",1),this.ensureDefault("button_text",""),this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;"),this.ensureDefault("button_text_top_padding",0),this.ensureDefault("button_text_left_padding",0),this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES),this.ensureDefault("button_disabled",!1),this.ensureDefault("button_placeholder_id",""),this.ensureDefault("button_placeholder",null),this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW),this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW),this.ensureDefault("debug",!1),this.settings.debug_enabled=this.settings.debug,this.settings.return_upload_start_handler=this.returnUploadStart,this.ensureDefault("swfupload_loaded_handler",null),this.ensureDefault("file_dialog_start_handler",null),this.ensureDefault("file_queued_handler",null),this.ensureDefault("file_queue_error_handler",null),this.ensureDefault("file_dialog_complete_handler",null),this.ensureDefault("upload_start_handler",null),this.ensureDefault("upload_progress_handler",null),this.ensureDefault("upload_error_handler",null),this.ensureDefault("upload_success_handler",null),this.ensureDefault("upload_complete_handler",null),this.ensureDefault("debug_handler",this.debugMessage),this.ensureDefault("custom_settings",{}),this.customSettings=this.settings.custom_settings,!this.settings.prevent_swf_caching||(this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+(new Date).getTime()),this.settings.preserve_relative_urls||(this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url),this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url)),delete this.ensureDefault},SWFUpload.prototype.loadFlash=function(){var a,b;if(document.getElementById(this.movieName)!==null)throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";a=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder;if(a==undefined)throw"Could not find the placeholder element: "+this.settings.button_placeholder_id;b=document.createElement("div"),b.innerHTML=this.getFlashHTML(),a.parentNode.replaceChild(b.firstChild,a),window[this.movieName]==undefined&&(window[this.movieName]=this.getMovieElement())},SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")},SWFUpload.prototype.getFlashVars=function(){var a=this.buildParamString(),b=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(b),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(a),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")},SWFUpload.prototype.getMovieElement=function(){this.movieElement==undefined&&(this.movieElement=document.getElementById(this.movieName));if(this.movieElement===null)throw"Could not find Flash element";return this.movieElement},SWFUpload.prototype.buildParamString=function(){var a=this.settings.post_params,b=[];if(typeof a=="object")for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c.toString())+"="+encodeURIComponent(a[c].toString()));return b.join("&amp;")},SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,!1);var a=null;a=this.getMovieElement();if(a&&typeof a.CallFunction=="unknown"){for(var b in a)try{typeof a[b]=="function"&&(a[b]=null)}catch(c){}try{a.parentNode.removeChild(a)}catch(d){}}return window[this.movieName]=null,SWFUpload.instances[this.movieName]=null,delete SWFUpload.instances[this.movieName],this.movieElement=null,this.settings=null,this.customSettings=null,this.eventQueue=null,this.movieName=null,!0}catch(e){return!1}},SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","\t","upload_url:               ",this.settings.upload_url,"\n","\t","flash_url:                ",this.settings.flash_url,"\n","\t","use_query_string:         ",this.settings.use_query_string.toString(),"\n","\t","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","\t","http_success:             ",this.settings.http_success.join(", "),"\n","\t","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","\t","file_post_name:           ",this.settings.file_post_name,"\n","\t","post_params:              ",this.settings.post_params.toString(),"\n","\t","file_types:               ",this.settings.file_types,"\n","\t","file_types_description:   ",this.settings.file_types_description,"\n","\t","file_size_limit:          ",this.settings.file_size_limit,"\n","\t","file_upload_limit:        ",this.settings.file_upload_limit,"\n","\t","file_queue_limit:         ",this.settings.file_queue_limit,"\n","\t","debug:                    ",this.settings.debug.toString(),"\n","\t","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","\t","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","\t","button_placeholder:       ",this.settings.button_placeholder?"Set":"Not Set","\n","\t","button_image_url:         ",this.settings.button_image_url.toString(),"\n","\t","button_width:             ",this.settings.button_width.toString(),"\n","\t","button_height:            ",this.settings.button_height.toString(),"\n","\t","button_text:              ",this.settings.button_text.toString(),"\n","\t","button_text_style:        ",this.settings.button_text_style.toString(),"\n","\t","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","\t","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","\t","button_action:            ",this.settings.button_action.toString(),"\n","\t","button_disabled:          ",this.settings.button_disabled.toString(),"\n","\t","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","\t","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler=="function").toString(),"\n","\t","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler=="function").toString(),"\n","\t","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler=="function").toString(),"\n","\t","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler=="function").toString(),"\n","\t","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler=="function").toString(),"\n","\t","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler=="function").toString(),"\n","\t","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler=="function").toString(),"\n","\t","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler=="function").toString(),"\n","\t","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler=="function").toString(),"\n","\t","debug_handler assigned:             ",(typeof this.settings.debug_handler=="function").toString(),"\n"].join(""))},SWFUpload.prototype.addSetting=function(a,b,c){return b==undefined?this.settings[a]=c:this.settings[a]=b},SWFUpload.prototype.getSetting=function(a){return this.settings[a]!=undefined?this.settings[a]:""},SWFUpload.prototype.callFlash=function(functionName,argumentArray){argumentArray=argumentArray||[];var movieElement=this.getMovieElement(),returnValue,returnString;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+"</invoke>"),returnValue=eval(returnString)}catch(ex){throw"Call to "+functionName+" failed"}return returnValue!=undefined&&typeof returnValue.post=="object"&&(returnValue=this.unescapeFilePostParams(returnValue)),returnValue},SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")},SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")},SWFUpload.prototype.startUpload=function(a){this.callFlash("StartUpload",[a])},SWFUpload.prototype.cancelUpload=function(a,b){b!==!1&&(b=!0),this.callFlash("CancelUpload",[a,b])},SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")},SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")},SWFUpload.prototype.setStats=function(a){this.callFlash("SetStats",[a])},SWFUpload.prototype.getFile=function(a){return typeof a=="number"?this.callFlash("GetFileByIndex",[a]):this.callFlash("GetFile",[a])},SWFUpload.prototype.addFileParam=function(a,b,c){return this.callFlash("AddFileParam",[a,b,c])},SWFUpload.prototype.removeFileParam=function(a,b){this.callFlash("RemoveFileParam",[a,b])},SWFUpload.prototype.setUploadURL=function(a){this.settings.upload_url=a.toString(),this.callFlash("SetUploadURL",[a])},SWFUpload.prototype.setPostParams=function(a){this.settings.post_params=a,this.callFlash("SetPostParams",[a])},SWFUpload.prototype.addPostParam=function(a,b){this.settings.post_params[a]=b,this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.removePostParam=function(a){delete this.settings.post_params[a],this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.setFileTypes=function(a,b){this.settings.file_types=a,this.settings.file_types_description=b,this.callFlash("SetFileTypes",[a,b])},SWFUpload.prototype.setFileSizeLimit=function(a){this.settings.file_size_limit=a,this.callFlash("SetFileSizeLimit",[a])},SWFUpload.prototype.setFileUploadLimit=function(a){this.settings.file_upload_limit=a,this.callFlash("SetFileUploadLimit",[a])},SWFUpload.prototype.setFileQueueLimit=function(a){this.settings.file_queue_limit=a,this.callFlash("SetFileQueueLimit",[a])},SWFUpload.prototype.setFilePostName=function(a){this.settings.file_post_name=a,this.callFlash("SetFilePostName",[a])},SWFUpload.prototype.setUseQueryString=function(a){this.settings.use_query_string=a,this.callFlash("SetUseQueryString",[a])},SWFUpload.prototype.setRequeueOnError=function(a){this.settings.requeue_on_error=a,this.callFlash("SetRequeueOnError",[a])},SWFUpload.prototype.setHTTPSuccess=function(a){typeof a=="string"&&(a=a.replace(" ","").split(",")),this.settings.http_success=a,this.callFlash("SetHTTPSuccess",[a])},SWFUpload.prototype.setAssumeSuccessTimeout=function(a){this.settings.assume_success_timeout=a,this.callFlash("SetAssumeSuccessTimeout",[a])},SWFUpload.prototype.setDebugEnabled=function(a){this.settings.debug_enabled=a,this.callFlash("SetDebugEnabled",[a])},SWFUpload.prototype.setButtonImageURL=function(a){a==undefined&&(a=""),this.settings.button_image_url=a,this.callFlash("SetButtonImageURL",[a])},SWFUpload.prototype.setButtonDimensions=function(a,b){this.settings.button_width=a,this.settings.button_height=b;var c=this.getMovieElement();c!=undefined&&(c.style.width=a+"px",c.style.height=b+"px"),this.callFlash("SetButtonDimensions",[a,b])},SWFUpload.prototype.setButtonText=function(a){this.settings.button_text=a,this.callFlash("SetButtonText",[a])},SWFUpload.prototype.setButtonTextPadding=function(a,b){this.settings.button_text_top_padding=b,this.settings.button_text_left_padding=a,this.callFlash("SetButtonTextPadding",[a,b])},SWFUpload.prototype.setButtonTextStyle=function(a){this.settings.button_text_style=a,this.callFlash("SetButtonTextStyle",[a])},SWFUpload.prototype.setButtonDisabled=function(a){this.settings.button_disabled=a,this.callFlash("SetButtonDisabled",[a])},SWFUpload.prototype.setButtonAction=function(a){this.settings.button_action=a,this.callFlash("SetButtonAction",[a])},SWFUpload.prototype.setButtonCursor=function(a){this.settings.button_cursor=a,this.callFlash("SetButtonCursor",[a])},SWFUpload.prototype.queueEvent=function(a,b){b==undefined?b=[]:b instanceof Array||(b=[b]);var c=this;if(typeof this.settings[a]=="function")this.eventQueue.push(function(){this.settings[a].apply(this,b)}),setTimeout(function(){c.executeNextEvent()},0);else if(this.settings[a]!==null)throw"Event handler "+a+" is unknown or is not a function"},SWFUpload.prototype.executeNextEvent=function(){var a=this.eventQueue?this.eventQueue.shift():null;typeof a=="function"&&a.apply(this)},SWFUpload.prototype.unescapeFilePostParams=function(a){var b=/[$]([0-9a-f]{4})/i,c={},d;if(a!=undefined){for(var e in a.post)if(a.post.hasOwnProperty(e)){d=e;var f;while((f=b.exec(d))!==null)d=d.replace(f[0],String.fromCharCode(parseInt("0x"+f[1],16)));c[d]=a.post[e]}a.post=c}return a},SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface")}catch(a){return!1}},SWFUpload.prototype.flashReady=function(){var a=this.getMovieElement();if(!a){this.debug("Flash called back ready but the flash movie can't be found.");return}this.cleanUp(a),this.queueEvent("swfupload_loaded_handler")},SWFUpload.prototype.cleanUp=function(a){try{if(this.movieElement&&typeof a.CallFunction=="unknown"){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var b in a)try{typeof a[b]=="function"&&(a[b]=null)}catch(c){}}}catch(d){}window.__flash__removeCallback=function(a,b){try{a&&(a[b]=null)}catch(c){}}},SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")},SWFUpload.prototype.fileQueued=function(a){a=this.unescapeFilePostParams(a),this.queueEvent("file_queued_handler",a)},SWFUpload.prototype.fileQueueError=function(a,b,c){a=this.unescapeFilePostParams(a),this.queueEvent("file_queue_error_handler",[a,b,c])},SWFUpload.prototype.fileDialogComplete=function(a,b,c){this.queueEvent("file_dialog_complete_handler",[a,b,c])},SWFUpload.prototype.uploadStart=function(a){a=this.unescapeFilePostParams(a),this.queueEvent("return_upload_start_handler",a)},SWFUpload.prototype.returnUploadStart=function(a){var b;if(typeof this.settings.upload_start_handler=="function")a=this.unescapeFilePostParams(a),b=this.settings.upload_start_handler.call(this,a);else if(this.settings.upload_start_handler!=undefined)throw"upload_start_handler must be a function";b===undefined&&(b=!0),b=!!b,this.callFlash("ReturnUploadStart",[b])},SWFUpload.prototype.uploadProgress=function(a,b,c){a=this.unescapeFilePostParams(a),this.queueEvent("upload_progress_handler",[a,b,c])},SWFUpload.prototype.uploadError=function(a,b,c){a=this.unescapeFilePostParams(a),this.queueEvent("upload_error_handler",[a,b,c])},SWFUpload.prototype.uploadSuccess=function(a,b,c){a=this.unescapeFilePostParams(a),this.queueEvent("upload_success_handler",[a,b,c])},SWFUpload.prototype.uploadComplete=function(a){a=this.unescapeFilePostParams(a),this.queueEvent("upload_complete_handler",a)},SWFUpload.prototype.debug=function(a){this.queueEvent("debug_handler",a)},SWFUpload.prototype.debugMessage=function(a){if(this.settings.debug){var b,c=[];if(typeof a=="object"&&typeof a.name=="string"&&typeof a.message=="string"){for(var d in a)a.hasOwnProperty(d)&&c.push(d+": "+a[d]);b=c.join("\n")||"",c=b.split("\n"),b="EXCEPTION: "+c.join("\nEXCEPTION: "),SWFUpload.Console.writeLine(b)}else SWFUpload.Console.writeLine(a)}},SWFUpload.Console={},SWFUpload.Console.writeLine=function(a){var b,c;try{b=document.getElementById("SWFUpload_Console"),b||(c=document.createElement("form"),document.getElementsByTagName("body")[0].appendChild(c),b=document.createElement("textarea"),b.id="SWFUpload_Console",b.style.fontFamily="monospace",b.setAttribute("wrap","off"),b.wrap="off",b.style.overflow="auto",b.style.width="700px",b.style.height="350px",b.style.margin="5px",c.appendChild(b)),b.value+=a+"\n",b.scrollTop=b.scrollHeight-b.clientHeight}catch(d){alert("Exception: "+d.name+" Message: "+d.message)}},function(a){var b={init:function(b,d){return this.each(function(){var e=a(this),f=e.clone(),g=a.extend({id:e.attr("id"),swf:"uploadify.swf",uploader:"uploadify.php",auto:!0,buttonClass:"",buttonCursor:"hand",buttonImage:null,buttonText:"SELECT FILES",checkExisting:!1,debug:!1,fileObjName:"Filedata",fileSizeLimit:0,fileTypeDesc:"All Files",fileTypeExts:"*.*",height:30,method:"post",multi:!0,formData:{},preventCaching:!0,progressData:"percentage",queueID:!1,queueSizeLimit:999,removeCompleted:!0,removeTimeout:3,requeueErrors:!1,successTimeout:300,uploadLimit:0,width:120,overrideEvents:[]},b),h={assume_success_timeout:g.successTimeout,button_placeholder_id:g.id,button_width:g.width,button_height:g.height,button_text:null,button_text_style:null,button_text_top_padding:0,button_text_left_padding:0,button_action:g.multi?SWFUpload.BUTTON_ACTION.SELECT_FILES:SWFUpload.BUTTON_ACTION.SELECT_FILE,button_disabled:!1,button_cursor:g.buttonCursor=="arrow"?SWFUpload.CURSOR.ARROW:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,debug:g.debug,requeue_on_error:g.requeueErrors,file_post_name:g.fileObjName,file_size_limit:g.fileSizeLimit,file_types:g.fileTypeExts,file_types_description:g.fileTypeDesc,file_queue_limit:g.queueSizeLimit,file_upload_limit:g.uploadLimit,flash_url:g.swf,prevent_swf_caching:g.preventCaching,post_params:g.formData,upload_url:g.uploader,use_query_string:g.method=="get",file_dialog_complete_handler:c.onDialogClose,file_dialog_start_handler:c.onDialogOpen,file_queued_handler:c.onSelect,file_queue_error_handler:c.onSelectError,swfupload_loaded_handler:g.onSWFReady,upload_complete_handler:c.onUploadComplete,upload_error_handler:c.onUploadError,upload_progress_handler:c.onUploadProgress,upload_start_handler:c.onUploadStart,upload_success_handler:c.onUploadSuccess};d&&(h=a.extend(h,d)),h=a.extend(h,g);var i=swfobject.getFlashPlayerVersion(),j=i.major>=9;if(j){window["uploadify_"+g.id]=new SWFUpload(h);var k=window["uploadify_"+g.id];e.data("uploadify",k);var l=a("<div />",{id:g.id,"class":"uploadify",css:{height:g.height+"px",width:g.width+"px"}});a("#"+k.movieName).wrap(l),l=a("#"+g.id),l.data("uploadify",k);var m=a("<div />",{id:g.id+"-button","class":"uploadify-button "+g.buttonClass});g.buttonImage&&m.css({"background-image":"url('"+g.buttonImage+"')","text-indent":"-9999px"}),m.html('<span class="uploadify-button-text">'+g.buttonText+"</span>").css({height:g.height+"px","line-height":g.height+"px",width:g.width+"px"}),l.append(m),a("#"+k.movieName).css({position:"absolute","z-index":1});if(!g.queueID){var n=a("<div />",{id:g.id+"-queue","class":"uploadify-queue"});l.after(n),k.settings.queueID=g.id+"-queue",k.settings.defaultQueue=!0}k.queueData={files:{},filesSelected:0,filesQueued:0,filesReplaced:0,filesCancelled:0,filesErrored:0,uploadsSuccessful:0,uploadsErrored:0,averageSpeed:0,queueLength:0,queueSize:0,uploadSize:0,queueBytesUploaded:0,uploadQueue:[],errorMsg:"Some files were not added to the queue:"},k.original=f,k.wrapper=l,k.button=m,k.queue=n,g.onInit&&g.onInit.call(e,k)}else g.onFallback&&g.onFallback.call(e)})},cancel:function(b,c){var d=arguments;this.each(function(){var b=a(this),c=b.data("uploadify"),e=c.settings,f=-1;if(d[0])if(d[0]=="*"){var g=c.queueData.queueLength;a("#"+e.queueID).find(".uploadify-queue-item").each(function(){f++,d[1]===!0?c.cancelUpload(a(this).attr("id"),!1):c.cancelUpload(a(this).attr("id")),a(this).find(".data").removeClass("data").html(" - Cancelled"),a(this).find(".uploadify-progress-bar").remove(),a(this).find(".uploadify-progress-bar-profile").remove(),a(this).delay(1e3+100*f).fadeOut(500,function(){a(this).remove()})}),c.queueData.queueSize=0,c.queueData.queueLength=0,e.onClearQueue&&e.onClearQueue.call(b,g)}else for(var h=0;h<d.length;h++)c.cancelUpload(d[h]),a("#"+d[h]).find(".data").removeClass("data").html(" - Cancelled"),a("#"+d[h]).find(".uploadify-progress-bar").remove(),a("#"+d[h]).find(".uploadify-progress-bar-profile").remove(),a("#"+d[h]).delay(1e3+100*h).fadeOut(50,function(){a(this).remove()});else{var i=a("#"+e.queueID).find(".uploadify-queue-item").get(0);$item=a(i),c.cancelUpload($item.attr("id")),$item.find(".data").removeClass("data").html(" - Cancelled"),$item.find(".uploadify-progress-bar").remove(),$item.find(".uploadify-progress-bar-profile").remove(),$item.delay(1e3).fadeOut(50,function(){a(this).remove()})}})},destroy:function(){this.each(function(){var b=a(this),c=b.data("uploadify"),d=c.settings;c.destroy(),d.defaultQueue&&a("#"+d.queueID).remove(),a("#"+d.id).replaceWith(c.original),d.onDestroy&&d.onDestroy.call(this),delete c})},disable:function(b){this.each(function(){var c=a(this),d=c.data("uploadify"),e=d.settings;b?(d.button.addClass("disabled"),e.onDisable&&e.onDisable.call(this)):(d.button.removeClass("disabled"),e.onEnable&&e.onEnable.call(this)),d.setButtonDisabled(b)})},settings:function(b,c,d){var e=arguments,f=c;this.each(function(){var g=a(this),h=g.data("uploadify"),i=h.settings;if(typeof e[0]=="object")for(var j in c)setData(j,c[j]);if(e.length===1)f=i[b];else{switch(b){case"uploader":h.setUploadURL(c);break;case"formData":d||(c=a.extend(i.formData,c)),h.setPostParams(i.formData);break;case"method":c=="get"?h.setUseQueryString(!0):h.setUseQueryString(!1);break;case"fileObjName":h.setFilePostName(c);break;case"fileTypeExts":h.setFileTypes(c,i.fileTypeDesc);break;case"fileTypeDesc":h.setFileTypes(i.fileTypeExts,c);break;case"fileSizeLimit":h.setFileSizeLimit(c);break;case"uploadLimit":h.setFileUploadLimit(c);break;case"queueSizeLimit":h.setFileQueueLimit(c);break;case"buttonImage":h.button.css("background-image",settingValue);break;case"buttonCursor":c=="arrow"?h.setButtonCursor(SWFUpload.CURSOR.ARROW):h.setButtonCursor(SWFUpload.CURSOR.HAND);break;case"buttonText":a("#"+i.id+"-button").find(".uploadify-button-text").html(c);break;case"width":h.setButtonDimensions(c,i.height);break;case"height":h.setButtonDimensions(i.width,c);break;case"multi":c?h.setButtonAction(SWFUpload.BUTTON_ACTION.SELECT_FILES):h.setButtonAction(SWFUpload.BUTTON_ACTION.SELECT_FILE)}i[b]=c}});if(e.length===1)return f},stop:function(){this.each(function(){var b=a(this),c=b.data("uploadify");c.queueData.averageSpeed=0,c.queueData.uploadSize=0,c.queueData.bytesUploaded=0,c.queueData.uploadQueue=[],c.stopUpload()})},upload:function(){var b=arguments;this.each(function(){var c=a(this),d=c.data("uploadify");d.queueData.averageSpeed=0,d.queueData.uploadSize=0,d.queueData.bytesUploaded=0,d.queueData.uploadQueue=[];if(b[0])if(b[0]=="*")d.queueData.uploadSize=d.queueData.queueSize,d.queueData.uploadQueue.push("*"),d.startUpload();else{for(var e=0;e<b.length;e++)d.queueData.uploadSize+=d.queueData.files[b[e]].size,d.queueData.uploadQueue.push(b[e]);d.startUpload(d.queueData.uploadQueue.shift())}else d.startUpload()})}},c={onDialogOpen:function(){var a=this.settings;this.queueData.errorMsg="Some files were not added to the queue:",this.queueData.filesReplaced=0,this.queueData.filesCancelled=0,a.onDialogOpen&&a.onDialogOpen.call(this)},onDialogClose:function(b,c,d){var e=this.settings;this.queueData.filesErrored=b-c,this.queueData.filesSelected=b,this.queueData.filesQueued=c-this.queueData.filesCancelled,this.queueData.queueLength=d,a.inArray("onDialogClose",e.overrideEvents)<0&&this.queueData.filesErrored>0&&alert(this.queueData.errorMsg),e.onDialogClose&&e.onDialogClose.call(this,this.queueData),e.auto&&a("#"+e.id).uploadify("upload","*")},onSelect:function(b){var c=this.settings,d=!1,e={};for(var f in this.queueData.files)e=this.queueData.files[f],e.uploaded!=1&&e.name==b.name&&(a("#"+e.id).remove(),this.cancelUpload(e.id),this.queueData.filesReplaced++);var g=Math.round(b.size/1024),h="KB";g>1e3&&(g=Math.round(g/1e3),h="MB");var i=g.toString().split(".");g=i[0],i.length>1&&(g+="."+i[1].substr(0,2)),g+=h;var j=b.name;j.length>25&&(j=j.substr(0,25)+"...");if(c.itemTemplate=="undefined"||c.itemTemplate==null||c.itemTemplate==0){if(a.inArray("onSelect",c.overrideEvents)<0){var k='<li class="template-upload uploadify-queue-item" id="'+b.id+'">'+'<div class="preview"><span class="fade"></span></div>';k+='<div class="picture-bar"><div class="progress progress-success progress-striped uploadify-progress active" style="width:auto;"><div class="uploadify-progress-bar bar" style="width:0%;height:10px;"></div></div><div style="font-size:11px;">Uploading...</div></div>',k+='<span class="data"></span>',k+='<div class="cancel remove"><a href="javascript:$(\'#'+c.id+"').uploadify('cancel', '"+b.id+"')\">X</a>"+"</div>"+"</li>",a("#"+c.queueID).append(k)}}else{itemData={fileID:b.id,instanceID:c.id,fileName:j,fileSize:g};if(a.inArray("onSelect",c.overrideEvents)<0){itemHTML=c.itemTemplate;for(var l in itemData)itemHTML=itemHTML.replace(new RegExp("\\$\\{"+l+"\\}","g"),itemData[l]);a("#"+c.queueID).append(itemHTML)}}this.queueData.queueSize+=b.size,this.queueData.files[b.id]=b,c.onSelect&&c.onSelect.apply(this,arguments)},onSelectError:function(b,c,d){var e=this.settings;if(a.inArray("onSelectError",e.overrideEvents)<0)switch(c){case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:e.queueSizeLimit>d?this.queueData.errorMsg+="\nThe number of files selected exceeds the remaining upload limit ("+d+").":this.queueData.errorMsg+="\nThe number of files selected exceeds the queue size limit ("+e.queueSizeLimit+").";break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:this.queueData.errorMsg+='\nThe file "'+b.name+'" exceeds the size limit ('+e.fileSizeLimit+").";break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:this.queueData.errorMsg+='\nThe file "'+b.name+'" is empty.';break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:this.queueData.errorMsg+='\nThe file "'+b.name+'" is not an accepted file type ('+e.fileTypeDesc+")."}c!=SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED&&delete this.queueData.files[b.id],e.onSelectError&&e.onSelectError.apply(this,arguments)},onQueueComplete:function(){this.settings.onQueueComplete&&this.settings.onQueueComplete.call(this,this.settings.queueData)},onUploadComplete:function(b){var c=this.settings,d=this,e=this.getStats();this.queueData.queueLength=e.files_queued,this.queueData.uploadQueue[0]=="*"?this.queueData.queueLength>0?this.startUpload():(this.queueData.uploadQueue=[],c.onQueueComplete&&c.onQueueComplete.call(this,this.queueData)):this.queueData.uploadQueue.length>0?this.startUpload(this.queueData.uploadQueue.shift()):(this.queueData.uploadQueue=[],c.onQueueComplete&&c.onQueueComplete.call(this,this.queueData));if(a.inArray("onUploadComplete",c.overrideEvents)<0)if(c.removeCompleted)switch(b.filestatus){case SWFUpload.FILE_STATUS.COMPLETE:setTimeout(function(){a("#"+b.id)&&(d.queueData.queueSize-=b.size,d.queueData.queueLength-=1,delete d.queueData.files[b.id],a("#"+b.id).fadeOut(500,function(){a(this).remove()}))},c.removeTimeout*1e3);break;case SWFUpload.FILE_STATUS.ERROR:c.requeueErrors||setTimeout(function(){a("#"+b.id)&&(d.queueData.queueSize-=b.size,d.queueData.queueLength-=1,delete d.queueData.files[b.id],a("#"+b.id).fadeOut(500,function(){a(this).remove()}))},c.removeTimeout*1e3)}else b.uploaded=!0;c.onUploadComplete&&c.onUploadComplete.call(this,b)},onUploadError:function(b,c,d){var e=this.settings,f="Error";switch(c){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:f="HTTP Error ("+d+")";break;case SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL:f="Missing Upload URL";break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:f="IO Error";break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:f="Security Error";break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:alert("The upload limit has been reached ("+d+")."),f="Exceeds Upload Limit";break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:f="Failed";break;case SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND:break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:f="Validation Error";break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:f="Cancelled",this.queueData.queueSize-=b.size,this.queueData.queueLength-=1;if(b.status==SWFUpload.FILE_STATUS.IN_PROGRESS||a.inArray(b.id,this.queueData.uploadQueue)>=0)this.queueData.uploadSize-=b.size;e.onCancel&&e.onCancel.call(this,b),delete this.queueData.files[b.id];break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:f="Stopped"}a.inArray("onUploadError",e.overrideEvents)<0&&(c!=SWFUpload.UPLOAD_ERROR.FILE_CANCELLED&&c!=SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED&&a("#"+b.id).addClass("uploadify-error"),a("#"+b.id).find(".uploadify-progress-bar").css("width","1px"),a("#"+b.id).find(".uploadify-progress-bar-profile").css("width","1px"),c!=SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND&&b.status!=SWFUpload.FILE_STATUS.COMPLETE&&a("#"+b.id).find(".data").html(" - "+f));var g=this.getStats();this.queueData.uploadsErrored=g.upload_errors,e.onUploadError&&e.onUploadError.call(this,b,c,d,f)},onUploadProgress:function(b,c,d){var e=this.settings,f=new Date,g=f.getTime(),h=g-this.timer;h>500&&(this.timer=g);var i=c-this.bytesLoaded;this.bytesLoaded=c;var j=this.queueData.queueBytesUploaded+c,k=Math.round(c/d*100),l="KB/s",m=0,n=i/1024/(h/1e3);n=Math.floor(n*10)/10,this.queueData.averageSpeed>0?this.queueData.averageSpeed=Math.floor((this.queueData.averageSpeed+n)/2):this.queueData.averageSpeed=Math.floor(n),n>1e3&&(m=n*.001,this.queueData.averageSpeed=Math.floor(m),l="MB/s"),a.inArray("onUploadProgress",e.overrideEvents)<0&&(e.progressData!="percentage"&&!(e.progressData=="speed"&&h>500),a("#"+b.id).find(".uploadify-progress-bar").css("width",k+"%"),a("#"+b.id).find(".uploadify-progress-bar-profile").css("width",k+"%")),e.onUploadProgress&&e.onUploadProgress.call(this,b,c,d,j,this.queueData.uploadSize)},onUploadStart:function(b){var c=this.settings,d=new Date;this.timer=d.getTime(),this.bytesLoaded=0,this.queueData.uploadQueue.length==0&&(this.queueData.uploadSize=b.size),c.checkExisting&&a.ajax({type:"POST",async:!1,url:c.checkExisting,data:{filename:b.name},success:function(c){if(c==1){var d=confirm('A file with the name "'+b.name+'" already exists on the server.\nWould you like to replace the existing file?');d||(this.cancelUpload(b.id),a("#"+b.id).remove(),this.queueData.uploadQueue.length>0&&this.queueData.queueLength>0&&(this.queueData.uploadQueue[0]=="*"?this.startUpload():this.startUpload(this.queueData.uploadQueue.shift())))}}}),c.onUploadStart&&c.onUploadStart.call(this,b)},onUploadSuccess:function(b,c,d){var e=this.settings,f=this.getStats();this.queueData.uploadsSuccessful=f.successful_uploads,this.queueData.queueBytesUploaded+=b.size,!(a.inArray("onUploadSuccess",e.overrideEvents)<0),e.onUploadSuccess&&e.onUploadSuccess.call(this,b,c,d)}};a.fn.uploadify=function(c){if(b[c])return b[c].apply(this,Array.prototype.slice.call(arguments,1));if(typeof c=="object"||!c)return b.init.apply(this,arguments);a.error("The method "+c+" does not exist in $.uploadify")}}($)
