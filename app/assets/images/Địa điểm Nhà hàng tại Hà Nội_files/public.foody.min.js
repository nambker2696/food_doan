;var Foody=new Object
;Foody.Helper=new function(){var self=this;self.RunFnc=function(a,b){typeof a=="function"&&a(b)},self.AppendZero=function(a,b){a+="";var c=b-a.length;if(c>0)for(var d=0;d<c;d++)a="0"+a;return a},self.ParseDate=function(jsonDate){return jsonDate?eval(jsonDate.replace(/\/Date\((\d+)\)\//gi,"new Date($1)")):null},self.FormatDateTime=function(a){a=a?a:new Date;var b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear(),e=a.getHours(),f=a.getMinutes();return self.AppendZero(b,2)+"/"+self.AppendZero(c,2)+"/"+self.AppendZero(d,2)+" "+e+":"+f},self.AppendLoading=function(a,b){b=b?b*1:1;var c=$(a).attr("data-loading-type");if(c==b)return;var d=['<div class="sk-cube-grid"><div class="sk-cube sk-cube1"></div><div class="sk-cube sk-cube2"></div><div class="sk-cube sk-cube3"></div><div class="sk-cube sk-cube4"></div><div class="sk-cube sk-cube5"></div><div class="sk-cube sk-cube6"></div><div class="sk-cube sk-cube7"></div><div class="sk-cube sk-cube8"></div><div class="sk-cube sk-cube9"></div></div>','<div class="foody-loaing"><span class="fd-load-center"></span><div class="fd-load-box"><div class="fd-load-circle"></div><div class="fd-load-circle1"></div></div></div>'];$(a).append($(d[b])),$(a).attr("data-loading-type",b)},self.ScrollIntoView=function(a,b){var c=$(a),d=c.offset();if(!d)return;var e=$(b);e.animate({scrollTop:d.top-e.offset().top+e.scrollTop()},function(){c.focus()})},self.ScrollTo=function(a,b){var c=$(a),d=c.offset();if(!d)return;var e=$(b);e.animate({scrollTop:d.top},function(){c.focus()})}}
;Foody.Ko=new Object
;Foody.Ko.Comment=function(a,b){function e(a){return a.Date=ko.observable(Foody.Helper.ParseDate(a.Date)),a.DateFormat=ko.observable(Foody.Helper.FormatDateTime(a.Date())),a.DateText=ko.observable(a.DateFormat()),a.Comment=ko.observable(a.Comment),a.CommentEdit=ko.observable(a.Comment()),a.IsEditing=ko.observable(!1),a.IsLiked=ko.observable(a.IsLiked),a.fnTool_Delete=function(a,b){console.log(c.Total()+"-"+c.Items().length+"-"+c.TotalRemain());if(!confirm("Are your sure want to delete this comment?"))return;$.post("/LikeComment/RemoveComment",{id:a.Id,type:c.Type()},function(){var b=c.Items.indexOf(a);b>-1&&(c.Items.splice(b,1),c.Total(c.Total()-1))})},a.fnTool_Edit=function(a,b){a.IsEditing(!0);var c=$('.fclc-input-edit textarea[data-comment-id="'+a.Id+'"]');g(c[0])},a.fnTool_CancelEdit=function(a,b){a.IsEditing(!1)},a.fnToolSub_Toggle=function(a,b){var c=$(b.target.offsetParent);c&&c.hasClass("fclc-tool-item-dropdown")&&$(c).toggleClass("active")},a}function f(a){var b=[];for(var c=0;c<a.length;c++)b.push(e(a[c]));return b}function g(a){a.scrollHeight>a.clientHeight&&$(a).css("height",a.scrollHeight+5)}function h(a){$.post("/LikeComment/ListComment",{ReferenceId:c.ReferenceId(),Type:c.Type(),Count:c.Count,LastId:c.LastId},function(b){if(!b||b.Error){alert("Can not load Comment!");return}c.Total(b.Total),c.LastId=b.LastId,c.User(b.User);for(var d=0;d<b.Items.length;d++){var f=e(b.Items[d]);c.Items.push(f)}Foody.Helper.RunFnc(a,b)})}function i(){}var c=this,d={Count:10,LastId:null,FrameSelector:"html,body"};a=$.extend({},d,a),c.ReferenceId=ko.observable(a.ReferenceId),c.Type=ko.observable(a.Type),c.Items=ko.observableArray([]),c.Total=ko.observable(0),c.LastId=a.LastId,c.Count=a.Count,c.User=ko.observable({}),c.IsLogin=ko.observable(!1),c.CommentAdd={Text:ko.observable(""),IsLoading:ko.observable(!1)},c.IsLoading=ko.observable(!0),c.FrameSelector=ko.observable(a.FrameSelector),c.IsDelete=ko.observable(!1),c.TotalRemain=function(){return c.Total()-c.Items().length},c.LoadData=function(a,b){c.IsLoading(!0),a&&(a.ReferenceId&&c.ReferenceId(a.ReferenceId),a.Type&&c.Type(a.Type)),c.LastId=null,c.Items([]),h(function(a){c.IsLoading(!1),Foody.Helper.RunFnc(b,a)})},c.LoadMore=function(){c.TotalRemain()>0&&(c.IsLoading(!0),h(function(a){c.IsLoading(!1)}))},c.fnAddComment=function(a,b){if(b.keyCode==13&&b.shiftKey!=1){b.preventDefault();var d=c.CommentAdd.Text().trim();c.CommentAdd.Text(d);if(!d||d.length==0){alert("Please input your comment");return}d=encodeURI(d),c.IsLoading(!0),$.post("/LikeComment/AddCommentEx",{id:c.ReferenceId(),comment:d,type:c.Type()},function(a){var d=e(a);c.Items.unshift(d),c.CommentAdd.Text(""),$(b.target).attr("style",""),c.IsLoading(!1)})}else g(b.target)},c.fnEditComment=function(a,b){if(b.keyCode==13&&b.shiftKey!=1){b.preventDefault();var d=a.CommentEdit().trim();a.CommentEdit(d);if(!d||d.length==0){alert("Please input your comment");return}c.IsLoading(!0),d=encodeURI(d),$.post("/LikeComment/EditCommentEx",{id:a.Id,comment:d},function(b){a.Comment(b.Comment),a.CommentEdit(b.Comment),a.Date(Foody.Helper.ParseDate(b.Date)),a.DateFormat(Foody.Helper.FormatDateTime(a.Date())),a.DateText(a.DateFormat()),a.IsEditing(!1),c.IsLoading(!1)})}else g(b.target)},c.fnFocusWriter=function(){IsIndo?angular.element('div[ng-controller="HelperCtrl"]').scope().ShowDlgLogin(function(a){a.LoggedIn&&(c.IsLogin(!0),b.SetExpand(!1),setTimeout(function(){Foody.Helper.ScrollIntoView(".fclc-input>textarea:visible",c.FrameSelector())},500))}):(b.SetExpand(!1),setTimeout(function(){Foody.Helper.ScrollIntoView(".fclc-input>textarea:visible",c.FrameSelector())},500))},i()}
;Foody.Ko.LoginDialog=function(a){function g(){d=$("#foody-login-box").bPopup({onOpen:function(){}}),window.abc=d}function h(){}var b=this,c=a.LoginUrl,d=null,e=null,f=null;b.Username=ko.observable(""),b.Password=ko.observable(""),b.Remember=ko.observable(!0),b.IsInit=ko.observable(!1),b.Show=function(a,c){e=a,f=c,b.IsInit()!=1?b.Init(function(){g()}):g()},b.Hide=function(){d.close()},b.fnClose=function(){d.close(),Foody.Helper.RunFnc(f)},b.fnLogin=function(){$.post(c,{email:b.Username(),password:b.Password(),rememberMe:b.Remember()},function(a){if(!a||a.isSuccess!=1){alert(a.message);return}b.Hide(),Foody.Helper.RunFnc(e)})},b.Init=function(a){$.post("/Common/GetTemplateFoodyLogin",{},function(c){$("#foody-login-box-cotaner").html(c),ko.applyBindings(b,$("#foody-login-box")[0]),b.IsInit(!0),Foody.Helper.RunFnc(a)})},h()}
;Foody.Ko.Picture=function(a,b){function e(){var a=$("#foody-photo-detail .fpd-photo-main img").css("max-width").replace("px","")*1,b=$("#foody-photo-detail .fpd-photo-main img").css("max-height").replace("px","")*1,d=1,e=c.Model().Width,f=c.Model().Height;e>f?d=e/a:d=f/b;var g=e/d,h=f/d;if(g>e||h>f)g=e,h=f;c.SizeWidth(g+"px"),c.SizeHeight(h+"px")}function f(a){return"style/images/icons/device-"+a+"-32x32.png"}function g(a){return a.TotalLikes=ko.observable(a.TotalLikes),a.IsLiked=ko.observable(a.IsLiked),a.IsAdmin=ko.observable(a.IsAdmin),a.IsEditName=ko.observable(!1),a.DeviceTypeImage=f(a.DeviceType),c.PhotoNameBeforeEdit(a.Name),a}function h(a){var b=c.Items();for(var d=0;d<b.length;d++)if(b[d].PictureId==a)return b[d];return null}var c=this,d={Count:8,LastId:null};a=$.extend({},d,a),c.PictureId=ko.observable(null),c.GroupId=ko.observable(null),c.Model=ko.observable({Width:0,Height:0,Services:[],DeviceTypeImage:"",ReviewUrl:"",CreatedOn:"",Name:"",Restaurant:{},Owner:{},IsLiked:function(){},IsAdmin:function(){},IsEditName:function(){},TotalLikes:function(){}}),c.PhotoNameBeforeEdit=ko.observable(""),c.Count=ko.observable(a.Count),c.Items=ko.observableArray([]),c.Total=ko.observable(0),c.LastId=ko.observable(a.LastId),c.Idx=ko.observable(0),c.CurrentUrl=ko.observable(""),c.BackUrl=ko.observable(""),c.IsLoading=ko.observable(!1),c.TotalRemain=function(){return c.Total()-c.Items().length},c.StateList=["/places","/delivery","/booking","/foods","/reviews","/bank-card","/promotion","/activities","/media-album"],c.SizeWidth=ko.observable(0),c.SizeHeight=ko.observable(0),c.IsNavPrev=function(){return c.Idx()>0},c.IsNavNext=function(){return c.Idx()<c.Total()-1},c.fnClear=function(){c.Items([]),c.Total(0),c.LastId(null)},c.fnChangeCaption=function(){if(c.IsLoading())return;var a=c.Idx();if(a>-1){c.IsLoading(!0);var b=c.Items()[a];$.post("/Photo/ChangeCaption",{resPicId:b.PictureId,caption:c.Model().Name},function(a){c.PhotoNameBeforeEdit(c.Model().Name),c.IsLoading(!1),c.fnEditCaption(!1)})}},c.fnEditCaption=function(a){return a==1?(c.Model().IsEditName(!0),$(".fpd-input-text").focus()):(c.Model().Name=c.PhotoNameBeforeEdit(),c.Model().IsEditName(!1)),!1},c.Add=function(a){c.Items.push(a)},c.LoadList=function(a){$.post("/Photo/ListFoodyPhoto",{pictureId:c.PictureId(),groupId:c.GroupId(),count:c.Count(),lastId:c.LastId()},function(b){if(!b||b.Error){alert("Can not load list photo"),Foody.Helper.RunFnc(a);return}for(var d=0;d<b.Items.length;d++){var e=b.Items[d];c.Add(e)}c.Total(b.Total),c.LastId(b.LastId),c.TotalRemain=function(){return c.Total()-c.Items().length};var f=c.Items().length,g=Math.floor(f/4)+(f%4!=0?1:0);g=g>3?3:g<1?1:g,Foody.Helper.RunFnc(a,b)})},c.LoadPhoto=function(a,b){if(c.IsLoading())return;c.IsLoading(!0),$.post("/Photo/LoadFoodyPhotoDetail",{pictureId:a.PictureId},function(d){if(!d||d.Error)return;d.CreatedOn=Foody.Helper.FormatDateTime(Foody.Helper.ParseDate(d.CreatedOn)),$("#foody-photo-detail .fpd-photo-main img")[0].onload=function(){c.SizeWidth(""),c.SizeHeight("")},c.Model(g(d)),e();if(a.IsBindListPictures!=0)c.fnClear(),a&&(a.PictureId&&c.PictureId(a.PictureId),a.GroupId&&c.GroupId(a.GroupId)),c.LoadList(function(){var a=h(c.PictureId());a&&c.Idx(a.Idx-1),c.IsLoading(!1),c.fnScrollIntoViewMain(),a&&c.ChangeUrl(a.PictureId),Foody.Helper.RunFnc(b,d)});else{var f=h(a.PictureId);c.Idx(f.Idx-1),c.IsLoading(!1),c.fnScrollIntoViewMain(),c.ChangeUrl(f.PictureId),Foody.Helper.RunFnc(b,d)}})},c.Like=function(a){var b=c.Model().IsLiked()==1?"/Photo/UnLikePhoto":"/Photo/LikePhoto",d=c.Items()[c.Idx()].PictureId;$.post(b,{id:d},function(b){b&&b.Success==1&&(c.Model().IsLiked(!c.Model().IsLiked()),c.Model().TotalLikes(c.Model().TotalLikes()+(c.Model().IsLiked()==1?1:-1))),Foody.Helper.RunFnc(a,c.Model().IsLiked())})},c.CurrentPhoto=function(){return c.Items()[c.Idx()]},c.fnNavPrev=function(a){b.UpdateSize();var d=c.Idx();if(d>0){var e=c.Items()[d-1];c.fnItemClick({PictureId:e.PictureId},a)}},c.fnNavNext=function(a){b.UpdateSize();var d=c.Idx();if(d+1<c.Total()){var e=c.Items();if(e.length-1>d){var f=c.Items()[d+1];c.fnItemClick({PictureId:f.PictureId},a)}else c.LoadList(function(){e=c.Items();var b=e[d+1];c.fnItemClick({PictureId:b.PictureId},a)})}},c.fnScrollIntoView=function(a){Foody.Helper.ScrollIntoView('.fpd-photo-list ul li a[data-item-id="'+a+'"]',".fpd-photo-list"),$(".fpd-photo-list ul li a").removeClass("active"),$('.fpd-photo-list ul li a[data-item-id="'+a+'"]').addClass("active")},c.fnScrollIntoViewMain=function(){$("#foody-photo-detail .fpd-frame").animate({scrollTop:0})},c.ChangeUrl=function(a){var b=angular.element($("#FoodyApp")).scope().PreState;c.StateList.includes(b)||window.history.replaceState(null,null,"/photo/detail/"+a)},c.RestoreUrl=function(){return c.BackUrl()&&c.BackUrl()!=""?(window.location.href=c.BackUrl(),1):(window.history.replaceState(null,null,c.CurrentUrl()),2)},c.fnItemClick=function(a,d){var e={GroupId:c.GroupId(),PictureId:a.PictureId,IsBindListPictures:!1};c.LoadPhoto(e,function(a){var e=c.CurrentPhoto();b.CommentModel.LoadData({ReferenceId:e.PictureId,Type:1},function(){Foody.Helper.RunFnc(d,a)})})}}
;Foody.Ko.PhotoDialog=function(a){function d(){var a=$(window).height(),d=$(window).width();$("#"+b+" .fpd-frame").css("height",a),c.IsExpand()?(c.PhotoHeight(a+"px"),c.PhotoHeightMax(a-150+"px"),c.PhotoWidthMax(d-100+"px")):(c.PhotoHeight(""),c.PhotoHeightMax(""),c.PhotoWidthMax(""))}function e(){c.UpdateSize()}function f(){$(window).resize(function(){if(c.IsShow()!=1)return;e()}),$("#foody-photo-detail .fpd-frame").scroll(function(a){var b=$("body").scrollTop(),c=$("#foody-photo-detail .fpd-box-main").offset(),d=$("#foody-photo-detail .fpd-wapper").css("padding-top").replace("px","")*1,e=$("#foody-photo-detail .fpd-photo-main").height(),f=$("#foody-photo-detail .fpd-photo-toolbar").height(),g=$("#foody-photo-detail .fpd-photo-toolbar").css("padding-top").replace("px","")*1,h=0;$(this).scrollTop()>=d&&(h=b-c.top),h>=e-d+f-g&&(h=e-d+f-g)}),$(window).on("keyup",function(a){switch(a.keyCode){case 27:c.fnClose();break;case 37:if($("#foody-photo-detail .fpd-box-comment .foody-comment .fc-list-comment .fcl-item .fcl-content.fclc-input>textarea").is(":focus"))return;c.PictureModel.fnNavPrev();break;case 39:if($("#foody-photo-detail .fpd-box-comment .foody-comment .fc-list-comment .fcl-item .fcl-content.fclc-input>textarea").is(":focus"))return;c.PictureModel.fnNavNext();break;default:}}),ko.applyBindings(c,document.getElementById(b))}function g(a){c.IsInit()!=1?IsIndo?(c.IsInit(!0),$.post("/Photo/GetHtmlFoodyPhoto",{},function(b){if(!b){alert("Can not load photo");return}$("body").append($(b.Template)),f(),Foody.Helper.RunFnc(a,c.IsInit())})):angular.element('div[ng-controller="HelperCtrl"]').scope().ShowDlgLogin(function(b){b.LoggedIn&&(c.IsInit(!0),$.post("/Photo/GetHtmlFoodyPhoto",{},function(b){if(!b){alert("Can not load photo");return}$("body").append($(b.Template)),f(),Foody.Helper.RunFnc(a,c.IsInit())}))}):Foody.Helper.RunFnc(a,c.IsInit())}var b=a.TargetId,c=this;c.UpdateSize=function(){d()},c.PhotoHeight=ko.observable(""),c.PhotoHeightMax=ko.observable(""),c.PhotoWidthMax=ko.observable(""),c.IsShow=ko.observable(!1),c.IsExpand=ko.observable(!1),c.IsInit=ko.observable(!1),c.PictureModel=new Foody.Ko.Picture({Count:8},c),c.CommentModel=new Foody.Ko.Comment({Count:10,FrameSelector:"#foody-photo-detail .fpd-frame"},c),c.BackUrl=function(a){return a&&c.PictureModel.BackUrl(a),c.PictureModel.BackUrl()},c.fnShare=function(a,b){var d=$(b.target);if(!window.FoodyPopup)return;var e=c.PictureModel.CurrentPhoto();FoodyPopup.Init(function(){FoodyPopup.Show({title:d.data("title"),content:'<p class="share-social-method">'+d.data("description")+"</p>"+'<ul class="btns-social btns-social-fd-box">'+'<li class="fb"><a provider="1" href="javascript:void(0);" title="Facebook"></a></li>'+'<li class="gg"><a provider="2" href="javascript:void(0);" title="Google"></a></li>'+"</ul>"},function(){$("ul.btns-social-fd-box a").on("click",function(){var a=location.origin+"/photo/detail/"+e.PictureId,b=$(this).attr("provider");b==1&&window.FB?(FoodyPopup.Hide(),window.FB.ui({method:"share",href:a},function(a){c.UpdateSize()})):b==2&&window.gapi&&(window.open("https://plus.google.com/share?url="+a),FoodyPopup.Hide())})})})},c.SetExpand=function(a){c.IsExpand(a),c.UpdateSize()},c.fnExpand=function(a,b){c.SetExpand(!c.IsExpand())},c.fnSave=function(a,b){if(IsIndo)angular.element('div[ng-controller="HelperCtrl"]').scope().ShowDlgLogin(function(a){if(a.LoggedIn){var b=c.PictureModel.CurrentPhoto();if(!window.popupSavePhoto)return;window.popupSavePhoto&&window.popupSavePhoto.Show({PictureId:b.PictureId},function(a){})}});else{var d=c.PictureModel.CurrentPhoto();if(!window.popupSavePhoto)return;window.popupSavePhoto&&window.popupSavePhoto.Show({PictureId:d.PictureId},function(a){})}},c.fnLike=function(a,b){IsIndo?angular.element('div[ng-controller="HelperCtrl"]').scope().ShowDlgLogin(function(a){a.LoggedIn&&c.PictureModel.Like()}):c.PictureModel.Like()},c.fnShow=function(a){g(function(b){c.BackUrl(a.BackUrl),b==1?($("body").addClass("no-scroll"),c.IsShow(!0),c.UpdateSize(),a&&(c.PictureModel.CurrentUrl(window.location.pathname+window.location.hash),c.PictureModel.Model().PhotoUrl="",c.PictureModel.LoadPhoto(a,function(a){var b=c.PictureModel.CurrentPhoto();c.CommentModel.LoadData({ReferenceId:b.PictureId,Type:1},function(){})}))):c.PictureModel.RestoreUrl()==2&&($("body").removeClass("no-scroll"),c.IsShow(!1))})},c.fnClose=function(a,b){return!a||!b||b.target&&(b.target.className=="fpd-frame"||b.target.className=="btn-close"||b.target.className=="fpd-wapper")?(c.PictureModel.RestoreUrl()==2&&($("body").removeClass("no-scroll"),c.IsShow(!1)),!1):!0}};var foodyPhotoDialog=null;$(function(){foodyPhotoDialog=new Foody.Ko.PhotoDialog({TargetId:"foody-photo-detail"}),$("a.foody-photo").live("click",function(a){a.preventDefault();var b=$(this),c={GroupId:b.data("group"),PictureId:b.data("id")};return c.PictureId&&c.GroupId&&foodyPhotoDialog.fnShow(c),!1})})
