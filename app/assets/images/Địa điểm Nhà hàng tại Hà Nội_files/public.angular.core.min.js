;var FoodyApp=angular.module("FoodyApp",["ngSanitize","ngCookies","ngRoute","ngMap","angular-ellipsis","angular-elastic","ui.mention","ui.sortable","ngAnimate"]);FoodyApp.config(["$httpProvider",function(a){a.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]).config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|javascript):/)}]).config(["$qProvider",function(a){a.errorOnUnhandledRejections(!1)}]),FoodyApp.directive("ngLoaded",function(){return{restrict:"A",link:function(a,b,c){b.bind("load",function(){a.$apply(function(){a.IsLoading=!1})})}}}).directive("ngMention",["$http","$q",function(a,b){return{require:"uiMention",link:function(a,b,c,d){d.findChoices=function(a,b){return null}}}}]),$(function(){$(".fd-write-review").live("click",function(){var a=$(this),b=a.data("res-id"),c=a.data("rev-id");angular.element('div[ng-controller="HelperCtrl"]').scope().ShowDlgWriteReview(b,c)}),$(".btn-report-user").live("click",function(){var a=$(this).attr("data-item-id");angular.element('div[ng-controller="HelperCtrl"]').scope().ShowDlgReport(1,a)}),$(".btn-report-picture").live("click",function(){var a=$(this).attr("data-item-id");angular.element('div[ng-controller="HelperCtrl"]').scope().ShowDlgReport(2,a)}),$(".btn-report-microsite").live("click",function(){var a=$(this).attr("data-item-id");angular.element('div[ng-controller="HelperCtrl"]').scope().ShowDlgReport(3,a)})})
;(function(){function a(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.bindUnsafeHtml)},function(d){c.html(d),a(c.contents())(b)})}}"use strict",angular.module("FoodyApp").directive("bindUnsafeHtml",a),a.$inject=["$compile"]})()
;(function(){function a(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){return a==null?null:parseInt(a,10)}),d.$formatters.push(function(a){return a==null?null:""+a})}}}"use strict",angular.module("FoodyApp").directive("convertToNumber",a)})()
;(function(){function a(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){return a==null?null:a==1||a=="true"||a==1||a=="1"||a=="True"}),d.$formatters.push(function(a){return a==null?null:""+a})}}}"use strict",angular.module("FoodyApp").directive("convertToBool",a)})()
;(function(){function a(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e=$(b).data("z-index");e=e?e:700;var f=$(b).data("format");f=f=="MM/dd/yyyy"?"mm/dd/yy":"dd/mm/yy",$(b).datepicker({dateFormat:f,beforeShow:function(a,b){setTimeout(function(){b.dpDiv.css("z-index",e)},100)},onSelect:function(b){d.$setViewValue(b),d.$render(),a.$apply()}})}}}"use strict",angular.module("FoodyApp").directive("jqdatepicker",a)})()
;(function(){function a(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e=$(b).data("z-index");e=e?e:700;var f=$(b).data("format");f=f=="MM/dd/yyyy"?"mm/dd/yy":"dd/mm/yy",$(b).datepicker({dateFormat:f,yearRange:"2016:2100",minDate:new Date,beforeShow:function(a,b){setTimeout(function(){b.dpDiv.css("z-index",e)},100)},onSelect:function(b){d.$setViewValue(b),d.$render(),a.$apply()}})}}}"use strict",angular.module("FoodyApp").directive("jqdatepickermindate",a)})()
;(function(){function a(){return function(a,b,c){b.bind("keydown keypress",function(b){b.which===13&&(a.$apply(function(){a.$eval(c.keyEnter)}),b.preventDefault())})}}"use strict",angular.module("FoodyApp").directive("keyEnter",a)})()
;(function(){function a(){return function(a,b,c){b.bind("keydown keypress",function(b){(b.which===13||b.keyCode==13)&&a.$apply(function(){window.event=b,b.preventDefault(),a.$eval(c.keyEnterSp)})})}}"use strict",angular.module("FoodyApp").directive("keyEnterSp",a)})()
;(function(){function a(){return function(a,b,c){b.bind("keydown keypress",function(b){a.$eval(c.keyPress)})}}"use strict",angular.module("FoodyApp").directive("keyPress",a)})()
;(function(){function a(){return{restrict:"A",link:function(a,b,c){var d=function(a){return a!=null&&a.preventDefault(),a.originalEvent.dataTransfer.effectAllowed="copy",!1};return b.bind("dragover",d),b.bind("dragenter",d),b.bind("drop",function(b){var c,d,e,f,g;return b!=null&&b.preventDefault(),a.SetPictureUpload&&a.SetPictureUpload(b.originalEvent.dataTransfer.files),!1})}}}"use strict",angular.module("FoodyApp").directive("dropzone",a)})()
;angular.module("angular-ellipsis",[]).directive("ellipsis",["$timeout","$window","$sce",function(a,b,c){var d=function(b){var c=null,d=[];this.remove=function(b){d.indexOf(b)!==-1&&(d.splice(d.indexOf(b),1),d.length===0&&(a.cancel(c),c=null))},this.add=function(e){d.indexOf(e)===-1&&d.push(e),c||(c=a(function(){var a=d.slice();c=null,d.length=0,a.forEach(function(a){a()})},b))}},e=new d(0),f=new d(75);return{restrict:"A",scope:{ngShow:"=",ngBind:"=",ngBindHtml:"=",ellipsisAppend:"@",ellipsisAppendClick:"&",ellipsisSymbol:"@",ellipsisSeparator:"@",useParent:"@",ellipsisSeparatorReg:"=",ellipsisFallbackFontSize:"@"},compile:function(a,d,g){return function(a,d,g){function h(a){return typeof a!="undefined"}function i(a){var b=0;return angular.forEach(a.parent().children(),function(c){c!=a[0]&&(b+=c.clientHeight)}),a.parent()[0].clientHeight-b}function j(){var b=a.ngBind||a.ngBindHtml,e=!1;c.isEnabled()&&angular.isObject(b)&&c.getTrustedHtml(b)&&(e=!0,b=c.getTrustedHtml(b));if(b){var f=!a.ngBind&&!!a.ngBindHtml,j=0,l=typeof g.ellipsisSymbol!="undefined"?g.ellipsisSymbol:"&hellip;",m=typeof a.ellipsisSeparator!="undefined"?g.ellipsisSeparator:" ",n=typeof a.ellipsisSeparatorReg!="undefined"?a.ellipsisSeparatorReg:!1,o=typeof a.ellipsisAppend!="undefined"&&a.ellipsisAppend!==""?l+"<span class='angular-ellipsis-append'>"+a.ellipsisAppend+"</span>":l,p=n?b.match(n):b.split(m);g.isTruncated=!1,f?d.html(b):d.text(b),h(g.ellipsisFallbackFontSize)&&k(d)&&d.css("font-size",g.ellipsisFallbackFontSize);if(k(d,a.useParent)){var q=p.length,r=a.useParent?i(d):d[0].clientHeight;f?d.html(b+o):d.text(b).html(d.html()+o),d.attr("data-overflowed","true");for(;j<q;j++){var s=p.pop();p.length===0&&(p[0]=s.substring(0,Math.min(s.length,5))),f?d.html(p.join(m)+o):d.text(p.join(m)).html(d.html()+o);if((a.useParent?d.parent()[0]:d[0]).scrollHeight<r||k(d,a.useParent)===!1){g.isTruncated=!0;break}}l!=o&&typeof a.ellipsisAppendClick!="undefined"&&a.ellipsisAppendClick!==""&&d.find("span.angular-ellipsis-append").bind("click",function(b){a.$apply(function(){a.ellipsisAppendClick.call(a,{event:b})})}),!e&&c.isEnabled()&&c.trustAsHtml(b)}else d.attr("data-overflowed","false")}}function k(a,b){return a=b?a.parent():a,a[0].scrollHeight>a[0].clientHeight}function l(){(g.lastWindowResizeWidth!=window.innerWidth||g.lastWindowResizeHeight!=window.innerHeight)&&j(),g.lastWindowResizeWidth=window.innerWidth,g.lastWindowResizeHeight=window.innerHeight}function n(){f.add(l)}g.lastWindowResizeTime=0,g.lastWindowResizeWidth=0,g.lastWindowResizeHeight=0,g.lastWindowTimeoutEvent=null,g.isTruncated=!1,a.$watch("ngShow",function(){e.add(j)}),a.$watch("ngBind",function(){e.add(j)}),a.$watch("ngBindHtml",function(){e.add(j)}),a.$watch("ellipsisAppend",function(){j()}),a.$watch(function(){return d[0].offsetWidth!=0&&d[0].offsetHeight!=0},function(){f.add(j)});var m=a.$on("dibari:refresh-ellipsis",function(){e.add(j)}),o=angular.element(b);o.bind("resize",n),a.$on("$destroy",function(){o.unbind("resize",n),e.remove(j),f.remove(l),m&&(m(),m=null)})}}}}])
;typeof module!="undefined"&&typeof exports!="undefined"&&module.exports===exports&&(module.exports="angular-elastic"),angular.module("angular-elastic",[]).constant("msdElasticConfig",{append:""}).directive("ngElastic",["$timeout","$window","msdElasticConfig",function(a,b,c){return"use strict",{require:"ngModel",restrict:"A, C",link:function(d,e,f,g){function A(){var a=m;x=h,p=getComputedStyle(h),angular.forEach(z,function(b){a+=b+":"+p.getPropertyValue(b)+";"}),o.setAttribute("style",a)}function B(){var b,c,e,f,g;x!==h&&A(),y||(y=!0,o.value=h.value+k,o.style.overflowY=h.style.overflowY,b=h.style.height===""?"auto":parseInt(h.style.height,10),c=getComputedStyle(h).getPropertyValue("width"),c.substr(c.length-2,2)==="px"&&(f=parseInt(c,10)-s.width,o.style.width=f+"px"),e=o.scrollHeight,e>w?(e=w,g="scroll"):e<v&&(e=v),e+=s.height,h.style.overflowY=g||"hidden",b!==e&&(d.$emit("elastic:resize",i,b,e),h.style.height=e+"px"),a(function(){y=!1},1,!1))}function C(){y=!1,B()}var h=e[0],i=e;if(h.nodeName!=="TEXTAREA"||!b.getComputedStyle)return;i.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var j=h.value;h.value="",h.value=j;var k=f.msdElastic?f.msdElastic.replace(/\\n/g,"\n"):c.append,l=angular.element(b),m="position: absolute; top: -999px; right: auto; bottom: auto;left: 0; overflow: hidden; -webkit-box-sizing: content-box;-moz-box-sizing: content-box; box-sizing: content-box;min-height: 0 !important; height: 0 !important; padding: 0;word-wrap: break-word; border: 0;",n=angular.element('<textarea aria-hidden="true" tabindex="-1" style="'+m+'"/>').data("elastic",!0),o=n[0],p=getComputedStyle(h),q=p.getPropertyValue("resize"),r=p.getPropertyValue("box-sizing")==="border-box"||p.getPropertyValue("-moz-box-sizing")==="border-box"||p.getPropertyValue("-webkit-box-sizing")==="border-box",s=r?{width:parseInt(p.getPropertyValue("border-right-width"),10)+parseInt(p.getPropertyValue("padding-right"),10)+parseInt(p.getPropertyValue("padding-left"),10)+parseInt(p.getPropertyValue("border-left-width"),10),height:parseInt(p.getPropertyValue("border-top-width"),10)+parseInt(p.getPropertyValue("padding-top"),10)+parseInt(p.getPropertyValue("padding-bottom"),10)+parseInt(p.getPropertyValue("border-bottom-width"),10)}:{width:0,height:0},t=parseInt(p.getPropertyValue("min-height"),10),u=parseInt(p.getPropertyValue("height"),10),v=Math.max(t,u)-s.height,w=parseInt(p.getPropertyValue("max-height"),10),x,y,z=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];if(i.data("elastic"))return;w=w&&w>0?w:9e4,o.parentNode!==document.body&&angular.element(document.body).append(o),i.css({resize:q==="none"||q==="vertical"?"none":"horizontal"}).data("elastic",!0),"onpropertychange"in h&&"oninput"in h?h.oninput=h.onkeyup=B:h.oninput=B,l.bind("resize",C),d.$watch(function(){return g.$modelValue},function(a){C()}),d.$on("elastic:adjust",function(){A(),C()}),a(B,0,!1),d.$on("$destroy",function(){n.remove(),l.unbind("resize",C)})}}}])
;(function(){function a(a,b,c){var d=new function(){function g(a,c,g){var i=null;g?i=angular.element("#"+e):(i=angular.element(f),angular.element("body").append(i),b(i)(d)),d=i.scope(),d.$apply(),h(a,c)}function h(a,b){d.Show?d.Show(a,b):g(a,b,!0)}self=this;var d=a.$new(),e="fdDlgCommon",f="";self.Show=function(a,b){var d=$("#"+e);if(d.length<1){var i="/__post/ViewTemplate/PopupCommon";i+=c.GetParamRnd(i),$.get(i,{},function(c){f=c,g(a,b)}).fail(function(a){c.Log(a)})}else h(a,b)},self.Confirm=function(){}};return d}"use strict",angular.module("FoodyApp").factory("DlgCommon",a),a.$inject=["$rootScope","$compile","Helper"]})()
;(function(){function a(a,b,c){var d=new function(){function g(a,c){var e=angular.element(f);angular.element("body").append(e),b(e)(d),d=e.scope(),d.$apply(),h(a,c)}function h(a,b){d.Show(a,b)}self=this;var d=a.$new(),e="fdDlgECard",f="";self.Show=function(a,b){var d=$("#"+e);if(d.length<1){var i="/__post/ViewTemplate/PopupEcard",j=c.GetParamRnd(i);$.post(i+j,{},function(c){f=c,g(a,b)}).fail(function(a){c.Log(a)})}else h(a,b)}};return d}"use strict",angular.module("FoodyApp").factory("DlgECard",a),a.$inject=["$rootScope","$compile","Helper"]})()
;(function(){function a(a,b,c){var d=new function(){function g(a,c){var e=angular.element(f);angular.element("body").append(e),b(e)(d),d=e.scope(),d.$apply(),h(a,c)}function h(a,b){d.Show(a,b)}self=this;var d=a.$new(),e="fdDlgGallery",f="";self.Show=function(a,b){var d=$("#"+e);if(d.length<1){var i="/__post/ViewTemplate/PopupGallery",j=c.GetParamRnd(i);$.post(i+j,{},function(c){f=c,g(a,b)}).fail(function(a){c.Log(a)})}else h(a,b)}};return d}"use strict",angular.module("FoodyApp").factory("DlgGallery",a),a.$inject=["$rootScope","$compile","Helper"]})()
;(function(){function a(a,b,c,d){var e=new function(){function h(a,c){var d=angular.element(g);angular.element("body").append(d),b(d)(e),e=d.scope(),i(a,c)}function i(a,b){e.Show(a,b)}self=this;var e=a.$new(),f="fdDlgListUser",g="";self.Show=function(a,b){var e=$("#"+f);if(e.length<1){var j="/__get/ViewTemplate/PopupListUser";j+=d.GetParamRnd(j),c.get(j).then(function(c){c=c.data,g=c,h(a,b)}).catch(function(a){d.Log(a)})}else i(a,b)}};return e}"use strict",angular.module("FoodyApp").factory("DlgListUser",a),a.$inject=["$rootScope","$compile","$http","Helper"]})()
;(function(){function a(a,b,c){var d=new function(){function g(a,c,e){var g=angular.element(f);angular.element("body").append(g),b(g)(d),d=g.scope(),d.$apply(),d=g.scope(),d.$apply(),h(a,c,e)}function h(a,b,c){d.Show?d.Show(a,b,c):g(a,b,c,!0)}self=this;var d=a.$new(),e="fdDlgPopupReport",f="";self.Show=function(a,b,d){var i=$("#"+e);if(i.length<1){var j="/__post/Report/PopupReport";j+=c.GetParamRnd(j),$.get(j,{},function(c){f=c,g(a,b,d)}).fail(function(a){c.Log(a)})}else h(a,b,d)}};return d}"use strict",angular.module("FoodyApp").factory("DlgPopupReport",a),a.$inject=["$rootScope","$compile","Helper"]})()
;(function(){function a(a,b,c){var d=new function(){function g(a,c,e){var g=angular.element(f);angular.element("body").append(g),b(g)(d),d=g.scope(),d.$apply(),h(a,c,e)}function h(a,b,c){angular.element(document.getElementById(e)).scope().Show(a,b,c)}self=this;var d=a.$new(),e="fdDlgReport",f="";self.Show=function(a,b,d){var i=$("#"+e);if(i.length<1){var j="/__post/ViewTemplate/PopupReport",k=c.GetParamRnd(j);$.post(j+k,{},function(c){f=c,g(a,b,d)}).fail(function(a){c.Log(a)})}else h(a,b,d)}};return d}"use strict",angular.module("FoodyApp").factory("DlgReport",a),a.$inject=["$rootScope","$compile","Helper"]})()
;(function(){function a(a,b,c){var d=new function(){function g(a,c){var e=angular.element(f);angular.element("body").append(e),b(e)(d),d=e.scope(),d.$apply(),h(a,c)}function h(a,b){d.Show(a,b)}self=this;var d=a.$new(),e="fdDlgReviewRating",f="";self.Show=function(a,b){var d=$("#"+e);if(d.length<1){var i="/__post/ViewTemplate/PopupReviewRating",j=c.GetParamRnd(i);$.post(i+j,{},function(c){f=c,g(a,b)}).fail(function(a){c.Log(a)})}else h(a,b)}};return d}"use strict",angular.module("FoodyApp").factory("DlgReviewRating",a),a.$inject=["$rootScope","$compile","Helper"]})()
;(function(){function a(a,b,c){var d=new function(){function g(a,c){var e=angular.element(f);angular.element("body").append(e),b(e)(d),d=e.scope(),d.$apply(),h(a,c)}function h(a,b){d.Show(a,b)}self=this;var d=a.$new(),e="fdDlgReviews",f="";self.Show=function(a,b){var d=$("#"+e);if(d.length<1){var i="/__post/ViewTemplate/PopupReviews";i+=c.GetParamRnd(i),$.get(i,{},function(c){f=c,g(a,b)}).fail(function(a){c.Log(a)})}else h(a,b)}};return d}"use strict",angular.module("FoodyApp").factory("DlgReviews",a),a.$inject=["$rootScope","$compile","Helper"]})()
;(function(){function a(a,b,c){var d=new function(){function g(a){var c=angular.element(f),e=angular.element('div[ng-controller="DlgSearchFilterCtrl"]');e.append(c),d=e.scope(),b(e)(d),d.$apply(),h(a)}function h(a){d.Show(a)}self=this;var d=a.$new(),e="fdDlgSearchFilter",f="";self.Show=function(a){var b=$("#"+e);if(b.length<1){var d="/__post/ViewTemplate/PopupSearchFilter";d+=c.GetParamRnd(d),$.get(d,{},function(b){f=b,g(a)}).fail(function(a){c.Log(a)})}else h(a)}};return d}"use strict",angular.module("FoodyApp").factory("DlgSearchFilter",a),a.$inject=["$rootScope","$compile","Helper"]})()
;(function(){function a(a,b,c){var d=new function(){function g(a,c,e){var g=angular.element(f);angular.element("body").append(g),b(g)(d),d=g.scope(),d.$apply(),h(a,c,e)}function h(a,b,c){d.Show(a,b,c)}self=this;var d=a.$new(),e="fdDlgUserInfoReview",f="";self.Show=function(a,b,d){var i=$("#"+e);if(i.length<1){var j="/__post/ViewTemplate/PopupUserInfo",k=c.GetParamRnd(j);$.post(j+k,{},function(c){f=c,g(a,b,d)}).fail(function(a){c.Log(a)})}else h(a,b,d)}};return d}"use strict",angular.module("FoodyApp").factory("DlgUserInfoReview",a),a.$inject=["$rootScope","$compile","Helper"]})()
;(function(){function a(a,b,c,d){var e=new function(){function h(a,c,d,h){var j=null;h?j=angular.element("#"+f):(j=angular.element(g),angular.element("body").append(j),b(j)(e)),e=j.scope(),e.$apply(),i(a,c,d)}function i(a,b,c){e.Show?e.Show(a,b,c):h(a,b,c,!0)}self=this;var e=a.$new(),f="fdDlgWriteReview",g="";e.PreReview="",self.Show=function(a,b,f){d.Show(function(d){if(d.LoggedIn){var j=!1;b!=e.PreReview&&(e.PreReview=b,j=!0);if(j){var k="/__post/ViewTemplate/PopupWriteReview";k+=c.GetParamRnd(k),$.get(k,{},function(c){g=c,h(a,b,f)}).fail(function(a){c.Log(a)})}else i(a,b,f)}})}};return e}"use strict",angular.module("FoodyApp").factory("DlgWriteReview",a),a.$inject=["$rootScope","$compile","Helper","DlgLogin"]})()
;(function(){function a(a,b,c,d){var e=new function(){function h(a,c,d,h){var j=null;h?j=angular.element("#"+f):(j=angular.element(g),angular.element("body").append(j),b(j)(e)),e=j.scope(),e.$apply(),i(a,c,d)}function i(a,b,c){e.Show?e.Show(a,b,c):h(a,b,c,!0)}self=this;var e=a.$new(),f="fdDlgUploadPhoto",g="";e.PreReview="",self.Show=function(a,b,f){d.Show(function(d){if(d.LoggedIn){var j=!1;b!=e.PreReview&&(e.PreReview=b,j=!0);if(j){var k="/__post/ViewTemplate/PopupUploadPhoto";k+=c.GetParamRnd(k),$.get(k,{},function(c){g=c,h(a,b,f)}).fail(function(a){c.Log(a)})}else i(a,b,f)}})}};return e}"use strict",angular.module("FoodyApp").factory("DlgUploadPhoto",a),a.$inject=["$rootScope","$compile","Helper","DlgLogin"]})()
;(function(){function a(a,b,c){var d=new function(){function g(a,c){var e=angular.element(f);angular.element("body").append(e),b(e)(d),d=e.scope(),d.$apply(),h(a,c)}function h(a,b){d.Show(a,b)}self=this;var d=a.$new(),e="fdDlgNewsFeed",f="";self.Show=function(a,b){var d=$("#"+e),h="/__post/ViewTemplate/PopupNewsFeed?id="+a;h+=c.GetParamRnd(h),$.get(h,{},function(c){f=c,g(a,b)}).fail(function(a){c.Log(a)})}};return d}"use strict",angular.module("FoodyApp").factory("DlgNewsFeed",a),a.$inject=["$rootScope","$compile","Helper"]})()
;(function(){function a(a,b,c,d){var e=new function(){function i(a,b,c){if(f)return;if(!h){f=!0;var e="/__get/ViewTemplate/PopupLogin";e+=d.GetParamRnd(e),$.get(e,{},function(d){h=d,j(a,!1,b,c)}).fail(function(a){d.Log(a)})}else k(a,b,c)}function j(a,c,d,i){var j=null;c?j=angular.element("#"+g):(j=angular.element(h),angular.element("body").append(j),b(j)(e)),e=j.scope(),e.$apply(),f=!1,k(a,d,i)}function k(a,b,c){e.Show?(e.Show(a,c),d.RunFnc(b)):j(a,!0,b,c)}function l(a){var b="/__get/Common/IsLogin";b+=d.GetParamRnd(b),c.get(b).then(function(b){b=b.data;if(!b){e.IsLoading=!1;return}a(b)}).catch(function(a){d.Log(a),e.IsLoading=!1})}self=this;var e=a.$new(),f=!1,g="fdDlgLogin",h="";self.Show=function(a,b,c,e){b?i(a,c,e):l(function(b){b.success!=1?i(a,c,e):(d.RunFnc(c),d.RunFnc(a,{LoggedIn:!0}))})}};return e}"use strict",angular.module("FoodyApp").factory("DlgLogin",a),a.$inject=["$rootScope","$compile","$http","Helper"]})()
;(function(){function Helper($window){function ParseDateJson(jsonDate){return eval("new /Date(1473677304343)/".replace(/\//g,""))}function ScrollShowTop(a,b){var c=$(a).offset(),d=$("html, body");d.stop().animate({scrollTop:c.top+b},"500","swing",function(){})}function RunFnc(a,b){typeof a=="function"&&a(b)}function GetParamRnd(a){var b=(new Date).getTime(),c=(a?a.indexOf("?")>-1?"&":"?":"")+"t="+b;return c}function Log(a,b){console.log(a)}function GetCurrentUser(a,b){b==1&&(_isRequestUser=!1);if(_currentUser||_isRequestUser){RunFnc(a,_currentUser);return}if(_isGettingUser){$window.setTimeout(function(){GetCurrentUser(a)},500);return}_isGettingUser=!0;var c="/__get/Common/CurrentUser",d=GetParamRnd(c);$.post(c+d,{},function(b){_currentUser=b,_isGettingUser=!1,_isRequestUser=!0,RunFnc(a,_currentUser)}).fail(function(a){_isGettingUser=!1,Log(a)})}function GetUrlParams(a){var b="";for(var c in a)c&&a[c]!=undefined&&a[c]!=null&&(b+=(b!=""?"&":"")+c+"="+a[c]);return b}function DateFormat(a){var b=new Date(parseInt(a.substr(6))),c=b,d=((new Date).getTime()-c.getTime())/1e3,e=Math.floor(d/86400);if(isNaN(e)||e<0)return;return isNaN(e)||e>28?GetDate(b):e==0&&(d<60&&Text.TimeFormat.JustNow||d<120&&Text.TimeFormat.OneMinuteAgo||d<3600&&Math.floor(d/60)+Text.TimeFormat.MinutesAgo||d<7200&&Text.TimeFormat.OneHourAgo||d<86400&&Math.floor(d/3600)+Text.TimeFormat.HoursAgo)||e==1&&Text.TimeFormat.Yesterday||e<7&&e+Text.TimeFormat.DaysAgo||e<29&&Math.ceil(e/7)+Text.TimeFormat.WeeksAgo}function GetDate(a){var b=a,c=b.getDate(),d=b.getMonth()+1,e=b.getFullYear();c<10&&(c="0"+c),d<10&&(d="0"+d);var b=c+"/"+d+"/"+e;return b}function CountWord(a){if(a==undefined||a.trim()=="")return 0;var b="",c=0,d=0,e=a?a.split(/\s+/):0;if(e)for(var f=0;f<e.length;f++){var g=e[f],h=g.match(/[\u0E00-\u0E7F]+/g);if(h!=null){h=h.join("");var i=h.split("");for(var j=0;j<i.length;j++)UnicodeNsm.indexOf(escape(i[j]))==-1&&d++}else c++}return c+d}function CountWordThai(a){return a==undefined||a.trim()==""?0:(a=a.replace(/\s/g,"").replace(/[่้๊๋์ํ๎]/g,""),a.length)}var _currentUser=null,_date=new Date,_isGettingUser=!1,_isRequestUser=!1,UnicodeNsm=["%u0300","%u0301","%u0302","%u0303","%u0304","%u0305","%u0306","%u0307","%u0308","%u0309","%u030A","%u030B","%u030C","%u030D","%u030E","%u030F","%u0310","%u0311","%u0312","%u0313","%u0314","%u0315","%u0316","%u0317","%u0318","%u0319","%u031A","%u031B","%u031C","%u031D","%u031E","%u031F","%u0320","%u0321","%u0322","%u0323","%u0324","%u0325","%u0326","%u0327","%u0328","%u0329","%u032A","%u032B","%u032C","%u032D","%u032E","%u032F","%u0330","%u0331","%u0332","%u0333","%u0334","%u0335","%u0336","%u0337","%u0338","%u0339","%u033A","%u033B","%u033C","%u033D","%u033E","%u033F","%u0340","%u0341","%u0342","%u0343","%u0344","%u0345","%u0346","%u0347","%u0348","%u0349","%u034A","%u034B","%u034C","%u034D","%u034E","%u034F","%u0350","%u0351","%u0352","%u0353","%u0354","%u0355","%u0356","%u0357","%u0358","%u0359","%u035A","%u035B","%u035C","%u035D","%u035E","%u035F","%u0360","%u0361","%u0362","%u0363","%u0364","%u0365","%u0366","%u0367","%u0368","%u0369","%u036A","%u036B","%u036C","%u036D","%u036E","%u036F","%u0483","%u0484","%u0485","%u0486","%u0487","%u0591","%u0592","%u0593","%u0594","%u0595","%u0596","%u0597","%u0598","%u0599","%u059A","%u059B","%u059C","%u059D","%u059E","%u059F","%u05A0","%u05A1","%u05A2","%u05A3","%u05A4","%u05A5","%u05A6","%u05A7","%u05A8","%u05A9","%u05AA","%u05AB","%u05AC","%u05AD","%u05AE","%u05AF","%u05B0","%u05B1","%u05B2","%u05B3","%u05B4","%u05B5","%u05B6","%u05B7","%u05B8","%u05B9","%u05BA","%u05BB","%u05BC","%u05BD","%u05BF","%u05C1","%u05C2","%u05C4","%u05C5","%u05C7","%u0610","%u0611","%u0612","%u0613","%u0614","%u0615","%u0616","%u0617","%u0618","%u0619","%u061A","%u064B","%u064C","%u064D","%u064E","%u064F","%u0650","%u0651","%u0652","%u0653","%u0654","%u0655","%u0656","%u0657","%u0658","%u0659","%u065A","%u065B","%u065C","%u065D","%u065E","%u065F","%u0670","%u06D6","%u06D7","%u06D8","%u06D9","%u06DA","%u06DB","%u06DC","%u06DF","%u06E0","%u06E1","%u06E2","%u06E3","%u06E4","%u06E7","%u06E8","%u06EA","%u06EB","%u06EC","%u06ED","%u0711","%u0730","%u0731","%u0732","%u0733","%u0734","%u0735","%u0736","%u0737","%u0738","%u0739","%u073A","%u073B","%u073C","%u073D","%u073E","%u073F","%u0740","%u0741","%u0742","%u0743","%u0744","%u0745","%u0746","%u0747","%u0748","%u0749","%u074A","%u07A6","%u07A7","%u07A8","%u07A9","%u07AA","%u07AB","%u07AC","%u07AD","%u07AE","%u07AF","%u07B0","%u07EB","%u07EC","%u07ED","%u07EE","%u07EF","%u07F0","%u07F1","%u07F2","%u07F3","%u0816","%u0817","%u0818","%u0819","%u081B","%u081C","%u081D","%u081E","%u081F","%u0820","%u0821","%u0822","%u0823","%u0825","%u0826","%u0827","%u0829","%u082A","%u082B","%u082C","%u082D","%u0859","%u085A","%u085B","%u08E4","%u08E5","%u08E6","%u08E7","%u08E8","%u08E9","%u08EA","%u08EB","%u08EC","%u08ED","%u08EE","%u08EF","%u08F0","%u08F1","%u08F2","%u08F3","%u08F4","%u08F5","%u08F6","%u08F7","%u08F8","%u08F9","%u08FA","%u08FB","%u08FC","%u08FD","%u08FE","%u0900","%u0901","%u0902","%u093A","%u093C","%u093E","%u0941","%u0942","%u0943","%u0944","%u0945","%u0946","%u0947","%u0948","%u094D","%u0951","%u0952","%u0953","%u0954","%u0955","%u0956","%u0957","%u0962","%u0963","%u0981","%u09BC","%u09C1","%u09C2","%u09C3","%u09C4","%u09CD","%u09E2","%u09E3","%u0A01","%u0A02","%u0A3C","%u0A41","%u0A42","%u0A47","%u0A48","%u0A4B","%u0A4C","%u0A4D","%u0A51","%u0A70","%u0A71","%u0A75","%u0A81","%u0A82","%u0ABC","%u0AC1","%u0AC2","%u0AC3","%u0AC4","%u0AC5","%u0AC7","%u0AC8","%u0ACD","%u0AE2","%u0AE3","%u0B01","%u0B3C","%u0B3F","%u0B41","%u0B42","%u0B43","%u0B44","%u0B4D","%u0B56","%u0B62","%u0B63","%u0B82","%u0BC0","%u0BCD","%u0C3E","%u0C3F","%u0C40","%u0C46","%u0C47","%u0C48","%u0C4A","%u0C4B","%u0C4C","%u0C4D","%u0C55","%u0C56","%u0C62","%u0C63","%u0CBC","%u0CBF","%u0CC6","%u0CCC","%u0CCD","%u0CE2","%u0CE3","%u0D41","%u0D42","%u0D43","%u0D44","%u0D4D","%u0D62","%u0D63","%u0DCA","%u0DD2","%u0DD3","%u0DD4","%u0DD6","%u0E31","%u0E34","%u0E35","%u0E36","%u0E37","%u0E38","%u0E39","%u0E3A","%u0E47","%u0E48","%u0E49","%u0E4A","%u0E4B","%u0E4C","%u0E4D","%u0E4E","%u0EB1","%u0EB4","%u0EB5","%u0EB6","%u0EB7","%u0EB8","%u0EB9","%u0EBB","%u0EBC","%u0EC8","%u0EC9","%u0ECA","%u0ECB","%u0ECC","%u0ECD","%u0F18","%u0F19","%u0F35","%u0F37","%u0F39","%u0F71","%u0F72","%u0F73","%u0F74","%u0F75","%u0F76","%u0F77","%u0F78","%u0F79","%u0F7A","%u0F7B","%u0F7C","%u0F7D","%u0F7E","%u0F80","%u0F81","%u0F82","%u0F83","%u0F84","%u0F86","%u0F87","%u0F8D","%u0F8E","%u0F8F","%u0F90","%u0F91","%u0F92","%u0F93","%u0F94","%u0F95","%u0F96","%u0F97","%u0F99","%u0F9A","%u0F9B","%u0F9C","%u0F9D","%u0F9E","%u0F9F","%u0FA0","%u0FA1","%u0FA2","%u0FA3","%u0FA4","%u0FA5","%u0FA6","%u0FA7","%u0FA8","%u0FA9","%u0FAA","%u0FAB","%u0FAC","%u0FAD","%u0FAE","%u0FAF","%u0FB0","%u0FB1","%u0FB2","%u0FB3","%u0FB4","%u0FB5","%u0FB6","%u0FB7","%u0FB8","%u0FB9","%u0FBA","%u0FBB","%u0FBC","%u0FC6","%u102D","%u102E","%u102F","%u1030","%u1032","%u1033","%u1034","%u1035","%u1036","%u1037","%u1039","%u103A","%u103D","%u103E","%u1058","%u1059","%u105E","%u105F","%u1060","%u1071","%u1072","%u1073","%u1074","%u1082","%u1085","%u1086","%u108D","%u109D","%u135D","%u135E","%u135F","%u1712","%u1713","%u1714","%u1732","%u1733","%u1734","%u1752","%u1753","%u1772","%u1773","%u17B4","%u17B5","%u17B7","%u17B8","%u17B9","%u17BA","%u17BB","%u17BC","%u17BD","%u17C6","%u17C9","%u17CA","%u17CB","%u17CC","%u17CD","%u17CE","%u17CF","%u17D0","%u17D1","%u17D2","%u17D3","%u17DD","%u180B","%u180C","%u180D","%u18A9","%u1920","%u1921","%u1922","%u1927","%u1928","%u1932","%u1939","%u193A","%u193B","%u1A17","%u1A18","%u1A56","%u1A58","%u1A59","%u1A5A","%u1A5B","%u1A5C","%u1A5D","%u1A5E","%u1A60","%u1A62","%u1A65","%u1A66","%u1A67","%u1A68","%u1A69","%u1A6A","%u1A6B","%u1A6C","%u1A73","%u1A74","%u1A75","%u1A76","%u1A77","%u1A78","%u1A79","%u1A7A","%u1A7B","%u1A7C","%u1A7F","%u1B00","%u1B01","%u1B02","%u1B03","%u1B34","%u1B36","%u1B37","%u1B38","%u1B39","%u1B3A","%u1B3C","%u1B42","%u1B6B","%u1B6C","%u1B6D","%u1B6E","%u1B6F","%u1B70","%u1B71","%u1B72","%u1B73","%u1B80","%u1B81","%u1BA2","%u1BA3","%u1BA4","%u1BA5","%u1BA8","%u1BA9","%u1BAB","%u1BE6","%u1BE8","%u1BE9","%u1BED","%u1BEF","%u1BF0","%u1BF1","%u1C2C","%u1C2D","%u1C2E","%u1C2F","%u1C30","%u1C31","%u1C32","%u1C33","%u1C36","%u1C37","%u1CD0","%u1CD1","%u1CD2","%u1CD4","%u1CD5","%u1CD6","%u1CD7","%u1CD8","%u1CD9","%u1CDA","%u1CDB","%u1CDC","%u1CDD","%u1CDE","%u1CDF","%u1CE0","%u1CE2","%u1CE3","%u1CE4","%u1CE5","%u1CE6","%u1CE7","%u1CE8","%u1CED","%u1CF4","%u1DC0","%u1DC1","%u1DC2","%u1DC3","%u1DC4","%u1DC5","%u1DC6","%u1DC7","%u1DC8","%u1DC9","%u1DCA","%u1DCB","%u1DCC","%u1DCD","%u1DCE","%u1DCF","%u1DD0","%u1DD1","%u1DD2","%u1DD3","%u1DD4","%u1DD5","%u1DD6","%u1DD7","%u1DD8","%u1DD9","%u1DDA","%u1DDB","%u1DDC","%u1DDD","%u1DDE","%u1DDF","%u1DE0","%u1DE1","%u1DE2","%u1DE3","%u1DE4","%u1DE5","%u1DE6","%u1DFC","%u1DFD","%u1DFE","%u1DFF","%u20D0","%u20D1","%u20D2","%u20D3","%u20D4","%u20D5","%u20D6","%u20D7","%u20D8","%u20D9","%u20DA","%u20DB","%u20DC","%u20E1","%u20E5","%u20E6","%u20E7","%u20E8","%u20E9","%u20EA","%u20EB","%u20EC","%u20ED","%u20EE","%u20EF","%u20F0","%u2CEF","%u2CF0","%u2CF1","%u2D7F","%u2DE0","%u2DE1","%u2DE2","%u2DE3","%u2DE4","%u2DE5","%u2DE6","%u2DE7","%u2DE8","%u2DE9","%u2DEA","%u2DEB","%u2DEC","%u2DED","%u2DEE","%u2DEF","%u2DF0","%u2DF1","%u2DF2","%u2DF3","%u2DF4","%u2DF5","%u2DF6","%u2DF7","%u2DF8","%u2DF9","%u2DFA","%u2DFB","%u2DFC","%u2DFD","%u2DFE","%u2DFF","%u302A","%u302B","%u302C","%u302D","%u3099","%u309A","%uA66F","%uA674","%uA675","%uA676","%uA677","%uA678","%uA679","%uA67A","%uA67B","%uA67C","%uA67D","%uA69F","%uA6F0","%uA6F1","%uA802","%uA806","%uA80B","%uA825","%uA826","%uA8C4","%uA8E0","%uA8E1","%uA8E2","%uA8E3","%uA8E4","%uA8E5","%uA8E6","%uA8E7","%uA8E8","%uA8E9","%uA8EA","%uA8EB","%uA8EC","%uA8ED","%uA8EE","%uA8EF","%uA8F0","%uA8F1","%uA926","%uA927","%uA928","%uA929","%uA92A","%uA92B","%uA92C","%uA92D","%uA947","%uA948","%uA949","%uA94A","%uA94B","%uA94C","%uA94D","%uA94E","%uA94F","%uA950","%uA951","%uA980","%uA981","%uA982","%uA9B3","%uA9B6","%uA9B7","%uA9B8","%uA9B9","%uA9BC","%uAA29","%uAA2A","%uAA2B","%uAA2C","%uAA2D","%uAA2E","%uAA31","%uAA32","%uAA35","%uAA36","%uAA43","%uAA4C","%uAAB0","%uAAB2","%uAAB3","%uAAB4","%uAAB7","%uAAB8","%uAABE","%uAABF","%uAAC1","%uAAEC","%uAAED","%uAAF6","%uABE5","%uABE8","%uABED","%uFB1E","%uFE00","%uFE01","%uFE02","%uFE03","%uFE04","%uFE05","%uFE06","%uFE07","%uFE08","%uFE09","%uFE0A","%uFE0B","%uFE0C","%uFE0D","%uFE0E","%uFE0F","%uFE20","%uFE21","%uFE22","%uFE23","%uFE24","%uFE25","%uFE26","%u101FD","%u10A01","%u10A02","%u10A03","%u10A05","%u10A06","%u10A0C","%u10A0D","%u10A0E","%u10A0F","%u10A38","%u10A39","%u10A3A","%u10A3F","%u11001","%u11038","%u11039","%u1103A","%u1103B","%u1103C","%u1103D","%u1103E","%u1103F","%u11040","%u11041","%u11042","%u11043","%u11044","%u11045","%u11046","%u11080","%u11081","%u110B3","%u110B4","%u110B5","%u110B6","%u110B9","%u110BA","%u11100","%u11101","%u11102","%u11127","%u11128","%u11129","%u1112A","%u1112B","%u1112D","%u1112E","%u1112F","%u11130","%u11131","%u11132","%u11133","%u11134","%u11180","%u11181","%u111B6","%u111B7","%u111B8","%u111B9","%u111BA","%u111BB","%u111BC","%u111BD","%u111BE","%u116AB","%u116AD","%u116B0","%u116B1","%u116B2","%u116B3","%u116B4","%u116B5","%u116B7","%u16F8F","%u16F90","%u16F91","%u16F92","%u1D167","%u1D168","%u1D169","%u1D17B","%u1D17C","%u1D17D","%u1D17E","%u1D17F","%u1D180","%u1D181","%u1D182","%u1D185","%u1D186","%u1D187","%u1D188","%u1D189","%u1D18A","%u1D18B","%u1D1AA","%u1D1AB","%u1D1AC","%u1D1AD","%u1D242","%u1D243","%u1D244","%uE0100","%uE0101","%uE0102","%uE0103","%uE0104","%uE0105","%uE0106","%uE0107","%uE0108","%uE0109","%uE010A","%uE010B","%uE010C","%uE010D","%uE010E","%uE010F","%uE0110","%uE0111","%uE0112","%uE0113","%uE0114","%uE0115","%uE0116","%uE0117","%uE0118","%uE0119","%uE011A","%uE011B","%uE011C","%uE011D","%uE011E","%uE011F","%uE0120","%uE0121","%uE0122","%uE0123","%uE0124","%uE0125","%uE0126","%uE0127","%uE0128","%uE0129","%uE012A","%uE012B","%uE012C","%uE012D","%uE012E","%uE012F","%uE0130","%uE0131","%uE0132","%uE0133","%uE0134","%uE0135","%uE0136","%uE0137","%uE0138","%uE0139","%uE013A","%uE013B","%uE013C","%uE013D","%uE013E","%uE013F","%uE0140","%uE0141","%uE0142","%uE0143","%uE0144","%uE0145","%uE0146","%uE0147","%uE0148","%uE0149","%uE014A","%uE014B","%uE014C","%uE014D","%uE014E","%uE014F","%uE0150","%uE0151","%uE0152","%uE0153","%uE0154","%uE0155","%uE0156","%uE0157","%uE0158","%uE0159","%uE015A","%uE015B","%uE015C","%uE015D","%uE015E","%uE015F","%uE0160","%uE0161","%uE0162","%uE0163","%uE0164","%uE0165","%uE0166","%uE0167","%uE0168","%uE0169","%uE016A","%uE016B","%uE016C","%uE016D","%uE016E","%uE016F","%uE0170","%uE0171","%uE0172","%uE0173","%uE0174","%uE0175","%uE0176","%uE0177","%uE0178","%uE0179","%uE017A","%uE017B","%uE017C","%uE017D","%uE017E","%uE017F","%uE0180","%uE0181","%uE0182","%uE0183","%uE0184","%uE0185","%uE0186","%uE0187","%uE0188","%uE0189","%uE018A","%uE018B","%uE018C","%uE018D","%uE018E","%uE018F","%uE0190","%uE0191","%uE0192","%uE0193","%uE0194","%uE0195","%uE0196","%uE0197","%uE0198","%uE0199","%uE019A","%uE019B","%uE019C","%uE019D","%uE019E","%uE019F","%uE01A0","%uE01A1","%uE01A2","%uE01A3","%uE01A4","%uE01A5","%uE01A6","%uE01A7","%uE01A8","%uE01A9","%uE01AA","%uE01AB","%uE01AC","%uE01AD","%uE01AE","%uE01AF","%uE01B0","%uE01B1","%uE01B2","%uE01B3","%uE01B4","%uE01B5","%uE01B6","%uE01B7","%uE01B8","%uE01B9","%uE01BA","%uE01BB","%uE01BC","%uE01BD","%uE01BE","%uE01BF","%uE01C0","%uE01C1","%uE01C2","%uE01C3","%uE01C4","%uE01C5","%uE01C6","%uE01C7","%uE01C8","%uE01C9","%uE01CA","%uE01CB","%uE01CC","%uE01CD","%uE01CE","%uE01CF","%uE01D0","%uE01D1","%uE01D2","%uE01D3","%uE01D4","%uE01D5","%uE01D6","%uE01D7","%uE01D8","%uE01D9","%uE01DA","%uE01DB","%uE01DC","%uE01DD","%uE01DE","%uE01DF","%uE01E0","%uE01E1","%uE01E2","%uE01E3","%uE01E4","%uE01E5","%uE01E6","%uE01E7","%uE01E8","%uE01E9","%uE01EA","%uE01EB","%uE01EC","%uE01ED","%uE01EE","%uE01EF"],myHelper={ParseDateJson:ParseDateJson,ScrollShowTop:ScrollShowTop,RunFnc:RunFnc,GetParamRnd:GetParamRnd,Log:Log,GetCurrentUser:GetCurrentUser,GetUrlParams:GetUrlParams,DateFormat:DateFormat,CountWord:CountWord,CountWordThai:CountWordThai};return myHelper}"use strict",angular.module("FoodyApp").factory("Helper",Helper),Helper.$inject=["$window"]})()
;(function(){function dateTimeJson(){return function(value){if(!value)return value;var date=eval(("new "+value).replace(/\//g,"")),dd=date.getDate(),MM=date.getMonth()+1,yy=date.getFullYear();CountryId==76&&LanguageId==1&&(yy+=543);var HH=date.getHours(),mm=date.getMinutes();return mm<10?dd+"/"+MM+"/"+yy+" "+HH+":0"+mm:dd+"/"+MM+"/"+yy+" "+HH+":"+mm}}"use strict",angular.module("FoodyApp").filter("dateTimeJson",dateTimeJson)})(),function(){function dateTimeJson(){return function(value){if(!value)return value;var date=eval(("new "+value).replace(/\//g,"")),dd=date.getDate(),MM=date.getMonth()+1,yy=date.getFullYear();CountryId==76&&LanguageId==1&&(yy+=543);var HH=date.getHours(),mm=date.getMinutes();return mm<10?HH+":0"+mm+" - "+dd+"/"+MM+"/"+yy:HH+":"+mm+" - "+dd+"/"+MM+"/"+yy}}"use strict",angular.module("FoodyApp").filter("dateTimeJsonDetail",dateTimeJson)}()
;(function(){function a(){return function(a,b){return b*=1,a*=1,window.isNaN(a)?"":(window.isNaN(b)&&(b=0),a.format("n"+b))}}"use strict",angular.module("FoodyApp").filter("formatN",a)})(),function(){function a(a){return function(b){if(window.isNaN(b))return"";var c=initData.CountryId==76?2:0;return a("number")(b,c)}}"use strict",angular.module("FoodyApp").filter("numberLg",a),a.$inject=["$filter"]}(),function(){function a(){return function(a,b,c){return b*=1,a*=1,window.isNaN(a)?"":(window.isNaN(b)&&(b=0),a.format("n"+b)+c)}}"use strict",angular.module("FoodyApp").filter("formatNUnit",a)}()
;(function(){function a(){return function(a,b){var c,d,e=["k","M","G","T","P","E"];return window.isNaN(a)?"":a<1e3?a:(c=Math.floor(Math.log(a)/Math.log(1e3)),(a/Math.pow(1e3,c)).toFixed(b)+e[c-1])}}"use strict",angular.module("FoodyApp").filter("formatNK",a)})()
;(function(){function a(){return function(a){return a*=1,window.isNaN(a)?"":a>=10?"10":a>0?a.format("n1"):"_._"}}"use strict",angular.module("FoodyApp").filter("formatPoint",a)})()
;(function(){function a(a){return function(b){return b?a.trustAsResourceUrl(b):""}}"use strict",angular.module("FoodyApp").filter("trustedUrl",a),a.$inject=["$sce"]})()
;(function(){function a(a,b,c,d,e,f){function k(){var a=0;if(window.jsonDataSearch){a=h.getFilterIds(jsonDataSearch.selectedCategories).length,a+=h.getFilterIds(jsonDataSearch.selectedDistricts).length;var b=h.getFilterIds(jsonDataSearch.selectedCuisines),c=[];$.each(b,function(a,b){$.inArray(b,c)===-1&&c.push(b)}),a+=c.length,a+=h.getFilterItems(jsonDataSearch.selectedPrices).length}return a}function l(){b.$$phase||b.$apply()}function m(){b.IsShow=!0,b.ChangeType(b.Filter.Type)}function n(){b.IsShow=!1}function o(c){var d="/__get/Directory/GetSearchFilter";d+=e.GetParamRnd(d),a.get(d+"&"+e.GetUrlParams({ds:b.Filter.DS,vt:b.Filter.VT,st:b.Filter.ST,q:b.Filter.Keyword,filter:b.Filter.Type,provinceId:b.Filter.CityId})).then(function(a){a=a.data,e.RunFnc(c,a)}).catch(function(){e.RunFnc(c)})}function p(a,c){switch(b.Filter.Type){case"category":b.Data.allCategories==null&&(b.Data.allCategories=a.allCategories?a.allCategories:[],window.jsonDataSearch&&q(b.Data.allCategories,jsonDataSearch.selectedCategories));break;case"area":if(!b.Data.allAreas||b.Data.allAreas.length<1)b.Data.allAreas=a.allAreas?a.allAreas:[],window.jsonDataSearch&&q(b.Data.allAreas,jsonDataSearch.selectedAreas);break;case"district":if(!b.Data.allDistricts||b.Data.allDistricts.length<1)b.Data.allDistricts=a.allDistricts?a.allDistricts:[],window.jsonDataSearch&&q(b.Data.allDistricts,jsonDataSearch.selectedDistricts);break;case"purpose":b.Data.allPurposes=a.allPurposes?a.allPurposes:[],window.jsonDataSearch&&q(b.Data.allPurposes,jsonDataSearch.selectedPurposes);break;case"cuisine":if(!b.Data.allCuisines||b.Data.allCuisines.length<1)b.Data.allCuisines=a.allCuisines?a.allCuisines:[],window.jsonDataSearch&&q(b.Data.allCuisines,jsonDataSearch.selectedCuisines);break;case"property":b.Data.allProperties=a.allProperties?a.allProperties:[],window.jsonDataSearch&&q(b.Data.allProperties,jsonDataSearch.selectedProperties);break;case"dining":b.Data.allDinings=a.allDinings?a.allDinings:[],window.jsonDataSearch&&q(b.Data.allDinings,jsonDataSearch.selectedDinings);break;case"price":b.Data.allPrices=a.allPrices?a.allPrices:[],window.jsonDataSearch&&q(b.Data.allPrices,jsonDataSearch.selectedPrices);break;default:}e.RunFnc(c,a)}function q(a,b){if(!a)return;if(!b)return;for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)a[c].Id==b[d].Id&&(a[c].Selected=!0)}function r(a){if(!a)return;for(var b=0;b<a.length;b++)a[b].Selected=!1}var g,h=this,i=c,j={IsShow:!1};b.FilterCount=0,b.Data={allAreas:null,allDistricts:null,allPurposes:[],allCategories:null,allDinings:[],allCuisines:null,allProperties:[],allPrices:[]},b.Filter={Type:"district",DS:"Restaurant",VT:"row",ST:1,Keyword:""},h.$scope=b,b.Html="",b.IsLoading=!1,b.IsClearFilter=!1,b.ChangeType=function(a){b.Filter.Type=a,b.IsLoading=!0,b.IsLoadingType=a,o(function(a){p(a,function(){b.IsLoading=!1,b.IsLoadingType="",j.Ready?l():setTimeout(function(){j.Ready=!0,l()},1e3)})})},b.Hide=function(){b.IsShow=!1,l()},b.Show=function(c){if($("#fdDlgSearchFilter").length<1){b.IsLoading=!0;var d="/__get/ViewTemplate/PopupSearchFilter";d+=e.GetParamRnd(d)+"&cityId="+b.Filter.CityId,a.get(d).then(function(a){a=a.data,b.Html=a,m(),b.IsLoading=!1}).catch(function(){})}else b.IsShow==0?(b.IsShow=!0,window.jsonDataSearch&&(q(b.Data.allCategories,jsonDataSearch.selectedCategories),q(b.Data.allDistricts,jsonDataSearch.selectedDistricts),q(b.Data.allCuisines,jsonDataSearch.selectedCuisines),q(b.Data.allPrices,jsonDataSearch.selectedPrices))):n()},b.ChangePrice=function(a){for(var c=0;c<b.Data.allPrices.length;c++)var d=b.Data.allPrices[c].Selected=!1;a.Selected=!0},b.Search=function(){l();var c=h.getFilterParamters(!0);a.get("/__get/Directory/GetSearchUrl"+c).then(function(a){a=a.data,a.Url?location.href=a.Url:location.href=b.Filter.UrlDefault}),console.log(c)},h.getFilterIds=function(a){var b=[];for(var c=0;c<a.length;c++){var d=a[c];if(d.Selected==1){b.push(d.Id);if(d.Children&&d.Children.length>0){var e=h.getFilterIds(d.Children);for(var f=0;f<e.length;f++)b.push(e[f])}}}return b},h.getFilterItems=function(a){var b=[];for(var c=0;c<a.length;c++){var d=a[c];if(d.Selected==1){b.push(d);if(d.Children&&d.Children.length>0){var e=h.getFilterItems(d.Children);for(var f=0;f<e.length;f++)b.push(e[f])}}}return b},h.checkExists=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return!0;return!1},h.getFilterIdsString=function(a){var b=h.getFilterIds(a);return b.join(",")},h.getFilterParamters=function(a){var c="dtids=",d="dt=";if(b.Data.allDistricts&&b.Data.allDistricts.length>0){var e=h.getFilterIdsString(b.Data.allDistricts);e.trim().length>1?c+=e:e.trim().length==1&&(d+=e)}var f="ar=";b.Data.allAreas&&b.Data.allAreas.length>0&&(f+=h.getFilterIdsString(b.Data.allAreas));var g="pp=";b.Data.allPurposes&&b.Data.allPurposes.length>0&&(g+=h.getFilterIdsString(b.Data.allPurposes));var i="c=";b.Data.allCategories&&b.Data.allCategories.length>0&&(i+=h.getFilterIdsString(b.Data.allCategories));var j="dn=";b.Data.allDinings&&b.Data.allDinings.length>0&&(j+=h.getFilterIdsString(b.Data.allDinings));var k="cs=";b.Data.allCuisines&&b.Data.allCuisines.length>0&&(k+=h.getFilterIdsString(b.Data.allCuisines));var l="pr=";b.Data.allProperties&&b.Data.allProperties.length>0&&(l+=h.getFilterIdsString(b.Data.allProperties));var m="";if(b.Data.allPrices||b.Data.allPrices.length>0){var n=h.getFilterItems(b.Data.allPrices);n.length>0&&(m="prmn="+n[0].Min+"&prmx="+n[0].Max)}var o="page=1&append=false&ds="+b.Filter.DS+"&vt="+b.Filter.VT+"&provinceId="+b.Filter.CityId+"&st="+b.Filter.ST;i!="c="&&(o+="&categoryId="+b.Filter.CateId);if(!b.Filter.Keyword||b.Filter.Keyword.trim()==""){var p=$("#pkeywords")[0];b.Filter.Keyword=p.value}if(b.Filter.Keyword&&b.Filter.Keyword.trim()!=""){var q=b.Filter.Keyword.trim();q=q.replace("&","u0026"),o+="&q="+q}return c!="dtids="&&(o+="&"+c),d!="dt="&&(o+="&"+d),f!="ar="&&(o+="&"+f),g!="pp="&&(o+="&"+g),i!="c="&&(o+="&"+i),j!="dn="&&(o+="&"+j),k!="cs="&&(o+="&"+k),l!="pr="&&(o+="&"+l),m!=""&&(o+="&"+m),a?"?"+o:o},b.Init=function(a){b.Filter.CityId=a.CityId,b.Filter.UrlDefault=a.Url,b.FilterCount=k(),window.jsonDataSearch&&(window.jsonDataSearch.districtId&&(b.Filter.DistrictId=jsonDataSearch.districtId+""),window.jsonDataSearch.categoryId&&(b.Filter.CateId=jsonDataSearch.categoryId)),$(window).on("click",function(a){var c=$(a.target).parents(".search-bar-top");if(c.length>0)return;b.IsShow=!1,l()})},b.ClearFilter=function(){b.Filter.DistrictId="",b.Data.allAreas=[],r(b.Data.allAreas),r(b.Data.allDistricts),r(b.Data.allPurposes),r(b.Data.allCategories),r(b.Data.allDinings),r(b.Data.allCuisines),r(b.Data.allProperties),r(b.Data.allPrices),b.IsClearFilter=!0},b.LoadCategory=function(){g&&d.cancel(g),g=d(function(){b.ClearFilter(),b.ChangeType(b.Filter.Type)},1e3)}}"use strict",angular.module("FoodyApp").controller("DlgSearchFilterCtrl",a),a.$inject=["$http","$scope","$element","$timeout","Helper","DlgSearchFilter"]})()
;(function(){function a(a,b,c,d,e,f,g,h){var i=this;i.$scope=b,b.ResId="",b.RevId="",b.IsLoading=!1,b.ShowDlgWriteReview=function(a,b){d.Show(a,b)},b.ShowDlgUploadPhoto=function(a,b){e.Show(a,b)},b.ShowDlgReport=function(a,b){f.Show(a,b)},b.ShowDlgLogin=function(a){g.Show(a)},b.Init=function(a){if(!a)return}}"use strict",angular.module("FoodyApp").controller("HelperCtrl",a),a.$inject=["$http","$scope","$element","DlgWriteReview","DlgUploadPhoto","DlgPopupReport","DlgLogin","Helper"]})()
;(function(){function a(a,b,c,d){function f(b){a.get("/__get/Common/GetPopupLocation",{}).then(function(a){a=a.data,d.RunFnc(b,a)})}function g(a){b.IsLoading=!0,f(function(c){b.Model=c,b.IsLoading=!1,b.IsLoadHtml=!0,d.RunFnc(a,c)})}function h(){b.IsShow=!b.IsShow}function i(a){var b=[],c=0;for(var d=0;d<a.length;d++)c=a[d].CityId,b.indexOf(c)<0&&b.push(c);return b}function j(a){var b=[];for(var c=0;c<a.length;c++)b.push(a[c].Id);return b}function k(a){var c=null;for(var d=0;d<b.Model.AllLocations.length;d++)if(b.Model.AllLocations[d]["Id"]==a)return b.Model.AllLocations[d];return c}var e=this;b.HtmlForm='<div class="arrow-up"></div>',b.IsLoading=!1,b.Locations=[],b.Districts=[],b.IsShow=!1,b.IsLoadHtml=!1,b.Show=function(){h(),b.IsLoadHtml||g(function(){})},b.Init=function(a){if(!a)return;$(window).on("click",function(a){var c=$(a.target).parents("#head-province");if(c.length>0)return;b.IsShow=!1,b.$$phase||b.$apply()})},b.FilterLocation=function(a){b.Locations=c(b.Model.AllLocations,a);var d=j(b.Locations);b.Districts=c(b.Model.AllDistricts,a);var e=i(b.Districts);for(var f=0;f<e.length;f++){var g=e[f];if(d.indexOf(e[f])<0){var h=k(g);h&&b.Locations.push(h)}}}}"use strict",angular.module("FoodyApp").controller("LocationCtrl",a),a.$inject=["$http","$scope","filterFilter","Helper"]})()
;(function(){function a(a,b,c,d){function e(a){$.get("/__get/Notification/GetSummaryNew",{},function(b){if(!b||b.error)return;a(b)}).error(function(a){})}function f(a,c){if(!a)return;c=c?c*1:0,setTimeout(function(){b.SummaryOrder=a.TotalOrderUnRead,b.SummarySocial=a.TotalSocialUnRead,b.SummaryNews=a.TotalNewsUnRead,b.$apply()},c)}function g(){b.IsShow=!b.IsShow}function h(){var d="/__get/Common/IsLogin";d+=c.GetParamRnd(d),a.get(d).then(function(a){a=a.data;if(!a)return;b.IsLoginRequire=!a.success}).catch(function(a){a=a.data,c.Log(a)})}function i(a,c){if(!c)return;switch(a){case 1:for(var d in c.Items){var e=c.Items[d];e.DateDisplay=l(e.DateStamp),b.ListOrder.Items.push(e)}b.ListOrder.Total=c.TotalResult,b.ListOrder.LastId=c.LastId,b.$apply();break;case 2:for(var d in c.Items){var e=c.Items[d];e.DateDisplay=l(e.DateStamp),b.ListSocial.Items.push(e)}b.ListSocial.Total=c.TotalResult,b.ListSocial.CurrentTotal=c.Items.length,b.ListSocial.LastId=c.LastId,b.$apply();break;case 3:for(var d in c.Items){var e=c.Items[d];e.DateDisplay=l(e.DateTimestamp),b.ListNews.Items.push(e)}b.ListNews.Total=c.TotalResult,b.ListNews.LastId=c.LastId,b.$apply()}}function j(a){if(b.IsInit)return;b.IsLoading=!0,b.ListOrder.IsLoading=!0,b.ListSocial.IsLoading=!0,b.ListNews.IsLoading=!0,k(function(a){b.IsShowNews=a.IsShowNews,i(1,a.ListOrder),i(2,a.ListSocial),i(3,a.ListNews),f(a.Summary,2e3),b.ListOrder.IsLoading=!1,b.ListSocial.IsLoading=!1,b.ListNews.IsLoading=!1,!b.IsLoginRequire||!b.IsShowNews?b.TabClick(2):b.TabClick(3),b.IsLoading=!1,b.IsInit=!0,b.$apply()})}function k(a){$.get("/__get/Notification/NotificationsNew",{},function(b){if(!b||b.error){console.log(b);return}a(b)}).error(function(a){console.log(a)})}function l(a){var b="";if(a!=undefined&&a!=0){var c=864e5,d=36e5,e=6e4,f=new Date,g=new Date(a*1e3),h=f-g,i=Math.floor(h/c),j=Math.floor(h%c/d),k=Math.round(h%c%d/e);if(i==3&&j>0||i>3)var l=g.getMonth()+1>9?g.getMonth()+1:"0"+(g.getMonth()+1),m=g.getDate()>9?g.getDate():"0"+g.getDate(),n=g.getHours()>9?g.getHours():"0"+g.getHours(),o=g.getMinutes()>9?g.getMinutes():"0"+g.getMinutes(),b=m+"/"+l+"/"+g.getFullYear()+" "+n+":"+o;else i>0?b=i+" "+Text.timelive.days:j>0?b=j+" "+Text.timelive.hours:b=k+" "+Text.timelive.mins}return b}b.DefineModel=function(){b.ListOrder={Total:0,LastId:0,Count:0,Items:[],CountUnread:0,IsLoading:!1},b.ListSocial={Total:0,LastId:0,Count:0,Items:[],CountUnread:0,IsLoading:!1,CurrentTotal:0},b.ListNews={Total:0,LastId:0,Count:0,Items:[],CountUnread:0,IsLoading:!1}},b.IsShowNews=!1,b.IsLoading=!1,b.IsShow=!1,b.IsLoadHtml=!1,b.ActiveTab=2,b.IsInit=!1,b.NewsCount=0,b.SummaryOrder=0,b.SummarySocial=0,b.SummaryNews=0,b.Summary={Notify:{Total:0,UnRead:0},News:{Total:0,UnRead:0}},b.SummaryTotalUnread=function(){var a=b.SummaryOrder+b.SummarySocial+b.SummaryNews;return a>0?a:""},b.Show=function(){g(),h(),j()},b.TabClick=function(a){a=a?a*1:1,b.ActiveTab=a;switch(a){case 1:if(b.IsLoginRequire||b.SummaryOrder==0)return;$.get("/__get/Notification/MarkAsReadNew",{type:1},function(a){if(!a||a.error){console.log(a);return}setTimeout(function(){b.SummaryOrder=0},2e3)}).error(function(a){console.log(a)});break;case 2:if(b.IsLoginRequire||b.SummarySocial==0)return;$.get("/__get/Notification/MarkAsReadNew",{type:2},function(a){if(!a||a.error){console.log(a);return}setTimeout(function(){b.SummarySocial=0},2e3)}).error(function(a){console.log(a)});break;case 3:if(b.IsLoginRequire||b.SummaryNews==0)return;$.get("/__get/Notification/MarkAsReadNew",{type:3},function(a){if(!a||a.error){console.log(a);return}setTimeout(function(){b.SummaryNews=0},2e3)}).error(function(a){console.log(a)})}},b.LoadMore=function(a){a=a?a*1:1;switch(a){case 1:b.ListOrder.IsLoading=!0,b.$apply(),$.get("/__get/Notification/NotificationsNewLoadMore",{lastId:b.ListOrder.LastId,type:"order"},function(a){if(!a||a.error){console.log(a);return}i(1,a),b.ListOrder.IsLoading=!1,b.$apply()}).error(function(a){console.log(a)});break;case 2:b.ListSocial.IsLoading=!0,$.get("/__get/Notification/NotificationsNewLoadMore",{lastId:b.ListSocial.LastId,type:"social"},function(a){if(!a||a.error){console.log(a);return}i(2,a),b.ListSocial.IsLoading=!1,b.$apply()}).error(function(a){console.log(a)});break;case 3:b.ListNews.IsLoading=!0,b.$apply(),$.get("/__get/Notification/ListNews",{lastId:b.ListNews.LastId},function(a){if(!a||a.error){console.log(a);return}i(3,a),b.ListNews.IsLoading=!1,b.$apply()}).error(function(a){console.log(a)})}},b.Login=function(){d.Show(function(a){a.LoggedIn&&(b.IsLoginRequire=!1,b.Reset())})},b.Reset=function(){b.DefineModel(),b.IsInit=!1,j()},$("#tab-social").scroll(function(){self.timeOutScroll&&clearTimeout(self.timeOutScroll),self.timeOutScroll=setTimeout(function(){var a=$("#tab-social").scrollTop(),c=$("#tab-social").height();a>c-150&&b.LoadMore(2)},100)}),$("#tab-order").scroll(function(){self.timeOutScroll&&clearTimeout(self.timeOutScroll),self.timeOutScroll=setTimeout(function(){var a=$("#tab-order").scrollTop(),c=$("#tab-order").height();a>c-150&&b.ListOrder.Total-b.ListOrder.Items.length>0&&b.LoadMore(1)},100)}),$("#tab-news").scroll(function(){self.timeOutScroll&&clearTimeout(self.timeOutScroll),self.timeOutScroll=setTimeout(function(){var a=$("#tab-news").scrollTop(),c=$("#tab-news").height();a>c-150&&b.ListNews.Total-b.ListNews.Items.length>0&&b.LoadMore(3)},100)}),b.Init=function(a){b.UserId=a,b.IsLoginRequire=!(b.UserId>0),b.DefineModel(),e(function(a){f(a)}),$(window).on("click",function(a){var c=$(a.target).parents("#NotificationCtrl");if(c.length>0)return;b.IsShow=!1,b.$$phase||b.$apply()})}}"use strict",angular.module("FoodyApp").controller("NotificationCtrl",a),a.$inject=["$http","$scope","Helper","DlgLogin"]})()
;(function(){function a(a,b,c,d,e){var f=this,g=d,h=null;f.$scope=b,b.ReportContent="",b.Show=function(a,d,e){c.LastTypeReport==a?c.LastReferenceId!=d&&(b.Success=-1,b.Submited=!1,b.ReportContent="",c.LastReferenceId=d):(c.LastTypeReport=a,c.LastReferenceId=d),b.TypeReport=a,b.ReferenceId=d,b.SetPostionPopup()},b.IsLoading=!1,b.SubmitReport=function(){switch(b.TypeReport){case 1:if(b.ReportContent.trim()!=""){var a={reviewId:b.ReferenceId,type:2,errorkeyname:$("#fdDlgReport .errorkeyname").text(),correctinfo:b.ReportContent,istrue:!1,reporturl:window.location.href};$.post("/Review/AddReportError",a,function(a){a.success?b.safeApply(function(){b.Success=1,b.Submited=!0,b.ReportContent=""}):b.safeApply(function(){b.Success=0})})}else b.safeApply(function(){b.Success=2});break;default:}},b.SetPostionPopup=function(){var a=$("*[data-report='report_"+b.TypeReport+"_"+b.ReferenceId+"']"),c=a.offset();$("#fdDlgReport").css("display","block"),$("#fdDlgReport").css("top",c.top+32+"px"),$("#fdDlgReport").css("left",c.left-120+"px"),$("#fdDlgReport").css("display","block")},b.safeApply=function(a){var b=this.$root.$$phase;b=="$apply"||b=="$digest"?a&&typeof a=="function"&&a():this.$apply(a)},$(window).scroll(function(){$("#fdDlgReport").css("display","none")})}"use strict",angular.module("FoodyApp").controller("ReportCtrl",a),a.$inject=["$http","$scope","$rootScope","$element","Helper"]})()
;(function(){function a(a,b,c,d){function h(){var a=f.parents().find('div[ng-controller="PopupCommonCtrl"]');g=a.bPopup({closeClass:"fd-btn-close",followSpeed:0})}function i(){g&&g.close()}var e=this,f=c,g=null;e.$scope=b,b.IsLoading=!1,b.Model={},b.Show=function(a,c){b.Model.Title=a.Title,b.Model.Content=a.Content,b.$$phase||b.$apply(),h()}}"use strict",angular.module("FoodyApp").controller("PopupCommonCtrl",a),a.$inject=["$http","$scope","$element","Helper"]})()
;(function(){function a(a,b,c,d,e,f,g){c.ShowPopupReviews=function(a){g.Show(a)},c.ShowPopupGallery=function(a){f.Show(a)}}"use strict",angular.module("FoodyApp").controller("GalleryPopupController",a),a.$inject=["$http","$rootScope","$scope","$routeParams","Helper","DlgGallery","DlgReviews"]})()
;(function(){function a(a,b,c,d){function h(a){b.ReviewId=a,b.LastReviewId!=b.ReviewId&&(b.$apply(function(){b.IsLoading=!0}),$.get("/__get/Review/GetReviewInfo?reviewId="+b.ReviewId,function(a){b.$apply(function(){b.Model=a}),b.LoadRating(),b.$apply(function(){b.IsLoading=!1})}).error(function(){})),b.LastReviewId=b.ReviewId,b.SetPostionPopup(b.ReviewId)}var e=this,f=c,g=null;e.$scope=b,b.Show=function(a,b){h(a)},b.IsLoading=!1,b.LoadRating=function(){var a=b.Model.Position*10,c=b.Model.Price*10,d=b.Model.Food*10,e=b.Model.Services*10,f=b.Model.Atmosphere*10;$("#positionBar").progressbar({value:a}),$("#priceBar").progressbar({value:c}),$("#foodBar").progressbar({value:d}),$("#serviceBar").progressbar({value:e}),$("#atmosphereBar").progressbar({value:f})},b.SetPostionPopup=function(){var a=$(".foody-box-review").find("[data-review='review_"+b.ReviewId+"']"),c=a.offset();$("#fdDlgReviewRating").css("position","absolute"),$("#fdDlgReviewRating").css("top",c.top+32+"px"),$("#fdDlgReviewRating").css("left",c.left-120+"px"),$("#fdDlgReviewRating").css("display","block")}}"use strict",angular.module("FoodyApp").controller("ReviewRatingCtrl",a),a.$inject=["$http","$scope","$element","Helper"]})()
;(function(){function a(a,b,c,d,e){function g(a,c){var d=$(".avatar-user");d.length===1?b.IsLogin=!0:b.IsLogin=!1,b.UserId=a,b.ReviewId=c;if(b.LastUserId!==b.UserId||b.IsLogin!==b.LastIsLogin)b.IsLoading=!0,$.get("/__get/Review/GetUserInfoReview?userId="+b.UserId,function(a){b.$apply(function(){b.Model=a,b.IsLoading=!1})}).error(function(){b.IsLoading=!1});b.LastIsLogin=b.IsLogin,b.LastUserId=b.UserId,b.LastReviewId=b.ReviewId,b.SetPostionPopup()}var f=this;f.$scope=b,b.Show=function(a,b,c){g(a,b)},b.IsLoading=!1,b.FollowToggle=function(c){e.Show(function(e){if(e.LoggedIn){var f="/follow/"+c.Id,g=d.GetParamRnd(f);b.IsLoading=!0,a.post(f+g,{}).then(function(a){a=a.data,b.IsLoading=!1,b.Model.IsFollow=a.follow}).catch(function(){b.IsLoading=!1})}})},b.HidePopup=function(){$("#fdDlgUserInfoReview").hide()},b.SetPostionPopup=function(){var a=$(".foody-box-review").find("[data-user='review_"+b.ReviewId+"_user_"+b.UserId+"']"),c=a.offset();$("#fdDlgUserInfoReview").css("position","absolute"),$("#fdDlgUserInfoReview").css("top",c.top+40+"px"),$("#fdDlgUserInfoReview").css("left",c.left-80+"px"),$("#fdDlgUserInfoReview").css("display","block")}}"use strict",angular.module("FoodyApp").controller("UserInfoReviewCtrl",a),a.$inject=["$http","$scope","$element","Helper","DlgLogin"]})()
;(function(){function a(a,b,c){var d=this;d.$scope=b,b.UserId=0,b.RestaurantId=0,b.TotalReviews=0,b.TotalCheckIns=0,b.TotalFriends=0,b.ListFriends=[],b.Items=[],b.UrlImgBg="",b.Total=0,b.LastId=0,b.IsLoading=!1,b.IsFirst=!0,b.IsLoadMore=function(){return b.Total-b.Items.length>0},b.LoadMore=function(){if(b.IsLoading===!0||b.IsFirst===!1&&b.IsLoadMore()!==!0)return;$(".microsite-reviews-box").css("display","none"),$(".microsite-user-info-reviews-box").css("padding-bottom","0"),b.IsLoading=!0;var d="/__get/Review/UserReviewLoadMore";d+=c.GetParamRnd(d),a.get(d+"&"+c.GetUrlParams({ResId:b.RestaurantId,Count:b.Count,LastId:b.LastId,isLatest:!0})).then(function(a){a=a.data,b.Count=a.Count,b.LastId=a.LastId,b.Total=a.Total,b.IsFirst=!1;var c=a.Items;for(var d=0;d<c.length;d++){var e=c[d];e.UrlLoad=b.UrlImgBg,b.Items.push(e)}}).catch(function(){}),b.IsLoading=!1},b.Init=function(a){a=window[a];if(!a)return;b.UserId=a.UserId,b.RestaurantId=a.RestaurantId,b.TotalReviews=a.TotalReviews,b.TotalCheckIns=a.TotalCheckIns,b.TotalFriends=a.TotalFriends,b.UrlImgBg=a.UrlImgBg;var c=a.ListFriends;if(c)for(var d=0;d<c.length;d++){var e=c[d];b.ListFriends.push(e)}setTimeout(function(){window._scollTopToolbar&&_scollTopToolbar()},1e3)}}"use strict",angular.module("FoodyApp").controller("UserReviewInfoCtrl",a),a.$inject=["$http","$scope","Helper"]})()
;(function(){function a(a,b,c,d,e,f,g){function l(a){var b="v",c=(new RegExp("[?&]"+b+"=([^&#]*)")).exec(a);return c==null?null:c[1]||0}function m(){b.$$phase||b.$apply()}function n(){try{$("#dwr-tab-rating").tooltipster("content",ReviewText.RequiredPointMsg),$("#dwr-tab-rating").tooltipster("open"),h._timeOutToolTip&&clearTimeout(h._timeOutToolTip),h._timeOutToolTip=setTimeout(function(){$("#dwr-tab-rating").tooltipster("content",""),$("#dwr-tab-rating").tooltipster("close")},3e3)}catch(a){}}function o(){try{$(".dlg-write-review .btn-submit").tooltipster("content",ErrorText.Input_Review_Content),$(".dlg-write-review .btn-submit").tooltipster("open"),h._timeOutToolTipComment&&clearTimeout(h._timeOutToolTipComment),h._timeOutToolTipComment=setTimeout(function(){$(".dlg-write-review .btn-submit").tooltipster("content",""),$(".dlg-write-review .btn-submit").tooltipster("close")},3e3)}catch(a){}}function p(){try{setTimeout(function(){$("#btn-add-imgtag").tooltipster("content","You can tag menu here"),$("#btn-add-imgtag").tooltipster("open")},2e3),h._timeOutToolTipImage&&clearTimeout(h._timeOutToolTipImage),h._timeOutToolTipComment=setTimeout(function(){$("#btn-add-imgtag").tooltipster("content",""),$("#btn-add-imgtag").tooltipster("close")},6e3)}catch(a){}}function q(){$("#dwr-content-title").tooltipster("content","Please write your title"),$("#dwr-content-title").tooltipster("open"),h._timeOutToolTipComment&&clearTimeout(h._timeOutToolTipComment),h._timeOutToolTipComment=setTimeout(function(){$("#dwr-content-title").tooltipster("close")},3e3)}function r(){var a=i.parents().find('div[ng-controller="DlgWriteReviewCtrl"]');j=a.bPopup({closeClass:"fd-btn-close",followSpeed:0,modalClose:!1,escClose:!1,onClose:function(){b.ReviewId=null,t()},onOpen:function(){b.Pictures=[],b.TabVisible=1,b.HashtagModel=""}})}function s(){j&&j.close()}function t(){clearTimeout(h._timeOutTitle),clearTimeout(h._timeOutSaveDraft),clearTimeout(h._timeOutPicDes),clearTimeout(h._timeOutHastag),clearInterval(h._timeIntervalSaveDraft)}function u(c){var d="/__get/Restaurant/GetSummary";d+=e.GetParamRnd(d),a.get(d+"&"+e.GetUrlParams({ResId:b.ResId})).then(function(a){a=a.data,e.RunFnc(c,a)}).catch(function(){e.RunFnc(c)})}function v(a,d){b.SummaryRes=a,setTimeout(function(){var a=c.find(".fldr-rating .range");a.each(function(){var a=$(this).data("val");$(this).progressbar({value:a*10})})},500),e.RunFnc(d,a)}function w(a,b){b<=6?$(a.handle).parent().find(".ui-slider-range").css("background",""):b==7?$(a.handle).parent().find(".ui-slider-range").css("background","#ff6a00"):b==8?$(a.handle).parent().find(".ui-slider-range").css("background","#d0d320"):b==9?$(a.handle).parent().find(".ui-slider-range").css("background","#9dff00"):b==10&&$(a.handle).parent().find(".ui-slider-range").css("background","#03ae03")}function x(a){var c="Save review";return!b.Data.Comment||b.Data.Comment.length<1?(a==1&&o(),!1):!b.Data.Ratings.Food||b.Data.Ratings.Food<0||!b.Data.Ratings.Position||b.Data.Ratings.Position<0||!b.Data.Ratings.Price||b.Data.Ratings.Price<0||!b.Data.Ratings.Services||b.Data.Ratings.Services<0||!b.Data.Ratings.Atmosphere||b.Data.Ratings.Atmosphere<0?(a==1&&n(),!1):!0}function y(c){var d="/__get/Review/GetDraftReview";d+=e.GetParamRnd(d),a.get(d+"&"+e.GetUrlParams({ResId:b.ResId,ReviewId:b.ReviewId})).then(function(a){a=a.data,e.RunFnc(c,a)}).catch(function(){e.RunFnc(c)})}function z(a,d){b.ReviewId=a.Review.ReviewId,b.Data=a.Review,b.Authen=a.Authen,window.listTag=b.Data.ListTag,b.YoutubeCodeChange(!0),h._isBindRating!=1&&setTimeout(function(){var a=c.find(".rating-box .range");a.each(function(){var a=this,c=$(this).data("val");c=c?c:5;var d=$(this).data("name");setTimeout(function(){w({handle:a},c)},500),$(this).slider({range:"min",value:c,min:1,max:10,slide:function(a,c){b.Data.Ratings[d]=c.value,w(c,c.value),m()},change:function(a,c){b.Data.Ratings[d]=c.value,b.Data.Ratings.Food||(b.Data.Ratings.Food=5),b.Data.Ratings.Price||(b.Data.Ratings.Price=5),b.Data.Ratings.Position||(b.Data.Ratings.Position=5),b.Data.Ratings.Services||(b.Data.Ratings.Services=5),b.Data.Ratings.Atmosphere||(b.Data.Ratings.Atmosphere=5),b.ChangeContent(),m()}})}),$(".dlg-write-review .dwr-tooltip").tooltipster({trigger:"custom"}),h._isBindRating=!0},500),e.RunFnc(d,a)}function A(c){var d="/__get/AutoComplete/SuggestReviewTitle";d+=e.GetParamRnd(d),a.get(d+"&"+e.GetUrlParams({term:b.Data.Title})).then(function(a){a=a.data,b.ListSuggestTitles=[];if(!a||a.length<1)return;for(var d=0;d<a.length;d++)b.ListSuggestTitles.push({Name:a[d].value});e.RunFnc(c),m()}).catch(function(){})}function B(a,c,d){r(),b.IsLoading=!0,b.ReviewId=c,a!=b.ResId&&(b.ResId=a,u(function(a){v(a,function(){j.reposition(),b.IsLoading=!1})})),b.IsLoading=!0,y(function(a){z(a,function(){a.Review.ReviewId>0?D(function(a){b.IsLoading=!1,E(a,function(){})}):b.IsLoading=!1})})}function C(a){return{Id:a.id,BgColor:"",Description:a.niceName,Height:0,Width:0,PredefineAlbumID:a.predefineId,Url:a.thumbnail_url,UrlBig:a.thumbnail_url.replace("s145x145","s750").replace("s160x160","s750"),Data:a,IsLoading:!1,IsEditing:!1}}function D(c){var d="/WebServices/UploadHandler.ashx";d+=e.GetParamRnd(d),a.get(d+"&"+e.GetUrlParams({c:b.ReviewId})).then(function(a){a=a.data,e.RunFnc(c,a)}).catch(function(){e.RunFnc(c)})}function E(a,d){if(!a||a.length<1)return;for(var f=0;f<a.length;f++)b.Pictures.push(C(a[f]));b.PicTotalPage=Math.ceil(b.Pictures.length/b.PicPageSize),b.PicPageIdx=0,setTimeout(function(){c.find(".content .c-pictures .scroll").perfectScrollbar("destroy"),c.find(".content .c-pictures .scroll").perfectScrollbar()},1e3),e.RunFnc(d,a)}function F(){var d=c.find('input[name="rev-pic-file"]')[0].files,e=G(d);if(!e){c.find('input[name="rev-pic-file"]').val("");return}if(!d)return;b.PreLoadPic=[];for(var f=0;f<d.length;f++)b.PreLoadPic.push(f);b.IsUploading=!0,a({method:"POST",url:k.UrlUploadPicture,headers:{"Content-Type":undefined,"X-Foody-User-Token":b.Authen.UserToken},data:{r:b.ResId,t:"other",token:k.Token},transformRequest:function(a,b){var c=new FormData;angular.forEach(a,function(a,b){c.append(b,a)});for(var e=0;e<d.length;e++)c.append("File-"+e,d[e]);return c}}).then(function(d){d=d.data;if(!d||d.length<1)return;E(d),a.post("/__post/Review/SavePicturesAsDraft",{reviewId:b.ReviewId,tokenKey:k.Token}).then(function(a){a=a.data,b.IsUploading=!1,setTimeout(function(){var a=c.find(".content .c-pictures .scroll");a.scrollLeft(a[0].scrollWidth+7).perfectScrollbar("update")},500)}).catch(function(){b.IsUploading=!1})})}function G(a){if(!a||a.length<1)return!1;var b=/(png)|(jpe?g)|(gif)$/i,c="";for(var d=0;d<a.length;d++){var e=a[d].type;if(!b.test(e)){c=CommonText.InvalidUploadFile;break}}if(c!="")return alert(c),!1;for(d=0;d<a.length;d++){var f=a[d].size;if(f>1012e4){c=CommonText.InvalidUploadFileSize;break}}return c!=""?(alert(c),!1):!0}function H(c){a.post("/__post/Upload/SaveReviewPictures",{reviewId:b.Data.ReviewId,restaurantId:b.Data.ResId,type:"other",tokenKey:k.Token,realPictureIds:"",editMode:!1}).then(function(a){a=a.data,e.RunFnc(c,!0)})}function I(a){if(a.lengthComputable){var b=Math.round(a.loaded*100/a.total);document.getElementById("progressNumber").innerHTML=b.toString()+"%"}}function J(){var e=c.find('input[name="video-foody"]')[0].files,f=K(e);if(!f)return;if(!e)return;b.IsUploadingVideo=!0,h._Canceller=d.defer(),b.VideoProgress.Percent=0;var g=a({method:"POST",url:b.Authen.Url,headers:{"Content-Type":undefined,"X-Foody-Client-Version":"1.0","X-Foody-Client-Name":b.Authen.ClientName,"X-Foody-Client-Type":b.Authen.ClientType,"X-Foody-User-Token":b.Authen.UserToken,"X-Foody-Random-Key":b.Authen.RandomKey,"X-Foody-Access-Timestamp":b.Authen.Timestamp,"X-Foody-Access-Token":b.Authen.AccessToken},transformRequest:function(a,b){var c=new FormData;angular.forEach(a,function(a,b){c.append(b,a)});for(var d=0;d<e.length;d++)c.append("File-"+d,e[d]);return c},uploadEventHandlers:{progress:function(a){b.VideoProgress.Loaded=a.loaded,b.VideoProgress.Total=a.total,b.VideoProgress.Time=a.timeStamp,b.VideoProgress.Percent=parseInt(b.VideoProgress.Loaded/b.VideoProgress.Total*100/10,0)}}}).then(function(a){a=a.data,b.Data.Video.Source="/video-embed/foody-video-"+a.Video.Id,b.Data.Video.Type=2,b.Data.Video.Id=a.Video.Id,b.IsUploadingVideo=!1,b.ChangeContent()}).catch(function(a,c,d,e,f){a=a.data,b.IsUploadingVideo=!1,console.log(a),alert("Upload Fail!")})}function K(a){var b=/(mp4)|(flv)|(mov)|(m3u8)$/i,c="";for(var d=0;d<a.length;d++){var e=a[d].type;if(!b.test(e)){c=CommonText.InvalidUploadFile;break}}if(c!="")return alert(c),!1;for(d=0;d<a.length;d++){var f=a[d].size;if(f>31457280){c=CommonText.InvalidUploadVideoSize;break}}return c!=""?(alert(c),!1):!0}function L(a){return{Id:a.id,Name:a.text}}function M(c,d){if(c==1&&x(c)!=1){e.RunFnc(d,!1);return}t(),b.IsAutoSave=!0;var f=$("#review-content").html(),g=$("#mention-review-user").val(),h="";if(c)h="/__post/Review/Save";else if(!b.IsEditing)h="/__post/Review/SaveAsDraft";else{b.IsAutoSave=!1,e.RunFnc(d,!1);return}h+=e.GetParamRnd(h),a.post(h,{ReviewId:b.Data.ReviewId,Title:b.Data.Title,Comment:f,YoutubeCode:b.Data.YoutubeCode,Ratings:b.Data.Ratings,Settings:b.Data.Settings,Options:{GuestId:b.Data.Options.GuestId,MoneySpendId:b.Data.Options.MoneySpendId,VisitAgainId:b.Data.Options.VisitAgainId},Hashtag:b.Data.Hashtag,ResId:b.Data.ResId,TagUsers:g}).then(function(a){a=a.data,b.IsAutoSave=!1,a&&a.Success==1&&(b.Data.ReviewId=a.ReviewId,b.UrlDetail=a.UrlDetail),e.RunFnc(d,!0)}).catch(function(){b.IsAutoSave=!1,e.RunFnc(d,!1)})}var h=this,i=c,j=null,k={};h.$scope=b,b.ResId="",b.IsLoading=!1,b.IsEditing=!1,b.IsUploading=!1,b.ImageTagEnt={RestId:null,DishId:null,DishName:null,PhotoId:null},b.TagImage="",b.TabVisible=1,b.SetTabVisible=function(a){b.TabVisible=a},b.PicTotalPage=0,b.PicPageIdx=0,b.PicPageSize=5,b.Pictures=[],b.ListMenuImageTag=[],b.IsEditingPicture=!1,b.HideSuggestTitles=!0,b.ListSuggestTitles=[],b.ListSuggestHashtags=[],b.HideSuggestHashtags=!0,b.HashtagModel="",b.YoutubeUrl="",b.YoutubeCodeChange=function(a){h._timeOutYoutubeCode&&clearTimeout(h._timeOutYoutubeCode),h._timeOutYoutubeCode=setTimeout(function(){b.Data.YoutubeCode?(b.Data.YoutubeCode.indexOf("youtube.com")>-1&&(b.Data.YoutubeCode=l(b.Data.YoutubeCode)),b.YoutubeUrl="//www.youtube-nocookie.com/embed/"+b.Data.YoutubeCode+"?rel=0"):b.YoutubeUrl="",a||b.ChangeContent(),m()},1e3)},b.VideoProgress={Percent:0},b.SuggestTitles=function(){h._timeOutTitle&&clearTimeout(h._timeOutTitle),h._timeOutTitle=setTimeout(function(){A(function(){b.HideSuggestTitles=b.ListSuggestTitles.length<1,b.ChangeContent()})},1e3)},b.PickupTitle=function(a){b.Data.Title=a.Name.trim(),b.HideSuggestTitles=!0,M()},b.HidePanelSuggestTitles=function(){setTimeout(function(){b.HideSuggestTitles=!0,m()},500)},b.ChangeContent=function(){h._timeOutSaveDraft&&clearTimeout(h._timeOutSaveDraft),h._timeOutSaveDraft=setTimeout(function(){M()},3e3)},b.Show=function(a,c,d,e){d=d||!1,b.IsEditing=d,B(a,c,e)},b.SetPictureUpload=function(a){$('input[name="rev-pic-file"]')[0].files=a},b.PickupPicture=function(){if(b.Data.ReviewId<1)return f.Show({Title:"Upload photos",Content:"Please input title and write content before upload photos"}),!1;c.find('input[name="rev-pic-file"]').click()},b.ChangePictureType=function(b,c){b.IsLoading=!0;var d="/__post/Upload/UpdatePictureType";d+=e.GetParamRnd(d),a.post(d,{pictureId:b.Id,type:c}).then(function(a){a=a.data;if(!a||a.Success!=1)return;b.PredefineAlbumID=c,b.IsLoading=!1,c==2&&p()}).catch(function(){})},b.UpdatePictureDes=function(b){h._timeOutPicDes&&clearTimeout(h._timeOutPicDes),h._timeOutPicDes=setTimeout(function(){var c="/__post/Upload/SavePicturesName";c+=e.GetParamRnd(c),b.IsLoading=!0,m(),a.post(c,{pictureId:b.Id,name:b.Description}).then(function(a){a=a.data;if(!a||a.Success!=1)return;b.IsLoading=!1,m()}).catch(function(){b.IsLoading=!1,m()})},1e3)},b.RemovePictrue=function(d){if(!confirm("Are you sure?"))return;var e=d.Data.delete_url;e=e.replace("images.","media."),d.IsLoading=!0,a({method:"POST",url:e,headers:{"X-Foody-User-Token":b.Authen.UserToken}}).then(function(e){e=e.data;if(!e||e.Success!=1)return;for(var f=0;f<b.Pictures.length;f++)if(b.Pictures[f].Id==d.Id){b.Pictures.splice(f,1),b.PicTotalPage=Math.ceil(b.Pictures.length/b.PicPageSize),b.PicPageIdx==b.PicTotalPage&&b.PicPageIdx--;break}a.post("/__post/Review/SavePicturesAsDraft",{reviewId:b.ReviewId,tokenKey:k.Token}).then(function(a){a=a.data,c.find(".content .c-pictures .scroll").perfectScrollbar("update")}).catch(function(){})})},b.EditPictrue=function(a){a.IsEditing=!0,b.IsEditingPicture=!0},b.CancelEditPictrue=function(a){a.IsEditing=!1,b.IsEditingPicture=!1},b.CancelUploadVideo=function(){h._Canceller&&h._Canceller.resolve("Cancel Upload Video"),m()},b.PickupVideo=function(){if(b.Data.ReviewId<1)return!1;c.find('input[name="video-foody"]').click()},b.PickupVideoOther=function(){if(!confirm("Are your sure?"))return;a.post("/__post/Review/DeleteVideo",{id:b.Data.Video.Id}).then(function(a){a=a.data;if(!a||a==0){alert("Delete video error!");return}b.Data.Video.Id=null,b.Data.Video.Source=null,b.Data.Video.Type=null,c.find('input[name="video-foody"]').val("")})},b.SuggestHashtags=function(){h._timeOutHastag&&clearTimeout(h._timeOutHastag),h._timeOutHastag=setTimeout(function(){var c="/__get/HashTag/GetHasgtagObjectItems";c+=e.GetParamRnd(c),a.get(c+"&"+e.GetUrlParams({term:b.HashtagModel})).then(function(a){a=a.data,b.ListSuggestHashtags=[];var c=!1;if(!a)return;if(a.length>0)for(var d=0;d<a.length;d++)c==0&&(c=b.HashtagModel.toLocaleLowerCase()==a[d].text.toLocaleLowerCase()),b.ListSuggestHashtags.push(L(a[d]));c==0&&b.ListSuggestHashtags.unshift({Name:b.HashtagModel}),b.HideSuggestHashtags=b.ListSuggestHashtags.length<1,m()}).catch(function(){})},1e3)},b.PickupHashtag=function(a){b.Data.Hashtag.unshift({Id:a.Id,Name:a.Name}),b.HashtagModel="",b.HideSuggestHashtags=!0,b.ChangeContent()},b.RemoveHashtag=function(a){var c=b.Data.Hashtag;for(var d=0;d<c.length;d++)if(c[d].Name==a.Name){b.Data.Hashtag.splice(d,1);break}b.ChangeContent()},b.HidePanelSuggestHashtag=function(){setTimeout(function(){b.HideSuggestHashtags=!0,m()},500)},b.Save=function(){b.IsLoading=!0,M(!0,function(a){a==1?H(function(){b.IsLoading=!1,a==1&&(location.href=b.UrlDetail,s())}):b.IsLoading=!1})},b.Close=function(){b.IsLoading=!0,M(!1,function(a){b.IsLoading=!1;if(a==1||b.IsEditing)b.Data.Video=null,s()})},b.Init=function(a){k.Token=c.find('input[name="rev-pic-token"]').val(),k.UrlUploadPicture=c.find('input[name="rev-pic-url"]').val(),c.find('input[name="rev-pic-file"]').on("change",function(){F()}),c.find('input[name="video-foody"]').on("change",function(){J()})},b.countOf=function(a){var b=e.CountWord(a);return b},b.countOfThai=function(a){var b=e.CountWordThai(a);return b},b.ImageTag=function(c,d){$(d.currentTarget).parent().find("#add-imgtag").slideToggle();if(b.ListMenuImageTag.length==0){var f="/__get/Review/FoodyApiGetRestaurantMenu";f+=e.GetParamRnd(f),a.get(f+"&"+e.GetUrlParams({restaurantId:b.ResId})).then(function(a){a=a.data;if(a.Success&&a.result.group.length>0){for(var c=0;c<a.result.group.length;c++)a.result.group[c].dishes.totalCount>0&&b.ListMenuImageTag.push(a.result.group[c]);m(),setTimeout(function(){treefilter($("#my-tree-imgtag"),{searcher:$("input#my-search-imgtag"),multiselect:!1})},1e3)}}).catch(function(){})}},b.ImageChooseTag=function(a,c){b.ImageTagEnt.RestId=b.ResId,b.ImageTagEnt.DishId=a.id,b.ImageTagEnt.DishName=a.Name,b.ImageTagEnt.PhotoId=c},b.ImageAddTag=function(c){a.post("/__post/Review/FoodyApiSaveTagImage",{RestId:b.ImageTagEnt.RestId,DishId:b.ImageTagEnt.DishId,DishName:b.ImageTagEnt.DishName,PhotoId:b.ImageTagEnt.PhotoId}).then(function(a){a=a.data,c.TagImage=b.ImageTagEnt.DishName,$("#add-imgtag").slideToggle()}).catch(function(){})},$(document).keydown(function(a){a.keyCode==27&&angular.element(document.getElementById("fdDlgWriteReview")).scope().Close()}),$("#dwr-content-comment").on("scroll",function(){var a=$(this).scrollTop();$(".mention-highlight-r").scrollTop(a)}),b.PrevPage=function(){b.PicPageIdx--,b.PicPageIdx<0&&(b.PicPageIdx=0)},b.NextPage=function(){b.PicPageIdx++,b.PicPageIdx>b.PicTotalPage&&(b.PicPageIdx=b.PicTotalPage)}}"use strict",angular.module("FoodyApp").controller("DlgWriteReviewCtrl",a),a.$inject=["$http","$scope","$element","$q","Helper","DlgCommon","DlgLogin"]})()
;(function(){function a(a,b,c,d,e,f,g){function l(){b.$$phase||b.$apply()}function m(){var a=i.parents().find('div[ng-controller="DlgUploadPhotoCtrl"]');j=a.bPopup({closeClass:"fd-btn-close",followSpeed:0,modalClose:!1,escClose:!1,onClose:function(){b.AlbumId=null,o()},onOpen:function(){b.Pictures=[],b.TabVisible=1,b.HashtagModel=""}})}function n(){j&&j.close()}function o(){clearTimeout(h._timeOutTitle),clearTimeout(h._timeOutSaveDraft),clearTimeout(h._timeOutPicDes),clearTimeout(h._timeOutHastag),clearInterval(h._timeIntervalSaveDraft)}function p(c){var d="/__get/Restaurant/GetSummary";d+=e.GetParamRnd(d),a.get(d+"&"+e.GetUrlParams({ResId:b.ResId})).then(function(a){a=a.data,e.RunFnc(c,a)}).catch(function(){e.RunFnc(c)})}function q(a,d){b.SummaryRes=a,b.Title=a.Restaurant.Name,setTimeout(function(){var a=c.find(".fldr-rating .range");a.each(function(){var a=$(this).data("val");$(this).progressbar({value:a*10})})},500),e.RunFnc(d,a)}function r(c){var d="/__get/Photo/GetDrafAlbum";d+=e.GetParamRnd(d),a.get(d+"&"+e.GetUrlParams({ResId:b.ResId,AlbumId:b.AlbumId})).then(function(a){a=a.data,e.RunFnc(c,a)}).catch(function(){e.RunFnc(c)})}function s(a,c){b.AlbumId=a.AlbumId,b.Authen=a.Authen,e.RunFnc(c,a)}function t(a,c,d){m(),b.IsLoading=!0,b.AlbumId=c,a!=b.ResId&&(b.ResId=a,p(function(a){q(a,function(){j.reposition(),b.IsLoading=!1})})),b.IsLoading=!0,r(function(a){s(a,function(){a.AlbumId>0?v(function(a){b.IsLoading=!1,w(a,function(){A()})}):b.IsLoading=!1})})}function u(a){return{Id:a.id,BgColor:"",Description:a.niceName,Height:0,Width:0,PredefineAlbumID:a.predefineId,Url:a.thumbnail_url,UrlBig:a.thumbnail_url.replace("s145x145","s750").replace("s160x160","s750"),Data:a,IsLoading:!1,IsEditing:!1}}function v(c){var d="/WebServices/UploadHandler.ashx";d+=e.GetParamRnd(d),a.get(d+"&"+e.GetUrlParams({album:b.AlbumId})).then(function(a){a=a.data,e.RunFnc(c,a)}).catch(function(){e.RunFnc(c)})}function w(a,d){if(!a||a.length<1)return;for(var f=0;f<a.length;f++)b.Pictures.push(u(a[f]));b.PicTotalPage=Math.ceil(b.Pictures.length/b.PicPageSize),b.PicPageIdx=0,setTimeout(function(){c.find(".content .c-pictures .scroll").perfectScrollbar("destroy"),c.find(".content .c-pictures .scroll").perfectScrollbar()},1e3),e.RunFnc(d,a)}function x(){var d=c.find('input[name="rev-pic-file"]')[0].files,e=y(d);if(!e){c.find('input[name="rev-pic-file"]').val("");return}if(!d)return;b.PreLoadPic=[];for(var f=0;f<d.length;f++)b.PreLoadPic.push(f);b.IsUploading=!0,a({method:"post",url:k.UrlUploadPicture,headers:{"Content-Type":undefined,"X-Foody-User-Token":b.Authen.UserToken},data:{r:b.ResId,t:"other",token:k.Token},transformRequest:function(a,b){var c=new FormData;angular.forEach(a,function(a,b){c.append(b,a)});for(var e=0;e<d.length;e++)c.append("File-"+e,d[e]);return c}}).then(function(c){c=c.data;if(!c||c.length<1)return;w(c),a.post("/__post/Upload/SaveAlbumPicturesAsDraft",{AlbumId:b.AlbumId,tokenKey:k.Token}).then(function(a){a=a.data,b.IsUploading=!1,A()}).catch(function(){b.IsUploading=!1})})}function y(a){if(!a||a.length<1)return!1;var b=/(png)|(jpe?g)|(gif)$/i,c="";for(var d=0;d<a.length;d++){var e=a[d].type;if(!b.test(e)){c=CommonText.InvalidUploadFile;break}}if(c!="")return alert(c),!1;for(d=0;d<a.length;d++){var f=a[d].size;if(f>1012e4){c=CommonText.InvalidUploadFileSize;break}}return c!=""?(alert(c),!1):!0}function z(c){a.post("/__post/Upload/SaveAlbumPictures",{albumId:b.AlbumId,tokenKey:k.Token}).then(function(a){a=a.data,e.RunFnc(c,!0)})}function A(a){var c="Upload";return!b.Pictures||b.Pictures.length<1?(b.IsValid=!1,!1):(b.IsValid=!0,!0)}function B(c,d){if(c==1&&A(c)!=1){e.RunFnc(d,!1);return}o(),b.IsAutoSave=!0;var f=$("#review-content").html(),g=$("#mention-review-user").val(),h="";if(c)h=b.AlbumId>0?"/__post/Gallery/SaveAlbum":"/__post/Gallery/AddNewAlbum";else if(!b.IsEditing)h="/__post/Gallery/SaveAlbumAsDraft";else{b.IsAutoSave=!1,e.RunFnc(d,!1);return}h+=e.GetParamRnd(h),a.post(h,{Title:b.Title,RestaurantId:b.ResId}).then(function(a){a=a.data,b.IsAutoSave=!1,a&&a.Success==1&&(b.AlbumId=a.AlbumId,b.UrlDetail=a.UrlDetail),e.RunFnc(d,!0)}).catch(function(){b.IsAutoSave=!1,e.RunFnc(d,!1)})}var h=this,i=c,j=null,k={};h.$scope=b,b.ResId="",b.IsLoading=!1,b.IsValid=!1,b.IsUploading=!1,b.Pictures=[],b.IsEditingPicture=!1,b.PicTotalPage=0,b.PicPageIdx=0,b.PicPageSize=5,b.Show=function(a,c,d,e){d=d||!1,b.IsEditing=d,t(a,c,e)},b.SetPictureUpload=function(a){$('input[name="rev-pic-file"]')[0].files=a},b.PickupPicture=function(){c.find('input[name="rev-pic-file"]').click()},b.ChangePictureType=function(b,c){b.IsLoading=!0;var d="/__post/Upload/UpdatePictureType";d+=e.GetParamRnd(d),a.post(d,{pictureId:b.Id,type:c}).then(function(a){a=a.data;if(!a||a.Success!=1)return;b.PredefineAlbumID=c,b.IsLoading=!1}).catch(function(){})},b.UpdatePictureDes=function(b){h._timeOutPicDes&&clearTimeout(h._timeOutPicDes),h._timeOutPicDes=setTimeout(function(){var c="/__post/Upload/SavePicturesName";c+=e.GetParamRnd(c),b.IsLoading=!0,l(),a.post(c,{pictureId:b.Id,name:b.Description}).then(function(a){a=a.data;if(!a||a.Success!=1)return;b.IsLoading=!1,l()}).catch(function(){b.IsLoading=!1,l()})},1e3)},b.RemovePictrue=function(d){if(!confirm("Are you sure?"))return;var e=d.Data.delete_url;e=e.replace("images.","media."),d.IsLoading=!0,a({method:"POST",url:e,headers:{"X-Foody-User-Token":b.Authen.UserToken}}).then(function(e){e=e.data,c.find('input[name="rev-pic-file"]').val("");if(!e||e.Success!=1)return;for(var f=0;f<b.Pictures.length;f++)if(b.Pictures[f].Id==d.Id){b.Pictures.splice(f,1),b.PicTotalPage=Math.ceil(b.Pictures.length/b.PicPageSize),b.PicPageIdx==b.PicTotalPage&&b.PicPageIdx--;break}A(),a.post("/__post/Gallery/SaveAlbumAsDraft",{Title:b.Title,RestaurantId:b.ResId}).then(function(a){a=a.data,b.AlbumId=a.AlbumId,b.UrlDetail=a.UrlDetail}).catch(function(){})})},b.EditPictrue=function(a){a.IsEditing=!0,b.IsEditingPicture=!0},b.CancelEditPictrue=function(a){a.IsEditing=!1,b.IsEditingPicture=!1},b.Save=function(){if(!b.IsValid)return;b.IsLoading=!0,B(!0,function(a){a==1?z(function(){b.IsLoading=!1,a==1&&(location.href=b.UrlDetail,n())}):b.IsLoading=!1})},b.Close=function(){b.IsLoading=!0,B(!1,function(a){b.IsLoading=!1,(a==1||b.IsEditing)&&n()})},b.Init=function(a){k.Token=c.find('input[name="rev-pic-token"]').val(),k.UrlUploadPicture=c.find('input[name="rev-pic-url"]').val(),c.find('input[name="rev-pic-file"]').on("change",function(){x()}),c.find('input[name="video-foody"]').on("change",function(){uploadVideo()})},b.countOf=function(a){var b=e.CountWord(a);return b},$(document).keydown(function(a){a.keyCode==27&&angular.element(document.getElementById("fdDlgWriteReview")).scope().Close()}),$("#dwr-content-comment").on("scroll",function(){var a=$(this).scrollTop();$(".mention-highlight-r").scrollTop(a)}),b.PrevPage=function(){b.PicPageIdx--,b.PicPageIdx<0&&(b.PicPageIdx=0)},b.NextPage=function(){b.PicPageIdx++,b.PicPageIdx>b.PicTotalPage&&(b.PicPageIdx=b.PicTotalPage)}}"use strict",angular.module("FoodyApp").controller("DlgUploadPhotoCtrl",a),a.$inject=["$http","$scope","$element","$q","Helper","DlgCommon","DlgLogin"]})()
;(function(){function a(a,b,c,d,e,f,g,h,i,j){function o(){switch(b.Model.DeviceType){case 1:case 8:b.Model.DeviceClass="mobile";break;case 7:b.Model.DeviceClass="tablet";break;case 2:b.Model.DeviceClass="android";break;case 3:b.Model.DeviceClass="windows";default:b.Model.DeviceClass="globe"}}function p(){switch(b.Model.Type){case 4:b.Model.CommentItemType=11;break;case 8:b.Model.CommentItemType=5;break;default:b.Model.CommentItemType=2}}function q(){var a=-1,c=-1,d=b.Model.Pictures;for(var e=0;e<d.length;e++){var f=d[e];f.IsMain=!1,f.TotalLikes>a&&(a=f.TotalLikes,c=e)}return c>-1?(d[c].IsMain=!0,d[c]):null}function r(a){var b=1;a.Size.Top=0,a.Size.Left=0,a.Size.Type=="fh"?(b=a.Size.Height/a.Height,a.Size.iWidth=a.Width*b,a.Size.iHeight=a.Height*b,a.Size.Left=-(a.Width*b-a.Size.Width)/2):(b=a.Size.Width/a.Width,a.Size.iWidth=a.Width*b,a.Size.iHeight=a.Height*b,a.Size.Top=-(a.Height*b-a.Size.Height)/2)}function s(a,b,c){a.Size={},b==1?(a.Size.Width=m.Width,a.Size.Height=a.Height*(a.Size.Width/a.Width),a.Size.Height>700&&(a.Size.Height=700),r(a)):b<6?(a.Size.Width=m.Width/b,a.Size.Height=a.Size.Width,a.Size.iWidth=a.Size.Width,a.Size.iHeight=a.Size.Height,t(a,b)):b==6?(a.Size.Width=m.Width/3,a.Size.Height=a.Size.Width,a.Size.iWidth=a.Size.Width,a.Size.iHeight=a.Size.Height,t(a,3)):b==7?(c<4?(a.Size.Width=m.Width/4,t(a,4)):(a.Size.Width=m.Width/3,t(a,3)),a.Size.Height=a.Size.Width,a.Size.iWidth=a.Size.Width,a.Size.iHeight=a.Size.Height):b==8?(a.Size.Width=m.Width/4,t(a,4),a.Size.Height=a.Size.Width,a.Size.iWidth=a.Size.Width,a.Size.iHeight=a.Size.Height):b==9?(c<4?(a.Size.Width=m.Width/4,t(a,4)):(a.Size.Width=m.Width/5,t(a,5)),a.Size.Height=a.Size.Width,a.Size.iWidth=a.Size.Width,a.Size.iHeight=a.Size.Height):(a.Size.Width=m.Width/5,a.Size.Height=a.Size.Width,a.Size.iWidth=a.Size.Width,a.Size.iHeight=a.Size.Height,t(a,5))}function t(a,b){switch(b){case 5:a.Url=a.Url.replace("s800","s160x160");break;case 4:a.Url=a.Url.replace("s800","s214x214");break;case 3:a.Url=a.Url.replace("s800","s285x285");break;case 2:a.Url=a.Url.replace("s800","s400x400")}}var k=this;k.$scope=b,k.ele=c;var l=null,m={},n;b.Model=null,b.ReviewId=0,b.IsLoading=!1,b.DesMore=!1,b.ToggleDesMore=function(){b.DesMore=!b.DesMore},b.OpenDlgWriteReview=function(a){var c=a,d=!1,e=new Date;$.ajax({type:"GET",url:"/Review/CheckCanEditDelete?reviewId="+c+"&type=0&"+e.getTime(),success:function(a){if(a.Success){d=a.Result;if(d)g.Show(b.Model.ResId,b.Model.Id,!0);else return alert(ReviewText.ReviewEditTimeOut),!1}else switch(a.ErrorType){case 3:alert(ReviewText.NotLogin)}}})},b.CountMorePictures=0,b.IsShowMorePictures=function(a){return a==b.Model.Pictures.length-1&&b.Model.TotalPictures>b.Model.Pictures.length},b.GetImageSizeFull=function(a){return a.Width>a.Height?"fh":"fw"},b.ServiceClick=function(a){a.Id==3&&f.Show(a.RestaurantId)},b.ReviewRatingPopup=function(){n=d(function(){h.Show(b.ReviewId)},500)},b.ReviewRatingPopupHide=function(){d.cancel(n),$("#fdDlgReviewRating").hide()},b.PopupReport=function(){i.Show(b.ReportType,b.ReviewId)},b.UserInfoReviewPopup=function(a){j.Show(a,b.ReviewId)},b.UserInfoReviewPopupHide=function(){$("#fdDlgUserInfoReview").hide()},$(window).on("click",function(a){var b=$(a.target).parents(".review-list");if(b.length>0)return;$("#fdDlgUserInfoReview").hide()}),$(window).scroll(function(){$("#fdDlgUserInfoReview").hide()}),b.ShowLazyPic=function(){var a=b.Model.Pictures,c=a.length;for(var d=0;d<c;d++)a[d].UrlLoad=a[d].Url},b.InitDescription=function(){var a=c.find(".rd-des");setTimeout(function(){a.height()>175&&(b.DesMore=!0,b.$$phase||b.$apply())},500)},b.InitPicture=function(){l=c.find(".review-photos"),m.Width=l.width(),m.Height=l.height(),q();var a=b.Model.Pictures,d=a.length;for(var e=0;e<d;e++)a[e].UrlLoad=b.UrlImgBg,s(a[e],d,e);setTimeout(function(){b.ShowLazyPic(),b.$$phase||b.$apply()},1e3)},b.Init=function(a){b.ReviewId=a.Id,b.ReportType=1;if(!a)return;b.UrlImgBg=b.$parent.UrlImgBg,b.Model=a,o(),b.CountMorePictures=b.Model.TotalPictures-b.Model.Pictures.length,b.ShowLazyPic(),p()}}"use strict",angular.module("FoodyApp").controller("ReviewItemCtrl",a),a.$inject=["$http","$scope","$element","$timeout","Helper","DlgECard","DlgWriteReview","DlgReviewRating","DlgReport","DlgUserInfoReview"]})()
;(function(){function a(a,b,c){function e(d,e){var f="/__get/Review/ResLoadMore";f+=c.GetParamRnd(f),d==1&&(b.LastId=null,b.Count=10),a.get(f+"&"+c.GetUrlParams({ResId:b.ResId,LastId:b.LastId,Count:b.Count,Type:b.Filter.Type,fromOwner:b.Filter.FromOwner,isLatest:b.Filter.IsLatest,HasPicture:b.Filter.HasPicture,ExcludeIds:b.ExcludeIds})).then(function(a){a=a.data,c.RunFnc(e,a)}).catch(function(){c.RunFnc(e)})}function f(a,d,e){a==1&&(b.Items=[]),b.Count=d.Count,b.LastId=d.LastId,b.Total=d.Total;var f=d.Items;for(var g=0;g<f.length;g++){var h=f[g];h.UrlLoad=b.UrlImgBg,h.ShowComment=b.ShowComment,b.Items.push(h)}b.Summary=d.Summary,c.RunFnc(e,d)}function g(d,e){var f="/__get/Review/SheIsResLoadMore";f+=c.GetParamRnd(f),d==1&&(b.LastId=null,b.Count=10),a.get(f+"&"+c.GetUrlParams({SheIsId:b.SheIsId,LastId:b.LastId,Count:b.Count})).then(function(a){a=a.data,c.RunFnc(e,a)}).catch(function(){c.RunFnc(e)})}function h(a,d,e){a==1&&(b.Items=[]),b.Count=d.Count,b.LastId=d.LastId,b.Total=d.Total,b.TotalSheIs=d.Total;var f=d.Items;for(var g=0;g<f.length;g++){var h=f[g];b.Items.push(h)}c.RunFnc(e,d)}function i(){var a=d.ListLazyPics,c=$(window).scrollTop();for(var e=0;e<a.length;e++){var f=a[e].ele.offset();f.top<c+500&&(a[e].$scope.ShowLazyPic(),b.$$phase||b.$apply(),a.splice(e,1))}}function j(b,d){a.post("/__post/Review/GetReviewEx",{id:b}).then(function(a){a=a.data,c.RunFnc(d,a)}).catch(function(){c.RunFnc(d)})}function l(a,d){if(b.IsLoading==1||a==0&&b.IsLoadMore()!=1)return;b.IsLoading=!0,e(a,function(e){f(a,e,function(){setTimeout(i,1e3),b.IsLoading=!1,a==1&&b.ScrollTop(),c.RunFnc(d)})})}function m(a,d){if(b.IsLoading==1)return;b.IsLoading=!0,g(a,function(e){h(a,e,function(){b.IsLoading=!1,a==1&&b.ScrollTop(),c.RunFnc(d)})})}var d=this;d.ListLazyPics=[],d.$scope=b,b.Count=10,b.LastId=null,b.Total=0,b.TotalSheIs="",b.LoadMoreCount=0,b.Items=[],b.Model={},b.PreloadList=[1],b.Filter={Type:"1",FromOwner:"",IsLatest:"true",HasPicture:null},b.ExcludeIds="",b.IsLoading=!1,b.IsLoadMore=function(){return b.Total-b.Items.length>0},b.SetFilterType=function(a){b.Filter.Type!=a&&(b.Filter.Type=a,b.FilterChange())},b.SetFilterOwner=function(a){b.Filter.FromOwner=a?a:"",b.Filter.IsLatest=b.Filter.FromOwner!=""?"false":"true",b.Filter.IsSheIs="false",b.FilterChange()},b.SetFilterIsLatest=function(a){b.Filter.IsLatest=a==1?"true":"false",b.Filter.FromOwner=b.Filter.IsLatest=="true"?"":b.Filter.FromOwner,b.Filter.IsSheIs=a==1?"false":"true",b.FilterChange()},b.SetFilterSheIs=function(a){b.Filter.IsSheIs=a==1?"true":"false",b.Filter.FromOwner="",b.Filter.IsLatest="false",b.FilterChange()},b.AddLazyLoadPic=function(a){d.ListLazyPics.push(a)},b.Init=function(a){a=window[a];if(!a)return;b.SheIsId=a.SheIsId,b.ResId=a.ResId,b.Count=a.Count?a.Count:10,b.LastId=a.LastId,b.Total=a.Total,b.UrlImgBg=a.UrlImgBg,b.ShowComment=a.ShowComment,b.Filter.HasPicture=a.HasPicture,b.Summary=a.Summary,b.ExcludeIds=a.ExcludeIds;var c=a.Items;if(c)for(var e=0;e<c.length;e++){var f=c[e];f.UrlLoad=b.UrlImgBg,f.ShowComment=b.ShowComment,b.Items.push(f)}else b.LoadMore(!0);$(window).scroll(function(){d._timeOut&&clearTimeout(d._timeOut),d._timeOut=setTimeout(i,100)}),setTimeout(function(){window._scollTopToolbar&&_scollTopToolbar()},1e3);var g=window.location.hash;g==="#friend"?b.SetFilterOwner(1):g==="#owner"&&b.SetFilterOwner(2)},b.ScrollTop=function(){var a=$(".foody-box-review"),b=$(".foody-toolbar:visible").height(),d=$(".header-toolbar:visible").height(),e=$(".micro-act-btns:visible").height();b=b?b:0,d=d?d:0,e=e?e:0,c.ScrollShowTop(a,-(b+d+e))},b.FilterChange=function(){console.log(b.Filter),b.LoadMore(!0)},b.Insert=function(a){if(!a)return;b.Total=b.Total+1,b.Items.unshift(a),b.$$phase||b.$apply(),b.ScrollTop()},b.RemoveById=function(a){if(!a)return;for(var c=b.Items.length-1;c>=0;c--)if(b.Items[c].Id==a){b.Items.splice(c,1),b.Total=b.Total-1,b.$$phase||b.$apply();break}},b.RefreshById=function(a){if(!a)return;b.IsLoading=!0,j(a,function(a){if(!a){b.IsLoading=!1;return}for(var c=0;c<b.Items.length;c++)b.Items[c].Id==a.Id&&(b.Items[c]=a);b.IsLoading=!1,b.$$phase||b.$apply()})};var k=null;$(window).scroll(function(){if(b.IsLoading==1||b.IsLoadMore()!=1||b.LoadMoreCount>1)return;k&&clearTimeout(k),k=setTimeout(function(){var a=$(window).scrollTop(),c=$(".microsite-res-services").height(),d=$(".micro-home-promotion").height(),e=$(".microsite-gallery").height(),f=$(".foody-box-review").height(),g=c+d+e+f+300;a>g-400&&(b.LoadMore(),b.LoadMoreCount++)},100)}),b.LoadMore=function(a,c){b.Filter.IsSheIs=="true"?m(a,c):l(a,c)}}"use strict",angular.module("FoodyApp").controller("ResReviewCtrl",a),a.$inject=["$http","$scope","Helper"]})()
;(function(){function a(a,b,c){var d=this;d.$scope=b,b.UserId=0,b.RestaurantId=0,b.TotalReviews=0,b.TotalCheckIns=0,b.TotalFriends=0,b.ListFriends=[],b.Items=[],b.UrlImgBg="",b.Total=0,b.LastId=0,b.IsLoading=!1,b.IsFirst=!0,b.IsLoadMore=function(){return b.Total-b.Items.length>0},b.LoadMore=function(){if(b.IsLoading===!0||b.IsFirst===!1&&b.IsLoadMore()!==!0)return;$(".microsite-reviews-box").css("display","none"),$(".microsite-user-info-reviews-box").css("padding-bottom","0"),b.IsLoading=!0;var d="/__get/Review/UserReviewLoadMore";d+=c.GetParamRnd(d),a.get(d+"&"+c.GetUrlParams({ResId:b.RestaurantId,Count:b.Count,LastId:b.LastId,isLatest:!0})).then(function(a){a=a.data,b.Count=a.Count,b.LastId=a.LastId,b.Total=a.Total,b.IsFirst=!1;var c=a.Items;for(var d=0;d<c.length;d++){var e=c[d];e.UrlLoad=b.UrlImgBg,b.Items.push(e)}}).catch(function(){}),b.IsLoading=!1},b.Init=function(a){a=window[a];if(!a)return;b.UserId=a.UserId,b.RestaurantId=a.RestaurantId,b.TotalReviews=a.TotalReviews,b.TotalCheckIns=a.TotalCheckIns,b.TotalFriends=a.TotalFriends,b.UrlImgBg=a.UrlImgBg;var c=a.ListFriends;if(c)for(var d=0;d<c.length;d++){var e=c[d];b.ListFriends.push(e)}setTimeout(function(){window._scollTopToolbar&&_scollTopToolbar()},1e3)}}"use strict",angular.module("FoodyApp").controller("UserReviewInfoCtrl",a),a.$inject=["$http","$scope","Helper"]})()
;(function(){function a(a,b,c,d,e){function i(){var a=g.parents().find('div[ng-controller="DlgReviewsCtrl"]');h=a.bPopup({closeClass:"fd-btn-close",followSpeed:0}),b.LoadedReviewSlide==0&&($(".review-popup-ads .bxslider").bxSlider({mode:"fade",captions:!1,auto:!0,useCSS:!1,pager:!1,controls:!1}),window.LoadedReviewSlide=!0,b.LoadedReviewSlide=!0)}function j(){h&&h.close()}function k(c){var d="/__get/Restaurant/GetSummary";d+=e.GetParamRnd(d),a.get(d+"&"+e.GetUrlParams({ResId:b.ResId})).then(function(a){a=a.data,e.RunFnc(c,a)}).catch(function(){e.RunFnc(c)})}function l(c,d){var f="/__get/Review/ResLoadMore";f+=e.GetParamRnd(f),c==1&&(b.LastId=null,b.Count=10),a.post(f+"&"+e.GetUrlParams({ResId:b.ResId,LastId:b.LastId,Count:b.Count,Type:b.Filter.Type,fromOwner:b.Filter.FromOwner,isLatest:b.Filter.IsLatest,HasPicture:b.Filter.HasPicture})).then(function(a){a=a.data,e.RunFnc(d,a)}).catch(function(){e.RunFnc(d)})}function m(a,c,d){a==1&&(b.Items=[]),b.Count=c.Count,b.LastId=c.LastId,b.Total=c.Total;var f=c.Items;for(var g=0;g<f.length;g++){var h=f[g];h.UrlLoad=b.UrlImgBg,h.ShowComment=b.ShowComment,b.Items.push(h)}b.Summary=c.Summary,e.RunFnc(d,c)}function n(a,c){b.SummaryRes=a,e.RunFnc(c,a)}function o(){var a=f.ListLazyPics,c=$(window).scrollTop();for(var d=0;d<a.length;d++){var e=a[d].ele.offset();e.top<c+500&&(a[d].$scope.ShowLazyPic(),b.$$phase||b.$apply(),a.splice(d,1))}}function p(b,c){a.post("/__post/Review/GetReviewEx",{id:b}).then(function(a){a=a.data,e.RunFnc(c,a)}).catch(function(){e.RunFnc(c)})}var f=this,g=c,h=null;f.$scope=b,f.ListLazyPics=[],b.Count=3,b.LastId=null,b.Total=0,b.Items=[],b.Model={},b.Filter={Type:"1",FromOwner:"",IsLatest:"true",HasPicture:null},b.IsLoading=!1,b.IsLoadMore=function(){return b.Total-b.Items.length>0},b.LoadedReviewSlide=window.LoadedReviewSlide==undefined?!1:window.LoadedReviewSlide,b.Show=function(a,c){b.IsLoading=!0,i(),b.ResId=a,k(function(a){n(a,function(){h.reposition(),setTimeout(function(){var a=$(".dlg-reviews .fldr-rating .range");a.each(function(){var a=$(this).data("val");$(this).progressbar({value:a*10})})},500),b.LoadMore(!0,function(){h.reposition()})})})},b.OpenDlgWriteReview=function(){var a=b.ResId;d.Show(a);return},b.SetFilterType=function(a){b.Filter.Type!=a&&(b.Filter.Type=a,b.FilterChange())},b.SetFilterOwner=function(a){b.Filter.FromOwner=a?a:"",b.Filter.IsLatest=b.Filter.FromOwner!=""?"false":"true",b.FilterChange()},b.SetFilterIsLatest=function(a){b.Filter.IsLatest=a==1?"true":"false",b.Filter.FromOwner=b.Filter.IsLatest=="true"?"":b.Filter.FromOwner,b.FilterChange()},b.AddLazyLoadPic=function(a){f.ListLazyPics.push(a)},b.Init=function(a){a=window[a];if(!a)return;b.ResId=a.ResId,b.Count=a.Count?a.Count:10,b.LastId=a.LastId,b.Total=a.Total,b.UrlImgBg=a.UrlImgBg,b.ShowComment=a.ShowComment,b.Filter.HasPicture=a.HasPicture,b.Summary=a.Summary;var c=a.Items;if(c)for(var d=0;d<c.length;d++){var e=c[d];e.UrlLoad=b.UrlImgBg,e.ShowComment=b.ShowComment,b.Items.push(e)}else b.LoadMore(!0);$(window).scroll(function(){f._timeOut&&clearTimeout(f._timeOut),f._timeOut=setTimeout(o,100)}),setTimeout(function(){window._scollTopToolbar&&_scollTopToolbar()},1e3)},b.FilterChange=function(){b.LoadMore(!0)},b.LoadMore=function(a,c){b.IsLoading=!0,l(a,function(d){m(a,d,function(){setTimeout(o,1e3),b.IsLoading=!1,e.RunFnc(c)})})}}"use strict",angular.module("FoodyApp").controller("DlgReviewsCtrl",a),a.$inject=["$http","$scope","$element","DlgWriteReview","Helper"]})()
;(function(){function a(a,b,c,d,e,f,g,h,i){function m(a){if(!a){var b=d.find(".foody-box-comment"),c=b.find(".m-box"),f=$(".foody-toolbar:visible").height(),g=$(".header-toolbar:visible").height(),h=$("#review-list");h.length>0?h.scrollTop(30):e.ScrollShowTop(c,-(f+g+150)),c.focus()}q(!0)}function n(){c.UserLikesText="";var a=window.Text?Text:{},b="";for(var d=0;d<c.UserLikes.length;d++){var e=c.UserLikes[d];if(c.CUser&&e.Id==c.CUser.Id)continue;b+=(b?", ":"")+e.DisplayName}var f=!1;c.UserLikes.length<c.TotalLike&&(f=!0,b+=a.andSeparator+" "+(c.TotalLike-c.UserLikes.length)+Text.Common.Others),c.IsLiked==1&&(c.UserLikesText=a.You,b&&(f?c.UserLikesText+=", ":c.UserLikesText+=a.andSeparator+" ")),c.UserLikesText+=b}function o(b,d){var f="/__post/Review/ListComment";a.post(f,{reviewId:k,type:l,count:c.Count,lastId:c.LastId,parentId:b}).then(function(a){a=a.data;if(!a)return;d(b,a)}).catch(function(a){a=a.data,e.Log(a)})}function p(a,b,d){if(a==null){c.Count=b.Count,c.LastId=b.LastId,c.Total=b.Total;for(var f=0;f<b.Items.length;f++)c.Items.push(b.Items[f])}e.RunFnc(d,b)}function q(a){e.GetCurrentUser(function(a){c.CUser=a,n(),c.IsLoading=!1,c.$$phase||c.$apply()},a)}function r(){q(!0);var b="/__post/LikeComment/AddLikeDislike";c.IsLoading=!0,a.post(b,{referenceId:k,type:l,isLiked:!c.IsLiked}).then(function(a){a=a.data,c.IsLoading=!1;if(!a||!a.result)return;c.IsLiked=a.result.HasLiked,n(),c.$$phase||c.$apply()}).catch(function(a){a=a.data,e.Log(a),c.IsLoading=!1,c.$$phase||c.$apply()})}function s(a){var b=document.createElement("div");b.innerHTML=a;var c=b.getElementsByTagName("script"),d=c.length;while(d--)c[d].parentNode.removeChild(c[d]);var e=b.getElementsByTagName("img"),f=e.length;while(f--)e[f].parentNode.removeChild(e[f]);return b.innerHTML}var j=this;j.$scope=c;var k=null,l=null;c.Count=5,c.LastId=null,c.Total=0,c.Items=[],c.IsLoading=!1,c.IsLoadMore=function(){return c.Total-c.Items.length>0},c.CUser=null,c.CInput={Text:""},c.UserLikesText="",c.UserLikes=[],c.TotalComment=0,c.TotalLike=0,c.EnableComment=!0,c.EnableLike=!0,c.EnableShare=!0,c.EnableReport=!0,c.IsShowComment=!1,c.IsDirectDetail=!1,c.ShowComment=function(a,b){c.IsShowComment==1||c.Items.length>0?c.WriteComment(a,b):c.LoadMore(null,function(){c.IsShowComment=!0,c.WriteComment(a,b)})},c.WriteComment=function(a,b){if(c.CUser!=null){m(a);return}b||i.Show(function(b){b.LoggedIn&&m(a)})},c.ShowUserLikes=function(){f.Show("/__post/Review/ListUserLike?reviewId="+k+"&type="+l)},c.PopupReport=function(){if(c.CUser!=null){g.Show(c.ReportType,c.ReviewId);return}i.Show(function(a){a.LoggedIn&&g.Show(c.ReportType,c.ReviewId)})},c.Init=function(a){if(!a)return;c.IsLoading=!0,k=a.ItemId,l=a.ItemType,c.ReviewId=a.ItemId,c.ItemType=a.ItemType,c.ReportType=1,c.UserLikes=a.UserLikes,c.TotalComment=a.TotalComment,c.TotalLike=a.TotalLike,c.IsLiked=a.IsLiked,c.EnableComment=a.EnableComment==0?!1:!0,c.EnableLike=a.EnableLike==0?!1:!0,c.EnableShare=a.EnableShare==0?!1:!0,c.EnableReport=a.EnableReport==0?!1:!0,a.ShowComment==1&&c.ShowComment(!0,!0),c.ReviewComments=a.ReviewComments,c.IsDirectDetail=a.IsDirectDetail,c.DetailUrl=a.DetailUrl,q();if(c.ReviewComments&&c.ReviewComments.length>0)if(c.ReviewComments.length==4)for(var b=0;b<3;b++)c.Items.push(c.ReviewComments[b]);else for(var b=0;b<c.ReviewComments.length;b++)c.Items.push(c.ReviewComments[b])},c.TbLike=function(){c.CUser?r():i.Show(function(a){a.LoggedIn&&r()})},c.LoadMore=function(a,b){c.IsLoading=!0,o(a,function(a,d){p(a,d,function(){c.IsLoading=!1,e.RunFnc(b)})})},c.Comment=function(){var b="comment_"+k+"_"+l,d=$("#"+b),f=d.html();f=$("<textarea />").html(f).text(),f=s(f);var g=$(".mid_"+k+"_"+l).val();if(!f||f&&f.trim()==""){alert(ReviewText.CommentEmpty);return}var h="/__post/Review/AddCommentTag";c.IsLoading=!0,a.post(h,{reviewId:k,comment:f,type:l,tagUsers:g}).then(function(a){a=a.data;if(!a||!a.Data){c.IsLoading=!1;return}c.Items.push(a.Data),c.Total=c.Total+1,$(".mention-highlight").html(""),$(".m-box").val(""),d.html(""),c.IsLoading=!1,window.isClearMention=!0,window.PointNotify&&PointNotify.AddedPointNotify&&PointNotify.AddedPointNotify(a.TotalPendingPoints)}).catch(function(a){a=a.data,e.Log(a),c.IsLoading=!1})},c.RemoveComment=function(b){if(!confirm(Text.MsgConfirmDeletePhotoComment))return;var d="/__post/Review/RemoveComment";c.IsLoading=!0,a.post(d,{commentId:b.Id}).then(function(a){a=a.data;if(a.Success){var d=c.Items.indexOf(b);c.Items.splice(d,1),c.Total=c.Total-1}c.IsLoading=!1}).catch(function(a){a=a.data,e.Log(a),c.IsLoading=!1})},c.UserInfoReviewPopup=function(a){h.Show(a,c.ReviewId)},c.UserInfoReviewPopupHide=function(){$("#fdDlgUserInfoReview").hide()},$(window).on("click",function(a){var b=$(a.target).parents(".review-list");if(b.length>0)return;$("#fdDlgUserInfoReview").hide()}),$(window).scroll(function(){$("#fdDlgUserInfoReview").hide()})}"use strict",angular.module("FoodyApp").controller("ResCommentCtrl",a),a.$inject=["$http","$rootScope","$scope","$element","Helper","DlgListUser","DlgReport","DlgUserInfoReview","DlgLogin"]})()
;(function(){function a(a,b,c,d){function i(){var a=f.parents().find('div[ng-controller="ListUserCtrl"]');g=a.bPopup({closeClass:"fd-btn-close",followSpeed:0})}function j(){g&&g.close()}function k(c,e){c==1&&(b.Model.LastId=null,b.Model.Count=5);var f=h;f+="&lastId="+b.Model.LastId+"&count="+b.Model.Count;var g=d.GetParamRnd(f);b.IsLoading=!0,a.post(f+g,{}).then(function(a){a=a.data,b.IsLoading=!1;if(!a){j();return}e(c,a)}).catch(function(a){a=a.data,b.IsLoading=!1,d.Log(a)})}function l(a,c){b.Model.Total=c.Total,b.Model.Count=c.Count,b.Model.LastId=c.LastId,a==1&&(b.Model.Items=[]);for(var d=0;d<c.Items.length;d++)b.Model.Items.push(c.Items[d]);g&&setTimeout(function(){g.reposition()},300)}var e=this,f=c,g=null,h="";b.CUser=null,e.$scope=b,b.IsLoading=!1,b.Model={LastId:null,Count:5,Total:0,Items:[]},b.IsLoadMore=function(){return b.Model.Total-b.Model.Items.length>0},b.FollowToggle=function(b){var c="/follow/"+b.Id,e=d.GetParamRnd(c);b.IsLoading=!0,a.post(c+e,{}).then(function(a){a=a.data,b.IsLoading=!1;if(!a){j();return}b.IsFollow=a.follow}).catch(function(a){a=a.data,b.IsLoading=!1,d.Log(a)})},b.LoadMore=function(){k(!1,function(a,b){l(a,b)})},b.Show=function(a,c){b.IsLoading=!0,i(),h=a,d.GetCurrentUser(function(a){b.CUser=a,k(!0,function(a,c){l(a,c),b.$$phase||b.$apply()})})}}"use strict",angular.module("FoodyApp").controller("ListUserCtrl",a),a.$inject=["$http","$scope","$element","Helper"]})()
;(function(){function a(a,b,c,d,e,f,g,h){function l(a){var b=c.find(".cml-comment-input .mention-box");if(!a){var e=$(".header-toolbar:visible").height()*5,f=b[0].offsetHeight;d.ScrollShowTop(b,-(e+f))}b.focus()}function m(a,b){var e=c.find('.cml-reply[data-item-id="'+b+'"] .cml-reply-input .input-text');if(!a){var f=$(".header-toolbar:visible").height()*5,g=e[0].offsetHeight;d.ScrollShowTop(e,-(f+g))}e.focus()}function n(){b.UserLikesText="";var a=window.Text?Text:{},c="";for(var d=0;d<b.UserLikes.length;d++){var e=b.UserLikes[d];if(b.CUser&&e.Id==b.CUser.Id)continue;c+=(c?", ":"")+e.DisplayName}var f=!1;b.UserLikes.length<b.TotalLike&&(f=!0,c+=a.andSeparator+" "+(b.TotalLike-b.UserLikes.length)+Text.Common.Others),b.IsLiked==1&&(b.UserLikesText=a.You,c&&(f?b.UserLikesText+=", ":b.UserLikesText+=a.andSeparator+" ")),b.UserLikesText+=c}function o(a){a.ListReply.IsLoading=!1,a.ListReply.IsLoadMore=function(){return a.ListReply.Total-a.ListReply.Items.length>0},a.ViewMoreSummary=function(){var b=a.ListReply.Total-a.ListReply.Items.length,c=a.ListReply.Count>b?b:a.ListReply.Count;return c+"/"+b}}function p(b,c){var e="/__get/Comment/GetList";e+=d.GetParamRnd(e),a.get(e+"&"+d.GetUrlParams({id:b.Id,type:b.Type,count:b.Count,lastId:b.LastId,parentId:b.ParentId})).then(function(a){a=a.data,d.RunFnc(c,a)}).catch(function(){data=data.data,d.Log(data),d.RunFnc(c)})}function q(a,c){b.ListComment.Count=a.Count,b.ListComment.LastId=a.LastId,b.ListComment.Total=a.Total;for(var e=0;e<a.Items.length;e++){var f=a.Items[e];o(f),b.ListComment.Items.unshift(f)}d.RunFnc(c,a)}function r(a,b,c){b.ListReply.Count=a.Count,b.ListReply.LastId=a.LastId,b.ListReply.Total=a.Total;for(var e=0;e<a.Items.length;e++)b.ListReply.Items.unshift(a.Items[e]);d.RunFnc(c,a)}function s(b){var c="/__get/Comment/GetDetail";c+=d.GetParamRnd(c),a.get(c+"&"+d.GetUrlParams({id:j,type:k,count:10})).then(function(a){a=a.data,d.RunFnc(b,a)}).catch(function(a){a=a.data,d.Log(a),d.RunFnc(b)})}function t(a,c){b.IsLiked=a.IsLiked,b.UserLikes=a.UserLikes,b.ListComment.Count=a.ListComment.Count,b.ListComment.LastId=a.ListComment.LastId,b.ListComment.Total=a.ListComment.Total;for(var e=0;e<a.ListComment.Items.length;e++){var f=a.ListComment.Items[e];o(f),b.ListComment.Items.unshift(f)}b.UserLikes=a.UserLikes,b.TotalLike=a.TotalLike,d.RunFnc(c)}function u(){b.$$phase||b.$apply()}function v(b){var c="/__get/ViewTemplate/Comment";c+=d.GetParamRnd(c),a.get(c+"&"+d.GetUrlParams({id:j,type:k})).then(function(a){a=a.data,d.RunFnc(b,a)}).catch(function(a){a=a.data,d.Log(a),d.RunFnc(b,"")})}function w(a,c){d.GetCurrentUser(function(a){b.CUser=a,d.RunFnc(c)},a)}function x(a,c,d){if(b.CUser!=null){z(a,c,d);return}h.Show(function(b){b.LoggedIn&&z(a,c,d)})}function y(a,c,d){if(b.CUser!=null){A(a,c,d);return}h.Show(function(b){b.LoggedIn&&A(a,c,d)})}function z(b,c,e){var f="/__post/Comment/Like";a.post(f,{id:b,type:c}).then(function(a){a=a.data;if(!a||a.Error)return;d.RunFnc(e)}).catch(function(a){a=a.data,d.Log(a)})}function A(b,c,e){var f="/__post/Comment/UnLike";a.post(f,{id:b,type:c}).then(function(a){a=a.data;if(!a)return;d.RunFnc(e)}).catch(function(a){a=a.data,d.Log(a)})}function B(a,b,c){a.IsReply=!0,b!=null?c!=null&&b.User.Id!=c.Id?(a.ListReply.UserReplyId=b.User.Id,a.ListReply.Text="@"+b.User.DisplayName+" "):a.ListReply.Text="":c!=null&&a.User.Id!=c.Id?(a.ListReply.UserReplyId=a.User.Id,a.ListReply.Text="@"+a.User.DisplayName+" "):a.ListReply.Text="",setTimeout(function(){angular.element(".cml-reply-input .reply_"+a.Id+"_4").focus()},200)}function C(a){var b=document.createElement("div");b.innerHTML=a;var c=b.getElementsByTagName("script"),d=c.length;while(d--)c[d].parentNode.removeChild(c[d]);var e=b.getElementsByTagName("img"),f=e.length;while(f--)e[f].parentNode.removeChild(e[f]);return b.innerHTML}var i=this;i.$scope=b;var j=null,k=null;b.PreloadList=[1,2,3],b.Template="",b.ListComment={Count:10,LastId:null,Total:0,Items:[]},b.Loading={Like:!1,Comment:!1,LoadMore:!1},b.IsLoading=!1,b.IsLoadMore=function(){return b.ListComment.Total-b.ListComment.Items.length>0},b.CUser=null,b.CInput={Text:""},b.UserLikesText="",b.UserLikes=[],b.TotalComment=0,b.TotalLike=0,b.EnableComment=!0,b.EnableLike=!0,b.EnableShare=!0,b.EnableReport=!0,b.IsShowComment=!1,b.IsDirectDetail=!1,b.WriteComment=function(a){if(b.CUser!=null){l(a);return}h.Show(function(b){b.LoggedIn&&w(!0,function(){l(a)})})},b.ShowUserLikes=function(a,b){a=a?a:j,b=b?b:k;var c="/__get/Comment/ListUserLike?id="+a+"&type="+b;c+=d.GetParamRnd(c),e.Show(c)},b.PopupReport=function(){if(b.CUser!=null){f.Show(b.ReportType,b.ReviewId);return}h.Show(function(a){a.LoggedIn&&f.Show(b.ReportType,b.ReviewId)})},b.Init=function(a){if(!a)return;b.IsLoading=!0,j=a.Id,k=a.Type,b.ItemType=a.Type,b.ItemId=a.Id,v(function(a){a?(b.Template=a,s(function(a){t(a,function(){w(!0,function(){b.IsLoading=!1,n(),u()})})})):b.IsLoading=!1})},b.ViewMoreSummary=function(){var a=b.ListComment.Total-b.ListComment.Items.length,c=b.ListComment.Count>a?a:b.ListComment.Count;return c+"/"+a},b.ShowReply=function(a,c){var d=b.CUser;d!=null?B(a,c,d):h.Show(function(e){e.LoggedIn&&w(!0,function(){d=b.CUser,d!=null&&B(a,c,d),b.$apply(),setTimeout(function(){m(!1,a.Id)},100)})}),setTimeout(function(){m(!1,a.Id)},100)},b.TbLike=function(){b.IsLiked?y(j,k,function(){b.IsLiked=!1,n()}):x(j,k,function(){b.IsLiked=!0,n()})},b.CommentLike=function(a){a.IsLiked?y(a.Id,4,function(){a.IsLiked=!1,a.TotalLike--}):x(a.Id,4,function(){a.IsLiked=!0,a.TotalLike++}),console.log(a)},b.LoadMore=function(a){b.Loading.LoadMore=!0,p({Id:j,Type:k,Count:b.ListComment.Count,LastId:b.ListComment.LastId},function(c){q(c,function(){b.Loading.LoadMore=!1,d.RunFnc(a)})})},b.ViewReply=function(a){a.ListReply.IsLoading=!0,p({Id:j,ParentId:a.Id,Type:4,Count:a.ListReply.Count,LastId:a.ListReply.LastId},function(b){r(b,a,function(){a.ListReply.IsLoading=!1})})},b.Comment=function(c){var e=window.event?window.event:c;if(e.shiftKey)return;event.preventDefault();var f="comment_"+j+"_"+k,e=$("#"+f),g=e.html();g=C(g);var h=$(".mid_"+j).val();if(!g||g&&g.trim()==""){alert(ReviewText.CommentEmpty);return}var i="/__post/Comment/CommentTag";b.Loading.Comment=!0,a.post(i,{id:j,comment:g,type:k,referenceType:k,tagUsers:h}).then(function(a){a=a.data;if(!a){b.Loading.Comment=!1;return}o(a),b.ListComment.Items.push(a),b.ListComment.Total=b.ListComment.Total+1,$(".mention-highlight").html(""),$(".mention-box").val(""),e.html(""),b.Loading.Comment=!1}).catch(function(a){a=a.data,d.Log(a),b.Loading.Comment=!1})},b.RemoveComment=function(c,e){if(!confirm(Text.MsgConfirmDeletePhotoComment))return;var f="/__post/Comment/RemoveComment";e!=null&&(e.ListReply.IsLoading=!0),a.post(f,{id:c.Id}).then(function(a){a=a.data;if(a!=1){e.ListReply.IsLoading=!1;return}if(e!=null){var d=e.ListReply.Items.indexOf(c);e.ListReply.Items.splice(d,1),e.TotalReply=e.TotalReply-1,e.ListReply.IsLoadMore=function(){return!1},e.ListReply.IsLoading=!1}else{var d=b.ListComment.Items.indexOf(c);b.ListComment.Items.splice(d,1),b.ListComment.Total=b.ListComment.Total-1}}).catch(function(a){a=a.data,d.Log(a),e.ListReply.IsLoading=!1})},b.ShowEdit=function(a){a.IsEdit=!0,a.Text=a.Comment},b.HideEdit=function(a){a.IsEdit=!1,a.Text=""},b.EditComment=function(b){var c="/__post/Comment/EditComment",e=window.event;if(e.shiftKey)return;b.IsEditing=!0,event.preventDefault(),a.post(c,{id:b.Id,comment:b.Text}).then(function(a){a=a.data;if(!a){b.IsEditing=!1;return}b.Comment=a.Comment,b.IsEdit=!1,b.Text=b.Comment,b.IsEditing=!1}).catch(function(a){a=a.data,d.Log(a),b.IsEditing=!1})},b.Reply=function(b){if(b.ListReply.Loading==1)return;var c="reply_"+b.Id+"_4",e=$("#"+c),f=$("."+c),g=e.html();g=C(g);var h=$(".midr_"+b.Id).val();if(!g||g&&g.trim()==""){alert(ReviewText.CommentEmpty);return}var i="/__post/Comment/CommentTag";b.ListReply.Loading=!0,a.post(i,{id:j,comment:g,parentId:b.Id,type:4,referenceType:k,tagUsers:h}).then(function(a){a=a.data;if(!a){b.ListReply.Loading=!1;return}b.TotalReply++,b.ListReply.Items.push(a),b.ListReply.Total++,b.IsReply=!1,e.html(""),f.val(""),b.ListReply.Loading=!1}).catch(function(a){a=a.data,d.Log(a),b.ListReply.Loading=!1})},b.ToggleItemTool=function(a){a.ToggleItemTool=!a.ToggleItemTool},b.UserInfoReviewPopup=function(a){g.Show(a,b.ReviewId)},b.UserInfoReviewPopupHide=function(){$("#fdDlgUserInfoReview").hide()},$(window).on("click",function(a){var b=$(a.target).parents(".review-list");if(b.length>0)return;$("#fdDlgUserInfoReview").hide()}),$(window).scroll(function(){$("#fdDlgUserInfoReview").hide()})}"use strict",angular.module("FoodyApp").controller("BoxCommentCtrl",a),a.$inject=["$http","$scope","$element","Helper","DlgListUser","DlgReport","DlgUserInfoReview","DlgLogin"]})()
;(function(){function a(a,b,c,d,e){var f=this;f.$scope=b;var g=null,h=null;b.IsLoading=!1,b.StarList=[1,2,3,4,5],b.UserRating=0,b.AvgRating=0,b.TotalRating=0,b.IsLoadPre=!0,b.Init=function(a){if(!a)return;g=a.Id,h=a.Type,b.GetRating()},b.GetRating=function(){var c="/__get/Rating/GetRating";c+=d.GetParamRnd(c),a.get(c+"&"+d.GetUrlParams({id:g,type:h})).then(function(a){a=a.data;if(!a){b.IsLoading=!1;return}b.UserRating=a.Rating,b.AvgRating=a.AvgRating,b.TotalRating=a.TotalRating,b.IsLoading=!1,b.IsLoadPre=!1}).catch(function(a){a=a.data,d.Log(a),b.IsLoading=!1})},b.Rate=function(c){e.Show(function(e){if(e.LoggedIn){if(b.IsLoading)return;b.UserRating=c,b.IsLoading=!0;var f="/__post/Rating/Rate";a.post(f,{id:g,rating:c,type:h}).then(function(a){a=a.data;if(!a){b.IsLoading=!1;return}b.UserRating=a.Rating,b.AvgRating=a.AvgRating,b.TotalRating=a.TotalRating,b.IsLoading=!1}).catch(function(a){a=a.data,d.Log(a),b.IsLoading=!1})}})}}"use strict",angular.module("FoodyApp").controller("BoxRatingCtrl",a),a.$inject=["$http","$scope","$element","Helper","DlgLogin"]})()
;(function(){function a(a,b,c,d){function h(){f=$("#popupCreateFeed").bPopup({modalClose:!1,followSpeed:0})}function i(){b.ListHour=[],b.ListMinute=[];for(var a=0;a<24;a++){var c={id:a,name:a<10?"0"+a:a};b.ListHour.push(c)}for(var d=0;d<60;d++){var e={id:d,name:d<10?"0"+d:d};b.ListMinute.push(e)}}function j(c,e){c==1&&(b.Count=10,b.LastId=null),b.IsLoading=!0;var f="/__get/NewsFeed/MemberList";f+=d.GetParamRnd(f),f+="&"+d.GetUrlParams({isApprove:b.IsApprove,count:b.Count,lastId:b.LastId}),a.get(f).then(function(a){a=a.data;if(!a){b.IsLoading=!1;return}e(a)}).catch(function(a){a=a.data,d.Log(a),b.IsLoading=!1})}function k(a,c,e){a==1&&(b.Items=[]),b.LastId=c.LastId,b.Total=c.Total;for(var f=0;f<c.Items.length;f++)c.Items[f].DisplayDate=d.DateFormat(c.Items[f].CreatedOn),b.Items.push(c.Items[f]);d.RunFnc(e,c)}function l(){var a=$("#nf-pic-file")[0].files[0],c=m(a);if(!c){$("#nf-pic-file").val("");return}if(!a)return;var d=new FormData;d.append("file",a);var e=(new Date).getTime();$.get("/__get/account/getauthen?t="+e,function(a){if(!a)return;$.ajax({url:g.UrlUploadPicture+"upload/feed",cache:!1,type:"POST",data:d,processData:!1,contentType:!1,headers:{"X-Foody-User-Token":a.UserToken},success:function(a){b.Data.Avatar=a[0].FileName,b.ThumbUrl=a[0].ThumbUrl,b.$apply()},error:function(a,b,c){alert("Có lỗi upload hình xảy ra!"),console.log(a.responseText)}})})}function m(a){if(!a)return!1;var b=/(png)|(jpe?g)|(gif)$/i,c="",d=a.type;b.test(d)||(c=CommonText.InvalidUploadFile);if(c!="")return alert(c),!1;var e=a.size;return e>1012e4&&(c=CommonText.InvalidUploadFileSize),c!=""?(alert(c),!1):!0}function n(){var c="/__post/NewsFeed/ValidateLink",e=d.GetParamRnd(c);a.post(c,{Link:b.Data.Link}).then(function(a){a=a.data,a.Valid?o():alert(NewsFeedText.InvalidLink)}).catch(function(a){a=a.data,d.Log(a)})}function n(){var c="/__post/NewsFeed/ValidateLink",e=d.GetParamRnd(c);a.post(c,{Link:b.Data.Link}).then(function(a){a=a.data,a.Valid?o():alert(NewsFeedText.InvalidLink)}).catch(function(a){a=a.data,d.Log(a)})}function o(){var c="/__post/NewsFeed/Save",e=d.GetParamRnd(c);a.post(c,{Id:b.Data.Id,Link:b.Data.Link,Title:b.Data.Title,Description:$("#nfDescription").html(),Avatar:b.Data.Avatar,Hour:b.Hour.id,Minute:b.Minute.id,ShowDate:b.Data.ShowDate}).then(function(a){a=a.data,a.Success&&location.reload()}).catch(function(a){a=a.data,d.Log(a)})}var e=this;c=$("#popupCreateFeed");var f=null,g={};e.$scope=b,b.Type=null,b.Hour=0,b.Minute=0,b.Data={Id:0},b.IsApprove=1,b.LastId=null,b.ListHour=[],b.ListMinute=[],b.SortTypes=[{id:1,name:"Bảng tin của bạn"},{id:2,name:"Đang chờ duyệt"}],b.Init=function(){b.Type=b.SortTypes[0],b.IsAdmin=window.isAdmin=="True"?!0:!1,i(),b.Hour=b.ListHour[0],b.Minute=b.ListMinute[0],b.LoadData(!0),g.UrlUploadPicture=c.find('input[name="nf-pic-url"]').val(),$("#nf-pic-file").on("change",function(){l()})},b.ChangeType=function(){b.Type.id==1?b.IsApprove=1:b.Type.id==2&&(b.IsApprove=0),b.LoadData(!0)},b.Upload=function(){$("#nf-pic-file").click()},b.LoadData=function(a,c){if(b.IsLoading==1)return;b.IsLoading=!0,j(a,function(e){k(a,e,function(){b.IsLoading=!1,d.RunFnc(c)})})},b.Create=function(){b.Data={Id:0,Link:null,Title:null,Avatar:"",Description:null},$("#nfDescription").html(""),h()},b.Update=function(c){var e="/__get/NewsFeed/GetFeedById?id="+c,f=d.GetParamRnd(e);a.get(e+f,{}).then(function(a){a=a.data,b.IsLoading=!1,b.Data=a,b.Data.ShowDate=a.ShowDateString,b.ThumbUrl=b.Data.Avatar,b.Hour=b.ListHour[b.Data.Hour],b.Minute=b.ListMinute[b.Data.Minute],$("#nfDescription").html(a.Description)}).catch(function(a){a=a.data,d.Log(a)}),h()},b.Save=function(){n()},b.Delete=function(b){if(confirm(NewsFeedText.DeleteConfirm)){var c="/__post/NewsFeed/Delete",e=d.GetParamRnd(c);a.post(c,{Id:b}).then(function(a){a=a.data,a.Success&&location.reload()}).catch(function(a){a=a.data,d.Log(a)})}},b.Hide=function(){f&&f.close()}}"use strict",angular.module("FoodyApp").controller("MemberNewsFeedController",a),a.$inject=["$http","$scope","$element","Helper"]})()
;(function(){function a(a,b,c,d){function h(){var a=f.parents().find('div[ng-controller="DlgNewsFeedCtrl"]');g=a.bPopup({closeClass:"fd-btn-close",followSpeed:0,modalClose:!1,escClose:!1})}function i(c){b.Data=null,b.IsLoading=!0;var e="/__get/NewsFeed/GetDetailFeedById?id="+c,f=d.GetParamRnd(e);a.get(e+f,{}).then(function(a){a=a.data,b.IsLoading=!1,b.Data=a,b.Data.DisplayDate=d.DateFormat(a.ShowDate)}).catch(function(a){a=a.data,d.Log(a)}),h()}var e=this,f=c,g=null;e.$scope=b,b.Id=null,b.Show=function(a,c){b.Id=a,h(),i(a)},b.Link=function(b){var c="/__post/NewsFeed/UpdateTotalViews",e=d.GetParamRnd(c);a.post(c,{id:b}).then(function(a){}).catch(function(a){a=a.data,d.Log(a)})}}"use strict",angular.module("FoodyApp").controller("DlgNewsFeedCtrl",a),a.$inject=["$http","$scope","$element","Helper"]})()
;(function(){function a(a,b,c,d){function h(c,e){c==1&&(b.Count=10,b.LastId=0),b.IsLoading=!0;var f="/__get/Member/GetUserAddedRes";f+=d.GetParamRnd(f),f+="&"+d.GetUrlParams({userId:b.UserId,count:b.Count,lastId:b.LastId,isDraft:b.IsDraft}),a.get(f).then(function(a){a=a.data;if(!a){b.IsLoading=!1;return}e(a)}).catch(function(a){a=a.data,d.Log(a),b.IsLoading=!1})}function i(a,c,e){a==1&&(b.Items=[],b.ScrollTop()),b.LastId=c.LastId,b.Total=c.TotalResult;for(var f=0;f<c.RestaurantsList.length;f++)b.Items.push(c.RestaurantsList[f]);d.RunFnc(e,c)}function j(){var a=c;e=a.bPopup({zIndex:10001,followSpeed:0,modalClose:!0,escClose:!0,onClose:function(){d.RunFnc(f,{LoggedIn:g})},onOpen:function(){g=!1}}),e.reposition()}function k(){e&&e.close()}b.Params="",b.IsLoading=!1,b.Data={RememberMe:!0},b.Message="",b.SSOUrl="";var e=null,f=null,g=!1;b.Show=function(a,c){f=a;var d=location.href;if(c&&window.ssoEnable){location.href=b.SSOUrl+"?returnUrl="+d;return}b.Params="?returnUrl="+d,j()};var l={};b.SetDisplayAsForm=function(a){l.Enabled=!0,l.ReturnUrl=a.ReturnUrl?a.ReturnUrl:""},b.Login=function(){var c="/__post/Account/Login";b.Message="",a.post(c,{email:b.Data.Email,password:b.Data.Password,rememberMe:b.Data.RememberMe}).then(function(a){a=a.data;if(!a.isSuccess){b.IsLoading=!1,b.Message=a.message;return}window.updateLoginStatus&&updateLoginStatus(),g=!0,l.Enabled?l.ReturnUrl?location.href=l.ReturnUrl:location.href="/":k(),b.IsLoading=!1}).catch(function(a){a=a.data,d.Log(a),b.IsLoading=!1})},b.Cancel=function(){g=!1,k()},b.SocialLogin=function(a){window.loginSuccessCallback=function(a){g=a==1?!0:!1,l.Enabled?l.ReturnUrl?location.href=l.ReturnUrl:location.href="/":k()};var b=640,c=450,d=screen.width/2-b/2,e=screen.height/2-c/2,f=window.open("/account/socialauthlogin?provider="+a,"socialauthlogin","height="+c+",width="+b+", scrollbars=no, top = "+e+", left="+d,!0)},b.Init=function(a){a&&(b.SSOUrl=a.UrlLogin)}}"use strict",angular.module("FoodyApp").controller("LoginCtrl",a),a.$inject=["$http","$scope","$element","Helper"]})()
;(function(){function a(a,b,c,d,e){function f(){var a=c;_bPopup=a.bPopup({followSpeed:0,modalClose:!0,escClose:!0,onClose:function(){d.RunFnc(_callBack,{LoggedIn:_isLoggedIn})},onOpen:function(){_isLoggedIn=!1}}),_bPopup.reposition()}function g(){_bPopup&&_bPopup.close()}b.IsLoading=!1,b.Login=function(){return b.IsLoading=!0,e.Show(function(a){b.IsLoading=!1,b.$$phase||b.$apply()},!0,function(){b.IsLoading=!1,b.$$phase||b.$apply()},!0),!1},b.ActionUrl=function(a){return b.IsLoading=!0,e.Show(function(c){c.LoggedIn&&(location.href=a),b.IsLoading=!1,b.$$phase||b.$apply()},!1,function(){b.IsLoading=!1,b.$$phase||b.$apply()},!1),!1},b.Init=function(){}}"use strict",angular.module("FoodyApp").controller("MenuLoginCtrl",a),a.$inject=["$http","$scope","$element","Helper","DlgLogin"]})()
;(function(){function a(a,b,c,d,e){function i(a){b.ResId=a,b.LastResId!=b.ResId&&(b.InitData(),b.SetHeight(),b.SetActiveTab(),b.GetRestaurantPictureList(null),$.get("/__get/Gallery/GetRestaurantGalleryInfo?restaurantId="+b.ResId,function(a){b.$apply(function(){b.Model=a})}).error(function(){}));var c=g.parents().find('div[ng-controller="GalleryCtrl"]');h=c.bPopup({closeClass:"gallery-popup-btn-close",followSpeed:0,position:["auto",20]}),b.LoadedGallerySlide==0&&($(".gallery-popup-ads .bxslider").bxSlider({mode:"fade",captions:!1,auto:!0,useCSS:!1,pager:!1,controls:!1}),window.LoadedGallerySlide=!0,b.LoadedGallerySlide=!0),b.LastResId=b.ResId}function j(){h&&h.close()}var f=this,g=c,h=null;f.$scope=b,b.Show=function(a,b){i(a)},b.LoadedGallerySlide=window.LoadedGallerySlide==undefined?!1:window.LoadedGallerySlide,b.ServiceClick=function(a){a.Id==3&&e.Show(a.RestaurantId)},b.PredefineAlbums=[],b.VideoItems=[],b.RequestUrl="",b.ResRewriteName="",b.Location="",b.IsLoadMore=!1,b.IsLoading=!1,b.PredefineAlbumId=0,b.LastResId=0,b.Model={},b.GetVideoList=function(){b.VideoLoaded||(b.IsLoading=!0,$.get("/__get/Gallery/GetVideoList?restaurantId="+b.ResId+"&count=10&lastId="+b.LastIdVideo,function(a){b.$apply(function(){b.VideoItems=a.Items,b.LastIdVideo=a.LastId,b.TotalVideo=a.Total,b.VideoLength=b.VideoItems?b.VideoItems.length:0,b.VideoLoaded=!0,b.IsLoading=!1})}).error(function(){}))},b.LoadMoreVideo=function(){b.IsLoadMore=!0,$.get("/__get/Gallery/GetVideoList?restaurantId="+b.ResId+"&count=10&lastId="+b.LastIdVideo,function(a){b.$apply(function(){b.VideoItems=b.VideoItems.concat(a.Items),b.LastIdVideo=a.LastId,b.TotalVideo=a.Total,b.IsLoadMore=!1,b.VideoLength=b.VideoItems.length})}).error(function(){})},b.GetRestaurantPictureList=function(a){var c=a==0?!0:!1,d=a!=null?parseInt(a):null;b.safeApply(function(){b.PredefineAlbumId=d});switch(d){case 1:b.SpaceLoaded||(b.$apply(function(){b.IsLoading=!0}),b.GetRequestUrl(d,c,b.SpacePageIndex),$.get(b.RequestUrl,function(a){b.$apply(function(){b.SpacePictures=a.data,b.SpaceTotal=a.total,b.SpaceLoaded=!0,b.IsLoading=!1})}).error(function(){}));break;case 2:b.FoodLoaded||(b.$apply(function(){b.IsLoading=!0}),b.GetRequestUrl(d,c,b.FoodPageIndex),$.get(b.RequestUrl,function(a){b.$apply(function(){b.FoodPictures=a.data,b.FoodTotal=a.total,b.FoodLoaded=!0,b.IsLoading=!1})}).error(function(){}));break;case 3:b.MenuLoaded||(b.$apply(function(){b.IsLoading=!0}),b.GetRequestUrl(d,c,b.MenuPageIndex),$.get(b.RequestUrl,function(a){b.$apply(function(){b.MenuPictures=a.data,b.MenuTotal=a.total,b.MenuLoaded=!0,b.IsLoading=!1})}).error(function(){}));break;case 4:b.OthersLoaded||(b.$apply(function(){b.IsLoading=!0}),b.GetRequestUrl(d,c,b.OthersPageIndex),$.get(b.RequestUrl,function(a){b.$apply(function(){b.OthersPictures=a.data,b.OthersTotal=a.total,b.OthersLoaded=!0,b.IsLoading=!1})}).error(function(){}));break;case null:b.AllLoaded||(b.safeApply(function(){b.IsLoading=!0}),b.GetRequestUrl(d,c,b.AllPageIndex),$.get(b.RequestUrl,function(a){b.$apply(function(){b.AllPictures=a.data,b.AllTotal=a.total,b.AllLoaded=!0,b.IsLoading=!1})}).error(function(){}));break;default:b.ProfessionalLoaded||(b.$apply(function(){b.IsLoading=!0}),b.GetRequestUrl(d,c,b.ProfessionalPageIndex),$.get(b.RequestUrl,function(a){b.$apply(function(){b.ProfessionalPictures=a.data,b.ProfessionalTotal=a.total,b.ProfessionalLoaded=!0,b.IsLoading=!1})}).error(function(){}))}},b.LoadMorePictures=function(a){var c=a==0?!0:!1,d=a!=null?parseInt(a):null;switch(d){case 1:b.IsLoadMore=!0,b.SpacePageIndex=b.SpacePageIndex+1,b.GetRequestUrl(d,c,b.SpacePageIndex),$.get(b.RequestUrl,function(a){b.$apply(function(){b.SpacePictures=b.SpacePictures.concat(a.data),b.IsLoadMore=!1})}).error(function(){});break;case 2:b.IsLoadMore=!0,b.FoodPageIndex=b.FoodPageIndex+1,b.GetRequestUrl(d,c,b.FoodPageIndex),$.get(b.RequestUrl,function(a){b.$apply(function(){b.FoodPictures=b.FoodPictures.concat(a.data),b.IsLoadMore=!1})}).error(function(){});break;case 3:b.IsLoadMore=!0,b.MenuPageIndex=b.MenuPageIndex+1,b.GetRequestUrl(d,c,b.MenuPageIndex),$.get(b.RequestUrl,function(a){b.$apply(function(){b.MenuPictures=b.MenuPictures.concat(a.data),b.IsLoadMore=!1})}).error(function(){});break;case 4:b.IsLoadMore=!0,b.OthersPageIndex=b.OthersPageIndex+1,b.GetRequestUrl(d,c,b.OthersPageIndex),$.get(b.RequestUrl,function(a){b.$apply(function(){b.OthersPictures=b.OthersPictures.concat(a.data),b.IsLoadMore=!1})}).error(function(){});break;case null:b.IsLoadMore=!0,b.AllPageIndex=b.AllPageIndex+1,b.GetRequestUrl(d,c,b.AllPageIndex),$.get(b.RequestUrl,function(a){b.$apply(function(){b.AllPictures=b.AllPictures.concat(a.data),b.IsLoadMore=!1})}).error(function(){});break;default:b.IsLoadMore=!0,b.ProfessionalPageIndex=b.ProfessionalPageIndex+1,b.GetRequestUrl(d,c,b.ProfessionalPageIndex),$.get(b.RequestUrl,function(a){b.$apply(function(){b.ProfessionalPictures=b.ProfessionalPictures.concat(a.data),b.IsLoadMore=!1})}).error(function(){})}},b.InitData=function(){b.ProfessionalPictures=[],b.FoodPictures=[],b.SpacePictures=[],b.OthersPictures=[],b.MenuPictures=[],b.AllPictures=[],b.LastIdVideo=null,b.TotalVideo=null,b.VideoLength=null,b.VideoLoaded=!1,b.ProfessionalLoaded=!1,b.FoodLoaded=!1,b.SpaceLoaded=!1,b.OthersLoaded=!1,b.MenuLoaded=!1,b.AllLoaded=!1,b.ProfessionalPageIndex=0,b.FoodPageIndex=0,b.SpacePageIndex=0,b.OthersPageIndex=0,b.MenuPageIndex=0,b.AllPageIndex=0,b.ProfessionalTotal=null,b.FoodTotal=null,b.SpaceTotal=null,b.OthersTotal=null,b.MenuTotal=null,b.AllTotal=null,b.ProfessionalLoadMoreCount=0,b.FoodLoadMoreCount=0,b.SpaceLoadMoreCount=0,b.OthersLoadMoreCount=0,b.MenuLoadMoreCount=0,b.AllLoadMoreCount=0,b.VideoLoadMoreCount=0},b.SetHeight=function(){var a=$("#banner-ads").children().length;a>0&&$(".gallery-popup-content").css("height","335px")},b.GetRequestUrl=function(a,c,d){b.RequestUrl="/__get/Gallery/ListRestaurantPicturesWithPaging?pageIndex="+d+"&pageSize=20&restaurantId="+b.ResId+"&predefineAlbumId="+a+"&albumId=0&userId=0&orderAscByTime=1&isProfessional="+c},b.SetActiveTab=function(){$(".list-tabs-content").css("display","none"),$("#album-all").css("display","block"),$("#fdDlgGallery>ul>li.active").removeClass("active"),$("#tab-all").addClass("active")},b.safeApply=function(a){var b=this.$root.$$phase;b=="$apply"||b=="$digest"?a&&typeof a=="function"&&a():this.$apply(a)},$(function(){$(".gallery-popup-container").foodyTabs({onClick:function(a){var b=$(a).find("a:first-child").attr("href");if(b=="#album-professional"){var c=document.getElementById("album-professional").getAttribute("data-pre-id");angular.element(document.getElementById("fdDlgGallery")).scope().GetRestaurantPictureList(c)}else if(b=="#album-mon-an"){var c=document.getElementById("album-mon-an").getAttribute("data-pre-id");angular.element(document.getElementById("fdDlgGallery")).scope().GetRestaurantPictureList(c)}else if(b=="#album-khong-gian"){var c=document.getElementById("album-khong-gian").getAttribute("data-pre-id");angular.element(document.getElementById("fdDlgGallery")).scope().GetRestaurantPictureList(c)}else if(b=="#album-tong-hop"){var c=document.getElementById("album-tong-hop").getAttribute("data-pre-id");angular.element(document.getElementById("fdDlgGallery")).scope().GetRestaurantPictureList(c)}else if(b=="#album-thuc-don"){var c=document.getElementById("album-thuc-don").getAttribute("data-pre-id");angular.element(document.getElementById("fdDlgGallery")).scope().GetRestaurantPictureList(c)}else b=="#album-all"?angular.element(document.getElementById("fdDlgGallery")).scope().GetRestaurantPictureList(null):b=="#video"&&angular.element(document.getElementById("fdDlgGallery")).scope().GetVideoList()}})}),$("#album-all").scroll(function(){f.timeOutScroll&&clearTimeout(f.timeOutScroll),f.timeOutScroll=setTimeout(function(){var a=$("#album-all").scrollTop(),c=$("#album-all > .microGallery").height();a>c-600&&b.AllLoadMoreCount<2&&(b.LoadMorePictures(null),b.AllLoadMoreCount++)},100)}),$("#video").scroll(function(){f.timeOutScroll&&clearTimeout(f.timeOutScroll),f.timeOutScroll=setTimeout(function(){var a=$("#video").scrollTop(),c=$("#video > .microGallery").height();a>c-600&&b.VideoLoadMoreCount<2&&(b.LoadMoreVideo(),b.VideoLoadMoreCount++)},100)}),$("#album-professional").scroll(function(){f.timeOutScroll&&clearTimeout(f.timeOutScroll),f.timeOutScroll=setTimeout(function(){var a=$("#album-professional").scrollTop(),c=$("#album-professional > .microGallery").height();a>c-600&&b.ProfessionalLoadMoreCount<2&&(b.LoadMorePictures(0),b.ProfessionalLoadMoreCount++)},100)}),$("#album-mon-an").scroll(function(){f.timeOutScroll&&clearTimeout(f.timeOutScroll),f.timeOutScroll=setTimeout(function(){var a=$("#album-mon-an").scrollTop(),c=$("#album-mon-an > .microGallery").height();a>c-600&&b.FoodLoadMoreCount<2&&(b.LoadMorePictures(2),b.FoodLoadMoreCount++)},100)}),$("#album-khong-gian").scroll(function(){f.timeOutScroll&&clearTimeout(f.timeOutScroll),f.timeOutScroll=setTimeout(function(){var a=$("#album-khong-gian").scrollTop(),c=$("#album-khong-gian > .microGallery").height();a>c-600&&b.SpaceLoadMoreCount<2&&(b.LoadMorePictures(1),b.SpaceLoadMoreCount++)},100)}),$("#album-tong-hop").scroll(function(){f.timeOutScroll&&clearTimeout(f.timeOutScroll),f.timeOutScroll=setTimeout(function(){var a=$("#album-tong-hop").scrollTop(),c=$("#album-tong-hop > .microGallery").height();a>c-600&&b.OthersLoadMoreCount<2&&(b.LoadMorePictures(4),b.OthersLoadMoreCount++)},100)}),$("#album-thuc-don").scroll(function(){f.timeOutScroll&&clearTimeout(f.timeOutScroll),f.timeOutScroll=setTimeout(function(){var a=$("#album-thuc-don").scrollTop(),c=$("#album-thuc-don > .microGallery").height();a>c-600&&b.MenuLoadMoreCount<2&&(b.LoadMorePictures(3),b.MenuLoadMoreCount++)},100)})}"use strict",angular.module("FoodyApp").controller("GalleryCtrl",a),a.$inject=["$http","$scope","$element","Helper","DlgECard"]})()
;(function(){function a(a,b,c,d,e,f,g){c.ShowPopupReviews=function(a){g.Show(a)},c.ShowPopupGallery=function(a){f.Show(a)}}"use strict",angular.module("FoodyApp").controller("GalleryPopupController",a),a.$inject=["$http","$rootScope","$scope","$routeParams","Helper","DlgGallery","DlgReviews"]})()
;(function(){function a(a,b,c,d){function h(){var a=f.parents().find('div[ng-controller="ECardCtrl"]');g=a.bPopup({closeClass:"fd-btn-close",followSpeed:0})}function i(){g&&g.close()}var e=this,f=c,g=null;e.$scope=b,b.IsLoading=!1,b.Model={},b.Show=function(c,e){b.IsLoading=!0,h();var f="/__get/ECard/ECardByRes?resId="+c,g=d.GetParamRnd(f);a.get(f+g,{}).then(function(a){a=a.data,b.IsLoading=!1;if(!a){i();return}b.Model=a}).catch(function(a){d.Log(a)})}}"use strict",angular.module("FoodyApp").controller("ECardCtrl",a),a.$inject=["$http","$scope","$element","Helper"]})()
;(function(){function a(a,b,c,d,e,f,g,h){var i=this;i.$scope=c,c.Items=[],c.IsLoading=!1,c.Type=1,c.Init=function(a){c.Type=a,c.LoadMore()},c.getData=function(b){c.IsLoading=!0;var d="";switch(c.Type){case 1:d="/__get/Directory/GetRecentViews";break;case 2:d="/__get/Directory/GetRecentOrder";break;case 3:d="/__get/Directory/GetRecentBooking"}a.get(d).then(function(a){a=a.data;if(!a){c.IsLoading=!1;return}b(a)}).catch(function(a){a=a.data,e.Log(a),c.IsLoading=!1})},c.bindData=function(a,b){for(var d=0;d<a.Items.length;d++)c.Items.push(a.Items[d]);e.RunFnc(b,a)},c.LoadMore=function(a){if(c.IsLoading===!0)return;c.IsLoading=!0,c.getData(function(b){c.bindData(b,function(){c.IsLoading=!1,e.RunFnc(a,b)})})},c.ShowPopupGallery=function(a){g.Show(a)},c.ShowPopupReviews=function(a){h.Show(a)},c.ShowPopupEcard=function(a){f.Show(a)},c.ClickGA=function(a,b,c,d){window.ga&&a.IsAds&&((c+1)%2==0&&ga("ads.send","event",b+"["+(c+1)+"]","Click",a.Name),(c+1)%2!=0&&d!=""&&ga("ads.send","event",b+"QUAN_"+(c+1),"Click",a.Name))},c.ImpressionGa=function(a,b,c,d){window.ga&&a.IsAds&&((c+1)%2==0&&ga("ads.send","event",b+(c+1),"Impression",a.Name),(c+1)%2!=0&&d!=""&&ga("ads.send","event",b+"QUAN_"+(c+1),"Impression",a.Name))}}"use strict",angular.module("FoodyApp").controller("RecentController",a),a.$inject=["$http","$rootScope","$scope","$routeParams","Helper","DlgECard","DlgGallery","DlgReviews"]})()
;(function(){function a(a,b,c,d,e,f){function j(){var a=h.parents().find('div[ng-controller="DlgPopupReportCtrl"]');i=a.bPopup({closeClass:"fd-btn-close",followSpeed:0,modalClose:!1,escClose:!1})}function k(){i&&i.close()}var g=this,h=d,i=null;g.$scope=b,b.ReportContent="",b.ReferenceId=0,b.TypeReport=0,b.Title="",b.Show=function(a,d){f.Show(function(e){e.LoggedIn&&(b.IsLoading=!0,b.Success=-1,b.Submited=!1,b.ReportContent="",c.LastReferenceId=d,b.TypeReport=a,b.ReferenceId=d,b.SetTitle(a),b.IsLoading=!1,b.$$phase||b.$apply(),j())})},b.SetTitle=function(a){switch(a){case 1:b.Title=ReportText.ReportUserTitle;break;case 2:b.Title=ReportText.ReportPhotoTitle;break;case 3:b.Title=ReportText.ReportRestaurantTitle;break;default:b.Title=ReportText.ReportTitle}},b.IsLoading=!1,b.SubmitReport=function(){if(b.ReportContent.trim()!==""){b.IsLoading=!0;var a={referenceId:b.ReferenceId,type:b.TypeReport,errorkeyname:$("#fdDlgPopupReport .errorkeyname").text(),correctinfo:b.ReportContent,istrue:!1,reporturl:window.location.href};$.post("/Report/InsertReport",a,function(a){a.success?b.safeApply(function(){b.Success=1,b.Submited=!0,b.ReportContent="",b.IsLoading=!1,c.LastReferenceId=0}):b.safeApply(function(){b.Success=0,b.IsLoading=!1})})}else b.safeApply(function(){b.Success=2,b.IsLoading=!1})},b.safeApply=function(a){var b=this.$root.$$phase;b==="$apply"||b==="$digest"?a&&typeof a=="function"&&a():this.$apply(a)},$(window).scroll(function(){k()})}"use strict",angular.module("FoodyApp").controller("DlgPopupReportCtrl",a),a.$inject=["$http","$scope","$rootScope","$element","Helper","DlgLogin"]})()
;(function(){function a(a,b,c,d,e,f,g){function i(a){var b=new google.maps.InfoWindow,c="<div id='infoBox' style='width:260px;'><a href='[url]'><img class='box-img' style='width: 220px; height: 110px;' src=\"[image]\" /><div class='box-address'><strong>[title]</strong><br /><p>[address]</p></div></a></div>";for(var d=0;d<a.length;d++){var e=c.replace("[title]",a[d].Name).replace("[address]",a[d].Address).replace("[image]",a[d].PhotoUrl).replace("[url]",a[d].Url);j(a[d].Latitude,a[d].Longitude,map,e)}}function j(a,b,c,d){var e={lat:a,lng:b},f=new google.maps.Marker({position:e});f.setMap(c),google.maps.event.addListener(f,"click",function(){var a=new google.maps.InfoWindow({content:d});a.open(c,f)}),h.push(f)}function k(){for(var a=0;a<h.length;a++)h[a].setMap(null)}function l(){k(),h=[]}function m(a,b){var c,d=1e3,e={lat:a,lng:b},f={strokeColor:"#800000",strokeOpacity:1,strokeWeight:1,fillColor:"#C64D45",fillOpacity:.5,map:map,center:e,radius:d};c=new google.maps.Circle(f)}c.ShowPopupReviews=function(a){g.Show(a)},c.ShowPopupGallery=function(a){f.Show(a)};var h=[];c.data,c.checkSortClick=!1,c.checkDistanceClick=!1,c.isCateChange=!1,c.isLoadingCate=!1,c.isPaging=!0,c.BindData=function(a){c.data=intData,c.data!=null&&(c.data.FillterGroup={Sort:"",Distance:"",Category:""},i(c.data.NearByRestaurants.Items),c.data.FillterGroup.Category="0",c.data.FillterGroup.Sort="1",c.data.FillterGroup.Distance="200.0",c.data.totalRemaining=0,c.data.DefaultCate!=null&&(c.data.FillterGroup.Category=c.data.DefaultCate),c.data.totalRemaining=c.data.NearByRestaurants.Total-c.data.NearByRestaurants.Items.length,c.data.NearByRestaurants.isLoading=!1),c.$apply()},c.handleClickSortType=function(){c.data.NearByRestaurants.Items=[],l(),c.loadItems(!1,c.data.MainRestaurant.Id,c.data.FillterGroup.Sort,c.data.FillterGroup.Category,c.data.FillterGroup.Distance)},c.handleClickDistanceType=function(){c.data.NearByRestaurants.Items=[],l(),c.isCateChange=!0,c.loadItems(!1,c.data.MainRestaurant.Id,c.data.FillterGroup.Sort,c.data.FillterGroup.Category,c.data.FillterGroup.Distance)},c.handleClickCateType=function(){c.data.NearByRestaurants.Items=[],l(),c.loadItems(!1,c.data.MainRestaurant.Id,c.data.FillterGroup.Sort,c.data.FillterGroup.Category,c.data.FillterGroup.Distance)},c.LoadGalleryPopup=function(a){angular.element(document.getElementById("ResNearbyApp")).scope().ShowPopupGallery(a)},c.LoadReviewPopup=function(a){angular.element(document.getElementById("ResNearbyApp")).scope().ShowPopupReviews(a)},c.loadItems=function(a,b,d,e,f){var g=c.data.totalRemaining;if(!c.data.NearByRestaurants.isLoading&&g>0&&a||!a&&!c.data.NearByRestaurants.isLoading){c.data.NearByRestaurants.isLoading=!0,c.data.NearByRestaurants.Total=0,a==1?c.data.NearByRestaurants.LastId+=1:c.data.NearByRestaurants.LastId=1;var h=(new Date).getTime(),j="/__get/restaurant/GetMoreNearbyResAPI?t="+h+"&resId="+b+"&sort="+d+"&maxDistance="+f+"&count="+c.data.NearByRestaurants.count+"&categoryId="+e+"&page="+c.data.NearByRestaurants.LastId;$.get(j,function(b){if(b.success){var d=b.data;c.data.NearByRestaurants.Total=d.Total;var e=null;e=d.Items;for(var f=0;f<e.length;f++)c.data.NearByRestaurants.Items.push(e[f]);c.data.NearByRestaurants.LastId=d.LastId,c.data.totalRemaining=c.data.NearByRestaurants.Total-c.data.NearByRestaurants.Items.length}a==0&&l(),i(d.Items),c.data.NearByRestaurants.isLoading=!1,c.$apply()})}},c.continueLoad=function(){c.loadItems(!0,c.data.MainRestaurant.Id,c.data.FillterGroup.Sort,c.data.FillterGroup.Category,c.data.FillterGroup.Distance)}}"use strict",angular.module("FoodyApp").controller("ResNearbyController",a),a.$inject=["$http","$rootScope","$scope","$routeParams","Helper","DlgGallery","DlgReviews"]})()
;(function(){function a(a,b,c,d,e,f,g){function k(a){for(var b=0;b<a.length;b++)a[b].PhotoUrl==""&&(a[b].PhotoUrl=i+"/Style/images/image_car.jpg")}function l(a){var b=new google.maps.InfoWindow;for(var c=0;c<a.length;c++){var d=j.replace("[title]",a[c].Name).replace("[address]",a[c].Address).replace("[image]",a[c].PhotoUrl).replace("[url]",a[c].Url);n(a[c].Latitude,a[c].Longtitude,map,d)}}function m(a,b,c,d){var e=j.replace("[title]",d.Name).replace("[address]",d.AddressFull).replace("[image]",d.Picture).replace("[url]",urlRestaurantMain),f={lat:a,lng:b},g=new google.maps.Marker({position:f,icon:i+"style/images/icons/map-icons/blue-13.png"});g.setMap(c),google.maps.event.addListener(g,"click",function(){var a=new google.maps.InfoWindow({content:e});a.open(c,g)}),h.push(g)}function n(a,b,c,d){var e={lat:a,lng:b},f=new google.maps.Marker({position:e});f.setMap(c),google.maps.event.addListener(f,"click",function(){var a=new google.maps.InfoWindow({content:d});a.open(c,f)}),h.push(f)}function o(){for(var a=0;a<h.length;a++)h[a].setMap(null)}function p(){o(),h=[]}function q(a,b){var c,d=1e3,e={lat:a,lng:b},f={strokeColor:"#800000",strokeOpacity:1,strokeWeight:1,fillColor:"#C64D45",fillOpacity:.5,map:map,center:e,radius:d};c=new google.maps.Circle(f)}c.ShowPopupReviews=function(a){g.Show(a)},c.ShowPopupGallery=function(a){f.Show(a)};var h=[];c.data,c.mediaDefaultImage="https://media.foody.vn/default/s/no-image.png";var i=window.staticPath?window.staticPath:"/",j="<div id='infoBox' style='width:260px;'><a href='[url]'><img class='box-img' style='width: 220px; height: 110px;margin:0px auto;' src=\"[image]\" /><div class='box-address' style='width:200px;margin:0px auto;'><strong>[title]</strong><br /><p>[address]</p></div></a></div>";c.ViewMode="row",c.isLoadingCate=!1,c.isPaging=!0,c.BindData=function(a){c.data=intData,c.data!=null&&(c.data.FillterGroup={Distance:""},k(c.data.NearbyParkingPlaces.Items),m(c.data.MainRestaurant.Latitude,c.data.MainRestaurant.Longitude,map,c.data.MainRestaurant),l(c.data.NearbyParkingPlaces.Items),c.data.FillterGroup.Distance="1",c.data.totalRemaining=0,c.data.totalRemaining=c.data.NearbyParkingPlaces.Total-c.data.NearbyParkingPlaces.Items.length,c.data.NearbyParkingPlaces.isLoading=!1,$(".ldc-items-map").css({width:"0px",height:"0px"})),c.$apply()},c.handleClickDistanceType=function(){c.data.NearbyParkingPlaces.Items=[],p(),c.loadItems(!1,c.data.MainRestaurant.Id,c.data.FillterGroup.Distance)},c.loadItems=function(a,b,d){var e=c.data.totalRemaining;if(!c.data.NearbyParkingPlaces.isLoading&&e>0&&a||!a&&!c.data.NearbyParkingPlaces.isLoading){c.data.NearbyParkingPlaces.isLoading=!0,c.data.NearbyParkingPlaces.Total=0,a==0&&(c.data.NearbyParkingPlaces.LastId=0);var f="/restaurant/GetMoreNearbyParking?resId="+b+"&maxDistance="+d+"&count="+c.data.NearbyParkingPlaces.Count+"&LastId="+c.data.NearbyParkingPlaces.LastId;$.get(f,function(b){if(b.success){var d=b.data;c.data.NearbyParkingPlaces.Total=d.Total;var e=null;e=d.Items;for(var f=0;f<e.length;f++)e[f].PhotoUrl==""&&(e[f].PhotoUrl=i+"/Style/images/image_car.jpg"),c.data.NearbyParkingPlaces.Items.push(e[f]);c.data.NearbyParkingPlaces.LastId=d.LastId,c.data.totalRemaining=c.data.NearbyParkingPlaces.Total-c.data.NearbyParkingPlaces.Items.length}a==0&&p(),m(c.data.MainRestaurant.Latitude,c.data.MainRestaurant.Longitude,map,c.data.MainRestaurant),l(d.Items),c.data.NearbyParkingPlaces.isLoading=!1,c.$apply()})}},c.continueLoad=function(){c.loadItems(!0,c.data.MainRestaurant.Id,c.data.FillterGroup.Distance)},c.ChangeViewType=function(a){switch(a){case"row":c.ViewMode="row",$(".ldc-items-row").css({width:"100%",height:"100%"}),$(".ldc-items-map").css({width:"0px",height:"0px"});break;case"map":c.ViewMode="map",$(".ldc-items-row").css({width:"0px",height:"0px"}),$(".ldc-items-map").css({width:"100%",height:"100%"})}}}"use strict",angular.module("FoodyApp").controller("ParkingNearbyController",a),a.$inject=["$http","$rootScope","$scope","$routeParams","Helper","DlgGallery","DlgReviews"]})()
;(function(){function a(a,b,c,d,e,f,g){function k(a){for(var b=0;b<a.length;b++)a[b].PhotoUrl==""&&(a[b].PhotoUrl=i+"/Style/images/image_car.jpg")}function l(a){var b=new google.maps.InfoWindow;for(var c=0;c<a.length;c++){var d=j.replace("[title]",a[c].Name).replace("[address]",a[c].Address).replace("[image]",a[c].PhotoUrl).replace("[url]",a[c].Url);n(a[c].Latitude,a[c].Longtitude,map,d)}}function m(a,b,c,d){d.PhotoUrl==""&&(d.PhotoUrl=i+"/Style/images/image_car.jpg");var e=j.replace("[title]",d.Name).replace("[address]",d.Address).replace("[image]",d.PhotoUrl).replace("[url]","#"),f={lat:a,lng:b},g=new google.maps.Marker({position:f,icon:i+"style/images/icons/map-icons/blue-13.png"});g.setMap(c),google.maps.event.addListener(g,"click",function(){var a=new google.maps.InfoWindow({content:e});a.open(c,g)}),h.push(g)}function n(a,b,c,d){var e={lat:a,lng:b},f=new google.maps.Marker({position:e});f.setMap(c),google.maps.event.addListener(f,"click",function(){var a=new google.maps.InfoWindow({content:d});a.open(c,f)}),h.push(f)}function o(){for(var a=0;a<h.length;a++)h[a].setMap(null)}function p(){o(),h=[]}function q(a,b){var c,d=1e3,e={lat:a,lng:b},f={strokeColor:"#800000",strokeOpacity:1,strokeWeight:1,fillColor:"#C64D45",fillOpacity:.5,map:map,center:e,radius:d};c=new google.maps.Circle(f)}var h=[];c.data,c.mediaDefaultImage="https://media.foody.vn/default/s/no-image.png";var i=window.staticPath?window.staticPath:"/",j="<div id='infoBox' style='width:260px;'><a href='[url]'><img class='box-img' style='width: 220px; height: 110px;margin:0px auto;' src=\"[image]\" /><div class='box-address' style='width:200px;margin:0px auto;'><strong>[title]</strong><br /><p>[address]</p></div></a></div>";c.isLoadingCate=!1,c.isPaging=!0,c.ViewMode="row",c.BindData=function(a){c.data=intData,c.data!=null&&(c.data.FillterGroup={Distance:""},k(c.data.NearbyParkingPlaces.Items),m(c.data.MainParkingPlace.Latitude,c.data.MainParkingPlace.Longtitude,map,c.data.MainParkingPlace),l(c.data.NearbyParkingPlaces.Items),c.data.FillterGroup.Distance="0.2",c.data.totalRemaining=0,c.data.totalRemaining=c.data.NearbyParkingPlaces.Total-c.data.NearbyParkingPlaces.Items.length,c.data.NearbyParkingPlaces.isLoading=!1,$(".ldc-items-map").css({width:"0px",height:"0px"})),c.$apply()},c.handleClickDistanceType=function(){c.data.NearbyParkingPlaces.Items=[],p(),c.loadItems(!1,c.data.MainParkingPlace.Id,c.data.FillterGroup.Distance)},c.loadItems=function(a,b,d){var e=c.data.totalRemaining;if(!c.data.NearbyParkingPlaces.isLoading&&e>0&&a||!a&&!c.data.NearbyParkingPlaces.isLoading){c.data.NearbyParkingPlaces.isLoading=!0,c.data.NearbyParkingPlaces.Total=0,a==0&&(c.data.NearbyParkingPlaces.LastId=0);var f="/restaurant/GetMoreNearbyParkingDetail?parkingId="+b+"&maxDistance="+d+"&count="+c.data.NearbyParkingPlaces.Count+"&LastId="+c.data.NearbyParkingPlaces.LastId;$.get(f,function(b){if(b.success){var d=b.data;c.data.NearbyParkingPlaces.Total=d.Total;var e=null;e=d.Items;for(var f=0;f<e.length;f++)e[f].PhotoUrl==""&&(e[f].PhotoUrl=i+"/Style/images/image_car.jpg"),c.data.NearbyParkingPlaces.Items.push(e[f]);c.data.NearbyParkingPlaces.LastId=d.LastId,c.data.totalRemaining=c.data.NearbyParkingPlaces.Total-c.data.NearbyParkingPlaces.Items.length}a==0&&p(),m(c.data.MainParkingPlace.Latitude,c.data.MainParkingPlace.Longtitude,map,c.data.MainParkingPlace),l(d.Items),c.data.NearbyParkingPlaces.isLoading=!1,c.$apply()})}},c.continueLoad=function(){c.loadItems(!0,c.data.MainParkingPlace.Id,c.data.FillterGroup.Distance)},c.ChangeViewType=function(a){switch(a){case"row":c.ViewMode="row",$(".ldc-items-row").css({width:"100%",height:"100%"}),$(".ldc-items-map").css({width:"0px",height:"0px"});break;case"map":c.ViewMode="map",$(".ldc-items-row").css({width:"0px",height:"0px"}),$(".ldc-items-map").css({width:"100%",height:"100%"})}}}"use strict",angular.module("FoodyApp").controller("ParkingNearbyParkingPlaceController",a),a.$inject=["$http","$rootScope","$scope","$routeParams","Helper","DlgGallery","DlgReviews"]})()
